<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Rosemount Irish v3.1</title>
    <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        * {
            font-family: 'Arial Narrow', Arial, sans-serif;
        }
        
        /* Critical: Ensure colors print properly */
        @media print {
            /* Force yellow highlights to print */
            .bg-yellow-300, [style*="background-color: rgb(255, 255, 0)"], [style*="background-color: #FFFF00"] {
                background-color: #FFFF00 !important;
                -webkit-print-color-adjust: exact !important;
                print-color-adjust: exact !important;
            }
            
            /* Force gray logo backgrounds to print */
            [style*="backgroundColor: '#EFEFEF'"], [style*="backgroundColor: '#efefef'"] {
                background-color: #EFEFEF !important;
                -webkit-print-color-adjust: exact !important;
                print-color-adjust: exact !important;
            }
            
            /* Ensure all custom backgrounds print */
            * {
                -webkit-print-color-adjust: exact !important;
                print-color-adjust: exact !important;
            }
        }
    </style>
</head>
<body>
    <div id="root"></div>
    
    <script type="text/babel">
        const { useState, useEffect } = React;

        // Error Boundary Component
        class ErrorBoundary extends React.Component {
          constructor(props) {
            super(props);
            this.state = { hasError: false, error: null };
          }

          static getDerivedStateFromError(error) {
            return { hasError: true, error };
          }

          componentDidCatch(error, errorInfo) {
            console.error('Error caught by boundary:', error, errorInfo);
          }

          render() {
            if (this.state.hasError) {
              return (
                <div style={{ padding: '20px', backgroundColor: '#fee', border: '2px solid #f00', margin: '20px' }}>
                  <h2>Something went wrong.</h2>
                  <details style={{ whiteSpace: 'pre-wrap' }}>
                    {this.state.error && this.state.error.toString()}
                  </details>
                  <button onClick={() => window.location.reload()} style={{ marginTop: '10px', padding: '8px 16px' }}>
                    Reload Application
                  </button>
                </div>
              );
            }
            return this.props.children;
          }
        }

        // SVG Icon Components
        const Upload = ({ size = 16 }) => (
            <svg width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2">
                <path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4M17 8l-5-5-5 5M12 3v12"/>
            </svg>
        );
        
        const Settings = ({ size = 16 }) => (
            <svg width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2">
                <circle cx="12" cy="12" r="3"/><path d="M12 1v6m0 6v6m5.2-13.8l-1 1.7m-4.4 7.6l-1 1.7M23 12h-6m-6 0H5m13.8 5.2l-1.7-1m-7.6-4.4l-1.7-1"/>
            </svg>
        );
        
        const Printer = ({ size = 16 }) => (
            <svg width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2">
                <polyline points="6 9 6 2 18 2 18 9"/><path d="M6 18H4a2 2 0 0 1-2-2v-5a2 2 0 0 1 2-2h16a2 2 0 0 1 2 2v5a2 2 0 0 1-2 2h-2"/><rect x="6" y="14" width="12" height="8"/>
            </svg>
        );

        const X = ({ size = 20 }) => (
            <svg width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2">
                <line x1="18" y1="6" x2="6" y2="18"></line><line x1="6" y1="6" x2="18" y2="18"></line>
            </svg>
        );

        const Download = ({ size = 16 }) => (
            <svg width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2">
                <path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4M7 10l5 5 5-5M12 15V3"/>
            </svg>
        );

        // ============================================================
        // SUBSCRIBER CONFIGURATION
        // Set SUBSCRIBER_MODE = true when building subscriber sites
        // Then populate EMBEDDED_CONFIG with their exported data
        // ============================================================
        const SUBSCRIBER_MODE = true;  // Master site = false, Subscriber sites = true
        
        const EMBEDDED_CONFIG = {
          siteId: 'rosemount-irish',
          teamSetup: {
            teamName: 'Rosemount Irish',
            logo: 'https://cdn2.sportngin.com/attachments/team/f4a2-199862227/R-with-Stick-Logo_large_square.png',
            colors: { primary: '#000066', secondary: '#00A302' },
            arena: 'Rosemount Ice Arena, Rosemount',
            careerStats: {
              {
              "SHERMAN_CAD": { "type": "skater", "data": { "gp": 60, "g": 33, "a": 38, "pts": 71, "pim": 12, "plusMinus": 64, "fow": 0, "fol": 0 } },
              "TOLL_JOS": { "type": "skater", "data": { "gp": 81, "g": 23, "a": 77, "pts": 100, "pim": 24, "plusMinus": 73, "fow": 0, "fol": 0 } },
              "GARRITY_CHR": { "type": "skater", "data": { "gp": 81, "g": 72, "a": 49, "pts": 121, "pim": 32, "plusMinus": 70, "fow": 0, "fol": 0 } },
              "MCNEIL_GAV": { "type": "skater", "data": { "gp": 54, "g": 23, "a": 36, "pts": 59, "pim": 8, "plusMinus": 43, "fow": 0, "fol": 0 } },
              "NICHOLS_CRI": { "type": "skater", "data": { "gp": 51, "g": 7, "a": 47, "pts": 54, "pim": 24, "plusMinus": 56, "fow": 0, "fol": 0 } },
              "RUTZICK_BEN": { "type": "skater", "data": { "gp": 77, "g": 21, "a": 31, "pts": 52, "pim": 18, "plusMinus": 30, "fow": 0, "fol": 0 } },
              "SCHUBERT_CON": { "type": "skater", "data": { "gp": 27, "g": 12, "a": 12, "pts": 24, "pim": 18, "plusMinus": 21, "fow": 0, "fol": 0 } },
              "CLAFTON_GRA": { "type": "skater", "data": { "gp": 54, "g": 4, "a": 28, "pts": 32, "pim": 12, "plusMinus": 41, "fow": 0, "fol": 0 } },
              "VEDEPO_QUI": { "type": "skater", "data": { "gp": 54, "g": 14, "a": 21, "pts": 35, "pim": 60, "plusMinus": 25, "fow": 0, "fol": 0 } },
              "GOODWIN_CHA": { "type": "skater", "data": { "gp": 27, "g": 11, "a": 8, "pts": 19, "pim": 4, "plusMinus": 13, "fow": 0, "fol": 0 } },
              "SCHMUCKER_SAM": { "type": "skater", "data": { "gp": 28, "g": 3, "a": 13, "pts": 16, "pim": 9, "plusMinus": 16, "fow": 0, "fol": 0 } },
              "DEGROOT_PET": { "type": "skater", "data": { "gp": 29, "g": 7, "a": 7, "pts": 14, "pim": 14, "plusMinus": 13, "fow": 0, "fol": 0 } },
              "LENMARK_JAC": { "type": "skater", "data": { "gp": 30, "g": 3, "a": 9, "pts": 12, "pim": 29, "plusMinus": 12, "fow": 0, "fol": 0 } },
              "GOREN_OLI": { "type": "skater", "data": { "gp": 23, "g": 0, "a": 9, "pts": 9, "pim": 14, "plusMinus": 12, "fow": 0, "fol": 0 } },
              "GANSER_CAR": { "type": "skater", "data": { "gp": 37, "g": 3, "a": 9, "pts": 12, "pim": 14, "plusMinus": 30, "fow": 0, "fol": 0 } },
              "MCCRACKEN_BRA": { "type": "skater", "data": { "gp": 33, "g": 3, "a": 3, "pts": 6, "pim": 2, "plusMinus": -2, "fow": 0, "fol": 0 } },
              "HENDERSON_MAS": { "type": "skater", "data": { "gp": 15, "g": 1, "a": 1, "pts": 2, "pim": 0, "plusMinus": -1, "fow": 0, "fol": 0 } },
              "CLEMENTS_SAM": { "type": "goalie", "data": { "gp": 26, "min": "1315:28", "w": 22, "l": 4, "t": 0, "so": 4, "ga": 61, "sv": 499 } },
              "GROVE_ZAC": { "type": "skater", "data": { "gp": 5, "g": 0, "a": 1, "pts": 1, "pim": 0, "plusMinus": 2, "fow": 0, "fol": 0 } },
              "CAMPBELL_CAR": { "type": "skater", "data": { "gp": 2, "g": 0, "a": 1, "pts": 1, "pim": 2, "plusMinus": -2, "fow": 0, "fol": 0 } },
              "ERICKSON_HEA": { "type": "skater", "data": { "gp": 15, "g": 0, "a": 0, "pts": 0, "pim": 0, "plusMinus": -1, "fow": 0, "fol": 0 } },
              "ATKINS_BRO": { "type": "skater", "data": { "gp": 1, "g": 0, "a": 0, "pts": 0, "pim": 0, "plusMinus": -1, "fow": 0, "fol": 0 } },
              "LEBRUN_GAV": { "type": "skater", "data": { "gp": 1, "g": 0, "a": 0, "pts": 0, "pim": 0, "plusMinus": 0, "fow": 0, "fol": 0 } },
              "TOBIAS_COO": { "type": "skater", "data": { "gp": 3, "g": 0, "a": 0, "pts": 0, "pim": 0, "plusMinus": 0, "fow": 0, "fol": 0 } },
              "PACE_BEN": { "type": "skater", "data": { "gp": 1, "g": 0, "a": 0, "pts": 0, "pim": 0, "plusMinus": 0, "fow": 0, "fol": 0 } },
              "MCDONALD_MAS": { "type": "skater", "data": { "gp": 1, "g": 0, "a": 0, "pts": 0, "pim": 0, "plusMinus": 0, "fow": 0, "fol": 0 } },
              "WILLIAMS_MAX": { "type": "skater", "data": { "gp": 1, "g": 0, "a": 0, "pts": 0, "pim": 0, "plusMinus": 0, "fow": 0, "fol": 0 } },
              "PEDERSEN_CHA": { "type": "goalie", "data": { "gp": 2, "min": "59:01", "w": 1, "l": 0, "t": 0, "so": 1, "ga": 1, "sv": 21 } },
              "HEDLUND_HAN": { "type": "skater", "data": { "gp": 28, "g": 17, "a": 33, "pts": 50, "pim": 49, "plusMinus": 37, "fow": 0, "fol": 0 } },
              "DURIGAN_OWE": { "type": "skater", "data": { "gp": 52, "g": 19, "a": 29, "pts": 48, "pim": 20, "plusMinus": 28, "fow": 0, "fol": 0 } },
              "SALAK_LUC": { "type": "skater", "data": { "gp": 54, "g": 13, "a": 18, "pts": 31, "pim": 30, "plusMinus": -1, "fow": 0, "fol": 0 } },
              "HANSEN_TY": { "type": "skater", "data": { "gp": 53, "g": 12, "a": 21, "pts": 33, "pim": 65, "plusMinus": 4, "fow": 0, "fol": 0 } },
              "LOTYSZ_KAD": { "type": "skater", "data": { "gp": 54, "g": 9, "a": 15, "pts": 24, "pim": 60, "plusMinus": 17, "fow": 0, "fol": 0 } },
              "GANSER_JAC": { "type": "skater", "data": { "gp": 53, "g": 11, "a": 21, "pts": 32, "pim": 38, "plusMinus": 11, "fow": 0, "fol": 0 } },
              "LEWIS_ELI": { "type": "skater", "data": { "gp": 48, "g": 6, "a": 14, "pts": 20, "pim": 35, "plusMinus": 13, "fow": 0, "fol": 0 } },
              "RETKA_BUR": { "type": "skater", "data": { "gp": 50, "g": 4, "a": 7, "pts": 11, "pim": 30, "plusMinus": 11, "fow": 0, "fol": 0 } },
              "CARLSON_MIC": { "type": "skater", "data": { "gp": 31, "g": 3, "a": 1, "pts": 4, "pim": 4, "plusMinus": 3, "fow": 0, "fol": 0 } },
              "NELSON_TRE": { "type": "goalie", "data": { "gp": 23, "min": "1100:55", "w": 16, "l": 5, "t": 0, "so": 2, "ga": 44, "sv": 413 } },
              "MCNAMARA_KEV": { "type": "skater", "data": { "gp": 1, "g": 0, "a": 1, "pts": 1, "pim": 0, "plusMinus": 1, "fow": 0, "fol": 0 } },
              "HEROLD_DYL": { "type": "skater", "data": { "gp": 21, "g": 2, "a": 1, "pts": 3, "pim": 2, "plusMinus": 2, "fow": 0, "fol": 0 } },
              "SIMONSON_BEA": { "type": "skater", "data": { "gp": 1, "g": 0, "a": 0, "pts": 0, "pim": 0, "plusMinus": 0, "fow": 0, "fol": 0 } },
              "DENNY_CAD": { "type": "goalie", "data": { "gp": 19, "min": "883:09", "w": 9, "l": 9, "t": 0, "so": 3, "ga": 53, "sv": 306 } },
              "HEGARTY_CAD": { "type": "skater", "data": { "gp": 27, "g": 10, "a": 34, "pts": 44, "pim": 4, "plusMinus": 15, "fow": 0, "fol": 0 } },
              "CAMPBELL_CAD": { "type": "skater", "data": { "gp": 27, "g": 18, "a": 24, "pts": 42, "pim": 22, "plusMinus": 8, "fow": 0, "fol": 0 } },
              "TOLL_JAK": { "type": "skater", "data": { "gp": 27, "g": 12, "a": 19, "pts": 31, "pim": 35, "plusMinus": 14, "fow": 0, "fol": 0 } },
              "SABO_RYK": { "type": "skater", "data": { "gp": 27, "g": 0, "a": 5, "pts": 5, "pim": 8, "plusMinus": 11, "fow": 0, "fol": 0 } },
              "FISCHER_TRI": { "type": "goalie", "data": { "gp": 16, "min": "771:45", "w": 8, "l": 6, "t": 1, "so": 1, "ga": 45, "sv": 362 } },
              "CLEMENTS_AID": { "type": "skater", "data": { "gp": 26, "g": 1, "a": 0, "pts": 1, "pim": 18, "plusMinus": -5, "fow": 0, "fol": 0 } },
              "KELSEY_TJ": { "type": "skater", "data": { "gp": 6, "g": 0, "a": 0, "pts": 0, "pim": 0, "plusMinus": -1, "fow": 0, "fol": 0 } },
              "BARTOL_GRA": { "type": "skater", "data": { "gp": 3, "g": 0, "a": 0, "pts": 0, "pim": 0, "plusMinus": 0, "fow": 0, "fol": 0 } },
              "PARLA_LUC": { "type": "skater", "data": { "gp": 1, "g": 0, "a": 0, "pts": 0, "pim": 0, "plusMinus": 0, "fow": 0, "fol": 0 } }
              }
            },
            pronunciations: {}
          },
          careerSeasonData: { season1: '', season2: '', season3: '' }
        };
        // ============================================================

        // ============================================================
        // MSHSL TEAMS DATABASE
        // Complete database of Minnesota high school hockey teams
        // with logos and team colors from Legacy Hockey
        // ============================================================
        const MSHSL_TEAMS = {
          "academy of holy angels": { name: "Academy of Holy Angels", nickname: "Stars", logo: "https://cdn2.sportngin.com/attachments/team/5dca-151689530/holy-angels-stars-hockey-_1__large_square.png", primaryColor: "#0000BA", secondaryColor: "#E39E1D" },
          "albert lea": { name: "Albert Lea", nickname: "Tigers", logo: "https://cdn2.sportngin.com/attachments/team/c7d9-149891114/AlbertLea_large_square.png", primaryColor: "#C90000", secondaryColor: "#0000BA" },
          "alexandria": { name: "Alexandria", nickname: "Cardinals", logo: "https://cdn3.sportngin.com/attachments/team/6b78-151624918/1alexandria-cardinals-hockey_large_square.png", primaryColor: "#010101", secondaryColor: "#CF2329" },
          "andover": { name: "Andover", nickname: "Huskies", logo: "https://cdn4.sportngin.com/attachments/team/7f7f-151913518/andover-huskies-hockey-_1__large_square.png", primaryColor: "#000000", secondaryColor: "#977501" },
          "anoka": { name: "Anoka", nickname: "Tornadoes", logo: "https://cdn2.sportngin.com/attachments/team/e252-151913899/anoka-hockey_large_square.png", primaryColor: "#441E20", secondaryColor: "#CCCCCC" },
          "apple valley/burnsville": { name: "Apple Valley/Burnsville", nickname: "Thunder", logo: "https://cdn2.sportngin.com/attachments/team/c82a-151937882/Apple_Valley_large_square_large_square_large_square.png", primaryColor: "#361E1F", secondaryColor: "#C0A686" },
          "austin": { name: "Austin", nickname: "Packers", logo: "https://cdn3.sportngin.com/attachments/team/2e29-149918958/activities_large_square.png", primaryColor: "#CC0000", secondaryColor: "#FFFFFF" },
          "bagley/fosston": { name: "Bagley/Fosston", nickname: "Flyers", logo: "https://cdn2.sportngin.com/attachments/team/865e-151897558/749a11df0b4cadd99bf301e62816258a9ea4035esld08_BFGCHockey_store_large_square.png", primaryColor: "#561C1B", secondaryColor: "#E39E1D" },
          "becker/big lake": { name: "Becker/Big Lake", nickname: "Eagles", logo: "https://cdn3.sportngin.com/attachments/team/5c41-151867105/1becker-big-lake-eagles-hockey_large_square.png", primaryColor: "#0577FA", secondaryColor: "#FFFFFF" },
          "bemidji": { name: "Bemidji", nickname: "Lumberjacks", logo: "https://cdn3.sportngin.com/attachments/team/ae8e-151779535/bemidji-lumberjacks-hockey_large_square.png", primaryColor: "#013368", secondaryColor: "#999999" },
          "benilde-st. margaret's": { name: "Benilde-St. Margaret's", nickname: "Red Knights", logo: "https://cdn4.sportngin.com/attachments/team/76a6-151815503/benilde-st-margaret-red-knights-hockey_large_square.png", primaryColor: "#EF131F", secondaryColor: "#FFFFFF" },
          "blaine": { name: "Blaine", nickname: "Bengals", logo: "https://cdn4.sportngin.com/attachments/team/6ed9-151913528/blaine-bengals-hockey_large_square.png", primaryColor: "#001A77", secondaryColor: "#87BBF5" },
          "blake": { name: "Blake", nickname: "Bears", logo: "https://cdn1.sportngin.com/attachments/team/e55b-149852379/Full_bear-01_large_large_square.png", primaryColor: "#000080", secondaryColor: "#478430" },
          "bloomington jefferson": { name: "Bloomington Jefferson", nickname: "Jaguars", logo: "https://cdn2.sportngin.com/attachments/team/2fc2-151834018/schoollogo1_400x400-copy_large_square.png", primaryColor: "#87BBF5", secondaryColor: "#FFFFFF" },
          "brainerd": { name: "Brainerd", nickname: "Warriors", logo: "https://cdn4.sportngin.com/attachments/team/9033-151634234/brainerd-warriors-hockey_large_square.png", primaryColor: "#223B98", secondaryColor: "#D2D2D2" },
          "breck": { name: "Breck", nickname: "Mustangs", logo: "https://cdn1.sportngin.com/attachments/team/c481-151665104/breck-mustangs-hockey_large_square.png", primaryColor: "#024A72", secondaryColor: "#FECC00" },
          "breckenridge/wahpeton": { name: "Breckenridge/Wahpeton", nickname: "Blades", logo: "https://cdn3.sportngin.com/attachments/team/ccff-196793539/BladesCircle2_FINAL-2_large_square.png", primaryColor: "#000000", secondaryColor: "#EBEBEB" },
          "buffalo": { name: "Buffalo", nickname: "Bison", logo: "https://cdn3.sportngin.com/attachments/team/e818-151725160/buffalo-bisons-hockey_large_square.png", primaryColor: "#6600CC", secondaryColor: "#000000" },
          "cambridge-isanti": { name: "Cambridge-Isanti", nickname: "Bluejackets", logo: "https://cdn4.sportngin.com/attachments/team/5bb8-151867068/1cambridge-isanti-hockey_large_square.png", primaryColor: "#000095", secondaryColor: "#FFFFFF" },
          "centennial": { name: "Centennial", nickname: "Cougars", logo: "https://cdn2.sportngin.com/attachments/team/cef2-151905836/1centennal-cougars-hockey_large_square.png", primaryColor: "#D62724", secondaryColor: "#000000" },
          "champlin park": { name: "Champlin Park", nickname: "Rebels", logo: "https://cdn2.sportngin.com/attachments/team/38d3-151913866/logo_large_large_square.png", primaryColor: "#142985", secondaryColor: "#5A89E7" },
          "chanhassen": { name: "Chanhassen", nickname: "Storm", logo: "https://cdn4.sportngin.com/attachments/team/8e27-151834799/chanhassen-storm-hockey_large_square.png", primaryColor: "#0E0F31", secondaryColor: "#C1B05F" },
          "chaska": { name: "Chaska", nickname: "Hawks", logo: "https://cdn1.sportngin.com/attachments/team/c5e3-151815251/1chaska-hawks-hockey_large_square.png", primaryColor: "#66017B", secondaryColor: "#F9F632" },
          "chisago lakes": { name: "Chisago Lakes", nickname: "Wildcats", logo: "https://cdn1.sportngin.com/attachments/team/c474-151872918/Wildcat-_1__large_square.png", primaryColor: "#006633", secondaryColor: "#FFCC00" },
          "cloquet/esko/carlton": { name: "Cloquet/Esko/Carlton", nickname: "Lumberjacks", logo: "https://cdn1.sportngin.com/attachments/team/4be5-151767696/CEC_Lumberjack_medium_large_square.png", primaryColor: "#5B00A0", secondaryColor: "#EFB520" },
          "cretin-derham hall": { name: "Cretin-Derham Hall", nickname: "Raiders", logo: "https://cdn4.sportngin.com/attachments/team/cb7c-151927920/1cretin-derham-hall-hockey_large_square.png", primaryColor: "#7B0484", secondaryColor: "#F0D803" },
          "crookston": { name: "Crookston", nickname: "Pirates", logo: "https://cdn2.sportngin.com/attachments/team/b077-151779804/crookston-pirates-hockey_large_square.png", primaryColor: "#2E1867", secondaryColor: "#F5DA19" },
          "delano": { name: "Delano", nickname: "Tigers", logo: "https://cdn3.sportngin.com/attachments/team/5112-152073362/1delano-tigers-hockey_large_square_large_square.png", primaryColor: "#000000", secondaryColor: "#FC6418" },
          "detroit lakes": { name: "Detroit Lakes", nickname: "Lakers", logo: "https://cdn2.sportngin.com/attachments/team/04ca-151862469/07ac69be6bb11994b72c9207dc591e1b_large_square.png", primaryColor: "#D2232A", secondaryColor: "#FCF7F7" },
          "dodge county": { name: "Dodge County", nickname: "Wildcats", logo: "https://cdn3.sportngin.com/attachments/team/f13c-151914171/1wildcat-logo-2_large_square_large_square.png", primaryColor: "#000005", secondaryColor: "#2B60DE" },
          "duluth denfeld": { name: "Duluth Denfeld", nickname: "Hunters", logo: "https://cdn2.sportngin.com/attachments/team/9b7c-152161278/Untitled-1_large_square.png", primaryColor: "#56012B", secondaryColor: "#BFA04D" },
          "duluth east": { name: "Duluth East", nickname: "Greyhounds", logo: "https://cdn4.sportngin.com/attachments/team/9bc8-215114884/DuluthEastLogo_large_square.png", primaryColor: "#000005", secondaryColor: "#CC0202" },
          "duluth marshall": { name: "Duluth Marshall", nickname: "Hilltoppers", logo: "https://cdn3.sportngin.com/attachments/team/3c60-151768307/download-_3__large_square.png", primaryColor: "#000000", secondaryColor: "#F7C300" },
          "eagan": { name: "Eagan", nickname: "Wildcats", logo: "https://cdn3.sportngin.com/attachments/team/2513-215087879/EaganLogo519_large_square.png", primaryColor: "#003399", secondaryColor: "#65FF01" },
          "east grand forks": { name: "East Grand Forks", nickname: "Green Wave", logo: "https://cdn2.sportngin.com/attachments/team/e494-151779249/east-grand-forks-hockey_large_square.png", primaryColor: "#007800", secondaryColor: "#CC0000" },
          "east ridge": { name: "East Ridge", nickname: "Raptors", logo: "https://cdn1.sportngin.com/attachments/team/3d12-151942489/1east-ridge-raptors-hockey_large_square_large_square.png", primaryColor: "#000000", secondaryColor: "#C5B358" },
          "eastview": { name: "Eastview", nickname: "Lightning", logo: "https://cdn4.sportngin.com/attachments/team/da47-150000199/Untitled-1_large_square.png", primaryColor: "#3366FF", secondaryColor: "#CCD4E7" },
          "eden prairie": { name: "Eden Prairie", nickname: "Eagles", logo: "https://cdn3.sportngin.com/attachments/team/a752-151728057/logo-eagle-_1__large_square.png", primaryColor: "#B21E23", secondaryColor: "#010101" },
          "edina": { name: "Edina", nickname: "Hornets", logo: "https://cdn3.sportngin.com/attachments/team/c884-151725037/edina-hornets-hockey-_1__large_square.png", primaryColor: "#1A8440", secondaryColor: "#EFB035" },
          "elk river/zimmerman": { name: "Elk River/Zimmerman", nickname: "Elks", logo: "https://cdn4.sportngin.com/attachments/team/5114-151913628/elk-river-elks-hockey-_1__large_square.png", primaryColor: "#000000", secondaryColor: "#D00000" },
          "ely": { name: "Ely", nickname: "Timberwolves", logo: "https://cdn3.sportngin.com/attachments/team/4eb2-151691479/ely-timberwolves-hockey_large_square.png", primaryColor: "#000001", secondaryColor: "#B80000" },
          "fairmont": { name: "Fairmont", nickname: "Cardinals", logo: "https://cdn4.sportngin.com/attachments/team/36d5-150042624/fairmont-cardinal-hockey_large_square.png", primaryColor: "#000002", secondaryColor: "#7C0C00" },
          "faribault": { name: "Faribault", nickname: "Falcons", logo: "https://cdn4.sportngin.com/attachments/team/b571-149918671/faribault-falcons-hockey_large_square.png", primaryColor: "#023604", secondaryColor: "#DCDCDC" },
          "farmington": { name: "Farmington", nickname: "Tigers", logo: "https://cdn2.sportngin.com/attachments/team/0bbc-151937498/farmington-tigers-hockey-_2__large_square_large_square.png", primaryColor: "#000000", secondaryColor: "#DA6600" },
          "fergus falls": { name: "Fergus Falls", nickname: "Otters", logo: "https://cdn3.sportngin.com/attachments/team/ac64-151634253/fergus-falls-otters-hockey_large_square.png", primaryColor: "#482B20", secondaryColor: "#FFD900" },
          "forest lake": { name: "Forest Lake", nickname: "Rangers", logo: "https://cdn4.sportngin.com/attachments/team/4b23-151942233/1forest-lake-rangers-hockey_large_square_large_square.png", primaryColor: "#611311", secondaryColor: "#DABB3C" },
          "gentry academy": { name: "Gentry Academy", nickname: "Stars", logo: "https://cdn4.sportngin.com/attachments/team/8bac-151690534/Gentry_copy_large_square.png", primaryColor: "#0521F7", secondaryColor: "#F2FA05" },
          "grand rapids": { name: "Grand Rapids", nickname: "Thunderhawks", logo: "https://cdn3.sportngin.com/attachments/team/a468-152076901/MSHSL115510GRHS_Secondary_large_square.png", primaryColor: "#000000", secondaryColor: "#F75408" },
          "greenway": { name: "Greenway", nickname: "Raiders", logo: "https://cdn2.sportngin.com/attachments/team/cf86-151692129/EOMf7_MX4AUivJk_large_square.png", primaryColor: "#078A4D", secondaryColor: "#FFFFFF" },
          "hastings": { name: "Hastings", nickname: "Raiders", logo: "https://cdn2.sportngin.com/attachments/team/3cfa-151937576/hastings-raiders-hockey-_1__large_square_large_square.png", primaryColor: "#0139F0", secondaryColor: "#FFB210" },
          "hermantown": { name: "Hermantown", nickname: "Hawks", logo: "https://cdn1.sportngin.com/attachments/team/520f-151767468/hermantown-hawks-hockey_large_square.png", primaryColor: "#081B77", secondaryColor: "#F7CD25" },
          "hibbing/chisholm": { name: "Hibbing/Chisholm", nickname: "Bluejackets", logo: "https://cdn3.sportngin.com/attachments/team/d019-151710402/hibbing-chisholm-bluejackets-hockey_large_square.png", primaryColor: "#0D358D", secondaryColor: "#FFFAFA" },
          "hill-murray": { name: "Hill-Murray", nickname: "Pioneers", logo: "https://cdn1.sportngin.com/attachments/team/7dd9-151803365/hill-murry_hockey_copy-_1__large_square.png", primaryColor: "#006E25", secondaryColor: "#121212" },
          "holy family": { name: "Holy Family", nickname: "Fire", logo: "https://cdn1.sportngin.com/attachments/team/3988-198880114/HF_Bold_White_large_square.png", primaryColor: "#24663C", secondaryColor: "#080A09" },
          "hopkins": { name: "Hopkins", nickname: "Royals", logo: "https://cdn2.sportngin.com/attachments/team/d52c-182981971/HopkinsLogo_large_square.png", primaryColor: "#000066", secondaryColor: "#CCCCCC" },
          "hutchinson": { name: "Hutchinson", nickname: "Tigers", logo: "https://cdn1.sportngin.com/attachments/team/c396-152074591/Untitled-1_large_square.png", primaryColor: "#000000", secondaryColor: "#FFCC00" },
          "international falls": { name: "International Falls", nickname: "Broncos", logo: "https://cdn3.sportngin.com/attachments/team/6a0d-151710440/3838833_i-falls_large_square.png", primaryColor: "#653B9F", secondaryColor: "#F7CD25" },
          "irondale": { name: "Irondale", nickname: "Knights", logo: "https://cdn1.sportngin.com/attachments/team/363a-151943354/1irondale-knights-hockey_large_square_large_square.png", primaryColor: "#680000", secondaryColor: "#FCCE00" },
          "kittson county central": { name: "Kittson County Central", nickname: "Bearcats", logo: "https://cdn2.sportngin.com/attachments/team/e3ec-151897016/New_Bearcat_large_square.png", primaryColor: "#185E0B", secondaryColor: "#929913" },
          "la crescent-hokah": { name: "La Crescent-Hokah", nickname: "Lancers", logo: "https://cdn1.sportngin.com/attachments/team/e415-151691131/new_la_crescent_large_square.png", primaryColor: "#048F63", secondaryColor: "#000000" },
          "lake of the woods": { name: "Lake of the Woods", nickname: "Bears", logo: "https://cdn2.sportngin.com/attachments/team/8885-151897288/LOTW_YouthHockeyLogo_large_large_square.png", primaryColor: "#59212E", secondaryColor: "#FDBA38" },
          "lakeville north": { name: "Lakeville North", nickname: "Panthers", logo: "https://cdn1.sportngin.com/attachments/team/28b7-149999593/Nordique_OFFICIAL_1_large_square.png", primaryColor: "#B21E23", secondaryColor: "#010101" },
          "lakeville south": { name: "Lakeville South", nickname: "Cougars", logo: "https://cdn2.sportngin.com/attachments/team/3538-149841646/Lakeville_South_cougar-_1__large_square.png", primaryColor: "#730D12", secondaryColor: "#C0B27F" },
          "litchfield/dassel-cokato": { name: "Litchfield/Dassel-Cokato", nickname: "Dragons", logo: "https://cdn3.sportngin.com/attachments/team/69b3-198879758/LDC-New1.png_large_square.png", primaryColor: "#155707", secondaryColor: "#000000" },
          "little falls": { name: "Little Falls", nickname: "Flyers", logo: "https://cdn1.sportngin.com/attachments/team/2cc5-151655376/1little_falls_2_large_square.png", primaryColor: "#7F00FF", secondaryColor: "#666666" },
          "luverne": { name: "Luverne", nickname: "Cardinals", logo: "https://cdn4.sportngin.com/attachments/team/7263-150040243/LuverneHockeyLogo_large_square.png", primaryColor: "#AB2132", secondaryColor: "#FFFFFF" },
          "mahtomedi": { name: "Mahtomedi", nickname: "Zephyrs", logo: "https://cdn3.sportngin.com/attachments/team/d0df-152162306/Mahtomedi-Zephyrs-Primary-M-Logo-1_large_square_large_square.png", primaryColor: "#00003B", secondaryColor: "#FFCC00" },
          "mankato east": { name: "Mankato East", nickname: "Cougars", logo: "https://cdn3.sportngin.com/attachments/team/3607-149918607/mankato-east-cougars-hockey_large_square.png", primaryColor: "#070202", secondaryColor: "#F8C602" },
          "mankato west": { name: "Mankato West", nickname: "Scarlets", logo: "https://cdn2.sportngin.com/attachments/team/928a-181704221/MankatoWestLogo-3_large_square.png", primaryColor: "#BD0000", secondaryColor: "#FFFFFF" },
          "maple grove": { name: "Maple Grove", nickname: "Crimson", logo: "https://cdn1.sportngin.com/attachments/team/0782-151913572/MG_Crimson-Gold-_2__large_square.png", primaryColor: "#A00008", secondaryColor: "#E6DB99" },
          "marshall": { name: "Marshall", nickname: "Tigers", logo: "https://cdn2.sportngin.com/attachments/team/a97c-150039767/MarshallLogo_large_square.png", primaryColor: "#000000", secondaryColor: "#D76106" },
          "minneapolis": { name: "Minneapolis", nickname: "Millers", logo: "https://cdn4.sportngin.com/attachments/team/78e4-151654134/1minneapolis-hockey_large_square.png", primaryColor: "#0E0F0E", secondaryColor: "#FFFFFF" },
          "minnesota river": { name: "Minnesota River", nickname: "Bulldogs", logo: "https://cdn2.sportngin.com/attachments/team/3123-150039289/MinnesotaRiverLogo_large_square.png", primaryColor: "#172EB0", secondaryColor: "#949292" },
          "minnetonka": { name: "Minnetonka", nickname: "Skippers", logo: "https://cdn3.sportngin.com/attachments/team/17b4-151725018/minnetonka-skippers-hockey-_1__large_square.png", primaryColor: "#063195", secondaryColor: "#FFFFFF" },
          "monticello": { name: "Monticello", nickname: "Moose", logo: "https://cdn3.sportngin.com/attachments/team/9e6b-151872724/monticello-moose-hockey_large_square.png", primaryColor: "#000000", secondaryColor: "#C30000" },
          "moorhead": { name: "Moorhead", nickname: "Spuds", logo: "https://cdn1.sportngin.com/attachments/team/e4a9-151779660/moorhead-spuds-hockey-_1__large_square.png", primaryColor: "#000000", secondaryColor: "#FF6600" },
          "moose lake area": { name: "Moose Lake Area", nickname: "Rebels", logo: "https://cdn2.sportngin.com/attachments/team/ac1f-152985919/Moose_Lake_boys__hockey_logo_version_large_square.png", primaryColor: "#D30000", secondaryColor: "#182DEB" },
          "mora/milaca": { name: "Mora/Milaca", nickname: "Mustangs", logo: "https://cdn4.sportngin.com/attachments/team/984b-167624178/MoraLogo4_large_square.png", primaryColor: "#031790", secondaryColor: "#0A0A0A" },
          "morris/benson area": { name: "Morris/Benson Area", nickname: "Storm", logo: "https://cdn2.sportngin.com/attachments/team/ff51-151690771/Morris_hockey_large_square.png", primaryColor: "#000000", secondaryColor: "#1E4BB6" },
          "mounds view": { name: "Mounds View", nickname: "Mustangs", logo: "https://cdn4.sportngin.com/attachments/team/8dac-151942574/0mounds-view-mustangs-hockey_large_square_large_square.png", primaryColor: "#045302", secondaryColor: "#FFFFFF" },
          "new prague": { name: "New Prague", nickname: "Trojans", logo: "https://cdn2.sportngin.com/attachments/team/a7b1-152073448/1new-prague-trojans-hockey_large_square_large_square.png", primaryColor: "#B21E23", secondaryColor: "#000000" },
          "new ulm": { name: "New Ulm", nickname: "Eagles", logo: "https://cdn4.sportngin.com/attachments/team/9a1e-150038859/NewUlmLogo_large_square.png", primaryColor: "#000000", secondaryColor: "#79078A" },
          "north shore": { name: "North Shore", nickname: "Storm", logo: "https://cdn4.sportngin.com/attachments/team/4ef9-151710721/north-shore-storm-hockey_large_square.png", primaryColor: "#070C14", secondaryColor: "#C0C0C0" },
          "northern edge": { name: "Northern Edge", nickname: "Red Bulls", logo: "https://cdn1.sportngin.com/attachments/team/b4f3-167547673/BlueNorthernEdgeLogo_large_square.png", primaryColor: "#E21F39", secondaryColor: "#00205B" },
          "northern lakes": { name: "Northern Lakes", nickname: "Lightning", logo: "https://cdn4.sportngin.com/attachments/team/21a2-168092682/NLLogonewest_large_square.png", primaryColor: "#000000", secondaryColor: "#FA0032" },
          "northfield": { name: "Northfield", nickname: "Raiders", logo: "https://cdn2.sportngin.com/attachments/team/efdc-152206539/northfield-raiders-hockey-_1__large_square.png", primaryColor: "#3B0000", secondaryColor: "#FFCC00" },
          "orono": { name: "Orono", nickname: "Spartans", logo: "https://cdn2.sportngin.com/attachments/team/0abe-151950248/1orono-spartans-hockey_large_square.png", primaryColor: "#0519B0", secondaryColor: "#D00000" },
          "osseo": { name: "Osseo", nickname: "Orioles", logo: "https://cdn4.sportngin.com/attachments/team/9565-151913934/osseo-orioles-hockey_large_square.png", primaryColor: "#000000", secondaryColor: "#DA5700" },
          "owatonna": { name: "Owatonna", nickname: "Huskies", logo: "https://cdn3.sportngin.com/attachments/team/2f12-149937828/logo_medium_large_square.png", primaryColor: "#37599D", secondaryColor: "#CCCCCC" },
          "park rapids": { name: "Park Rapids", nickname: "Panthers", logo: "https://cdn3.sportngin.com/attachments/team/6ca4-151863042/park-city-panthers-hockey_large_square.png", primaryColor: "#E8510D", secondaryColor: "#FCFCFC" },
          "park of cottage grove": { name: "Park of Cottage Grove", nickname: "Wolfpack", logo: "https://cdn3.sportngin.com/attachments/team/2948-151928700/1park-cottage-grove-wolfpack-hockey_large_square.png", primaryColor: "#000000", secondaryColor: "#017F01" },
          "pine city area": { name: "Pine City Area", nickname: "Dragons", logo: "https://cdn4.sportngin.com/attachments/team/7d3e-152070174/1pine-city-dragons-hockey_large_square_large_square.png", primaryColor: "#000000", secondaryColor: "#016230" },
          "prairie centre": { name: "Prairie Centre", nickname: "Cardinals", logo: "https://cdn1.sportngin.com/attachments/team/4d2f-151842392/prairie_centre_large_square.png", primaryColor: "#000000", secondaryColor: "#721A1D" },
          "princeton": { name: "Princeton", nickname: "Tigers", logo: "https://cdn2.sportngin.com/attachments/team/5eee-151872825/HighSchool_icon_C_large_square.png", primaryColor: "#000000", secondaryColor: "#D25D00" },
          "prior lake": { name: "Prior Lake", nickname: "Lakers", logo: "https://cdn1.sportngin.com/attachments/team/0580-151943997/prior-lake-lakers-hockey-_1__large_square_large_square.png", primaryColor: "#000035", secondaryColor: "#FFCC00" },
          "proctor": { name: "Proctor", nickname: "Rails", logo: "https://cdn1.sportngin.com/attachments/team/1c92-151768490/RailsHockeyCircleLogo_large_square.png", primaryColor: "#104C2A", secondaryColor: "#000000" },
          "providence academy": { name: "Providence Academy", nickname: "Lions", logo: "https://cdn3.sportngin.com/attachments/team/0233-151665883/providence-academy-lions-hockey_large_square.png", primaryColor: "#003A9C", secondaryColor: "#EEC60A" },
          "red lake falls": { name: "Red Lake Falls", nickname: "Eagles", logo: "https://cdn1.sportngin.com/attachments/team/d245-151887023/1Eagle_Hockey_-_white2_large_square.png", primaryColor: "#79078A", secondaryColor: "#000000" },
          "red wing": { name: "Red Wing", nickname: "Wingers", logo: "https://cdn2.sportngin.com/attachments/team/78ee-149965836/red-wing-wingers-hockey_large_square.png", primaryColor: "#811AD6", secondaryColor: "#000000" },
          "redwood valley": { name: "Redwood Valley", nickname: "Cardinals", logo: "https://cdn2.sportngin.com/attachments/team/0371-150042906/RedwoodValleyHockeyLogo_large_square.png", primaryColor: "#B60000", secondaryColor: "#000000" },
          "river lakes": { name: "River Lakes", nickname: "Stars", logo: "https://cdn3.sportngin.com/attachments/team/2772-151625544/12river-lakes-stars-hockey_large_square.png", primaryColor: "#B21E23", secondaryColor: "#000000" },
          "robbinsdale armstrong/cooper": { name: "Robbinsdale Armstrong/Cooper", nickname: "Wings", logo: "https://cdn4.sportngin.com/attachments/team/d4f2-151913653/robbinsdale-armstrong-cooper-wings-hockey-_1__large_square.png", primaryColor: "#E31422", secondaryColor: "#292642" },
          "rochester century/jm": { name: "Rochester Century/JM", nickname: "Panthers", logo: "https://cdn1.sportngin.com/attachments/team/e3f3-149937691/rochester-century-panthers-hockey_large_square.png", primaryColor: "#01017C", secondaryColor: "#CCCCCC" },
          "rochester lourdes": { name: "Rochester Lourdes", nickname: "Eagles", logo: "https://cdn1.sportngin.com/attachments/team/a6f4-151666477/Athletic_webimages7_large_square.png", primaryColor: "#330066", secondaryColor: "#FFE600" },
          "rochester mayo": { name: "Rochester Mayo", nickname: "Spartans", logo: "https://cdn1.sportngin.com/attachments/team/50c8-149937902/images_large_square.png", primaryColor: "#187018", secondaryColor: "#C5B358" },
          "rock ridge": { name: "Rock Ridge", nickname: "Wolverines", logo: "https://cdn4.sportngin.com/attachments/team/dc2f-166964797/RockRidgeLogo3_large_square.png", primaryColor: "#03520C", secondaryColor: "#000000" },
          "rogers": { name: "Rogers", nickname: "Royals", logo: "https://cdn4.sportngin.com/attachments/team/4697-151913761/rogers-royals-hockey-_1__large_square.png", primaryColor: "#0000FF", secondaryColor: "#000000" },
          "roseau": { name: "Roseau", nickname: "Rams", logo: "https://cdn4.sportngin.com/attachments/team/726d-151767657/1roseau-rams-hockey_large_square.png", primaryColor: "#265108", secondaryColor: "#FFFFFF" },
          "rosemount": { name: "Rosemount", nickname: "Irish", logo: "https://cdn2.sportngin.com/attachments/team/f4a2-199862227/R-with-Stick-Logo_large_square.png", primaryColor: "#000066", secondaryColor: "#00A302" },
          "roseville": { name: "Roseville", nickname: "Raiders", logo: "https://cdn3.sportngin.com/attachments/team/a555-151943684/0roseville-raiders-hockey_large_square_large_square.png", primaryColor: "#000000", secondaryColor: "#999999" },
          "sartell": { name: "Sartell", nickname: "Sabres", logo: "https://cdn2.sportngin.com/attachments/team/13e3-182346014/Scripted_S__large_square3_large_square.png", primaryColor: "#2953CF", secondaryColor: "#C6C6C6" },
          "sauk rapids-rice": { name: "Sauk Rapids-Rice", nickname: "Storm", logo: "https://cdn3.sportngin.com/attachments/team/4e55-152225527/stormbolt_large_square.png", primaryColor: "#00420F", secondaryColor: "#FFCF00" },
          "shakopee": { name: "Shakopee", nickname: "Sabers", logo: "https://cdn3.sportngin.com/attachments/team/62da-151937735/Saber_Head_PNG_large_square_large_square.png", primaryColor: "#5E0000", secondaryColor: "#CCCCCC" },
          "simley": { name: "Simley", nickname: "Spartans", logo: "https://cdn3.sportngin.com/attachments/team/caa0-151804224/simley-spartans-hockey_large_square.png", primaryColor: "#C01B10", secondaryColor: "#24266B" },
          "south st. paul": { name: "South St. Paul", nickname: "Packers", logo: "https://cdn1.sportngin.com/attachments/team/1c50-151805197/south-saint-paul-packers-hockey_large_square.png", primaryColor: "#800000", secondaryColor: "#CCCCCC" },
          "southwest christian/richfield": { name: "Southwest Christian/Richfield", nickname: "Stars", logo: "https://cdn3.sportngin.com/attachments/team/c8e8-182411031/SWChristianLogo3_large_square.png", primaryColor: "#8A171B", secondaryColor: "#CCCCCC" },
          "spring lake park/coon rapids": { name: "Spring Lake Park/Coon Rapids", nickname: "Panthers", logo: "https://cdn1.sportngin.com/attachments/team/fb06-206685309/slpcrlogo6_large_square.png", primaryColor: "#0000B7", secondaryColor: "#E60329" },
          "st. cloud": { name: "St. Cloud", nickname: "Crush", logo: "https://cdn1.sportngin.com/attachments/team/fc43-167481815/StCloudCrush_large_square.png", primaryColor: "#113595", secondaryColor: "#ED6E05" },
          "st. cloud cathedral": { name: "St. Cloud Cathedral", nickname: "Crusaders", logo: "https://cdn4.sportngin.com/attachments/team/511f-151688940/st-cloud-cathedral-crusaders-hockey_large_square.png", primaryColor: "#0D0DA3", secondaryColor: "#FCCC00" },
          "st. louis park": { name: "St. Louis Park", nickname: "Orioles", logo: "https://cdn1.sportngin.com/attachments/team/a531-151815462/1image001__2__large_square.png", primaryColor: "#000000", secondaryColor: "#D35400" },
          "st. michael-albertville": { name: "St. Michael-Albertville", nickname: "Knights", logo: "https://cdn4.sportngin.com/attachments/team/9003-151725125/STMA__1__large_square.png", primaryColor: "#0000D9", secondaryColor: "#FDE633" },
          "st. paul": { name: "St. Paul", nickname: "Blizzard", logo: "https://cdn1.sportngin.com/attachments/team/c436-213768835/StPaulLogo_large_square.png", primaryColor: "#0737A0", secondaryColor: "#FFFCFC" },
          "st. paul academy": { name: "St. Paul Academy", nickname: "Spartans", logo: "https://cdn3.sportngin.com/attachments/team/0993-151653521/1st-paul-academy-spartans-hockey_large_square.png", primaryColor: "#0A243B", secondaryColor: "#D5AA41" },
          "st. thomas academy": { name: "St. Thomas Academy", nickname: "Cadets", logo: "https://cdn4.sportngin.com/attachments/team/8ec8-151937343/1saint-thomas-cadets-hockey_large_square_large_square.png", primaryColor: "#000066", secondaryColor: "#CCCCCC" },
          "stillwater": { name: "Stillwater", nickname: "Ponies", logo: "https://cdn1.sportngin.com/attachments/team/17de-151928095/0Pony__6__large_square.png", primaryColor: "#000000", secondaryColor: "#BC0000" },
          "tartan": { name: "Tartan", nickname: "Titans", logo: "https://cdn1.sportngin.com/attachments/team/7247-214953542/Tartan_Logo_2025_large_square.JPG", primaryColor: "#0000C4", secondaryColor: "#151515" },
          "thief river falls": { name: "Thief River Falls", nickname: "Prowlers", logo: "https://cdn4.sportngin.com/attachments/team/a6fa-151779472/thief-river-falls-prowlers-hockey_large_square.png", primaryColor: "#0B1881", secondaryColor: "#FECE3E" },
          "totino-grace": { name: "Totino-Grace", nickname: "Eagles", logo: "https://cdn3.sportngin.com/attachments/team/88eb-151913716/totino-grace-eagles-hockey-_1__large_square.png", primaryColor: "#000066", secondaryColor: "#FFCC00" },
          "two rivers": { name: "Two Rivers", nickname: "Warriors", logo: "https://cdn2.sportngin.com/attachments/team/0e90-182415323/TwoRiversLogo3_large_square.png", primaryColor: "#D30F2D", secondaryColor: "#999999" },
          "waconia": { name: "Waconia", nickname: "Wildcats", logo: "https://cdn1.sportngin.com/attachments/team/3eb4-152073575/1Waconia_W_Transparent_large_square_large_square.png", primaryColor: "#1F0C5B", secondaryColor: "#F1F908" },
          "wadena-deer creek": { name: "Wadena-Deer Creek", nickname: "Wolverines", logo: "https://cdn2.sportngin.com/attachments/team/e736-151840823/1wadena-deer-river-wolverines_large_square.png", primaryColor: "#000066", secondaryColor: "#EDCB7D" },
          "warroad": { name: "Warroad", nickname: "Warriors", logo: "https://cdn3.sportngin.com/attachments/team/c497-151779196/warroad-warriors-hockey_large_square.png", primaryColor: "#000000", secondaryColor: "#F9B400" },
          "waseca": { name: "Waseca", nickname: "Bluejays", logo: "https://cdn1.sportngin.com/attachments/team/ccad-150040363/WasecaHockeyLogo_large_square.png", primaryColor: "#102366", secondaryColor: "#F9D018" },
          "wayzata": { name: "Wayzata", nickname: "Trojans", logo: "https://cdn1.sportngin.com/attachments/team/5fbc-151725085/wayzata-trojans-hockey-_1__large_square.png", primaryColor: "#0000FF", secondaryColor: "#FFCC00" },
          "westonka": { name: "Westonka", nickname: "White Hawks", logo: "https://cdn4.sportngin.com/attachments/team/2e80-214965059/Westonka3_large_square.png", primaryColor: "#DD2219", secondaryColor: "#FFFFFF" },
          "white bear lake": { name: "White Bear Lake", nickname: "Bears", logo: "https://cdn3.sportngin.com/attachments/team/b32f-151942054/0white-bear-lake-bears-hockey_large_square_large_square.png", primaryColor: "#000000", secondaryColor: "#FF6600" },
          "willmar": { name: "Willmar", nickname: "Cardinals", logo: "https://cdn2.sportngin.com/attachments/team/364d-151626458/1willmar-cardinals-hockey_large_square.png", primaryColor: "#DD2226", secondaryColor: "#FFFFFF" },
          "windom": { name: "Windom", nickname: "Eagles", logo: "https://cdn1.sportngin.com/attachments/team/c4b0-214590596/Eagle-Mascot-Only2_large_square.png", primaryColor: "#05539B", secondaryColor: "#FCEE07" },
          "winona": { name: "Winona", nickname: "Winhawks", logo: "https://cdn3.sportngin.com/attachments/team/2400-149919147/winona-hawks-hockey_large_square.png", primaryColor: "#000000", secondaryColor: "#DF5D1F" },
          "woodbury": { name: "Woodbury", nickname: "Royals", logo: "https://cdn2.sportngin.com/attachments/team/946d-151943495/1woodbury-royals-hockey_large_square_large_square.png", primaryColor: "#023399", secondaryColor: "#FFFFFF" },
          "worthington": { name: "Worthington", nickname: "Trojans", logo: "https://cdn4.sportngin.com/attachments/team/0122-150042417/worthington-trojans-hockey_large_square.png", primaryColor: "#9C0202", secondaryColor: "#000000" }
        };

        // Team lookup function with fuzzy matching
        const lookupTeam = (searchName) => {
          if (!searchName) return null;
          
          const normalizedSearch = searchName.toLowerCase().trim();
          
          // Direct match
          if (MSHSL_TEAMS[normalizedSearch]) {
            return MSHSL_TEAMS[normalizedSearch];
          }
          
          // Try variations
          const variations = [
            normalizedSearch,
            normalizedSearch.replace(/[^a-z\s]/g, ''),  // Remove special chars
            normalizedSearch.replace(/-/g, ' '),        // Replace hyphens with spaces
            normalizedSearch.replace(/\//g, ' '),       // Replace slashes with spaces
            normalizedSearch.split(' ')[0],             // First word only
          ];
          
          for (const variant of variations) {
            // Check if any key contains this variant
            for (const [key, team] of Object.entries(MSHSL_TEAMS)) {
              if (key.includes(variant) || variant.includes(key)) {
                return team;
              }
              // Also check the team name
              if (team.name.toLowerCase().includes(variant)) {
                return team;
              }
            }
          }
          
          return null;
        };

        // Get sorted list of teams for dropdown
        const getTeamList = () => {
          return Object.values(MSHSL_TEAMS).sort((a, b) => a.name.localeCompare(b.name));
        };
        // ============================================================

        const HockeyLinesChart = () => {
          // Initialize myTeamSetup from EMBEDDED_CONFIG if in subscriber mode
          const getInitialTeamSetup = () => {
            if (SUBSCRIBER_MODE && EMBEDDED_CONFIG?.teamSetup) {
              console.log('ðŸ’ SUBSCRIBER MODE: Loading embedded team config');
              return EMBEDDED_CONFIG.teamSetup;
            }
            
            // Master site: try to load from localStorage first
            try {
              const saved = localStorage.getItem('myTeamSetup');
              if (saved) {
                console.log('ðŸ“‹ Loading saved myTeamSetup from localStorage');
                return JSON.parse(saved);
              }
            } catch (error) {
              console.error('Error loading saved myTeamSetup:', error);
            }
            
            // Default for master site if nothing saved
            return {
              teamName: 'Delano Tigers',
              logo: null,
              colors: { primary: '#fb923c', secondary: '#1f2937' },
              arena: '',
              careerStats: {},
              pronunciations: {},
              careerSeasonData: {
                season1: '',
                season2: '',
                season3: ''
              }
            };
          };
          
          const [myTeamSetup, setMyTeamSetup] = useState(getInitialTeamSetup);

          // Initialize myTeamData from localStorage
          const getInitialMyTeamData = () => {
            try {
              const saved = localStorage.getItem('hockey-scout-myTeamData');
              if (saved) {
                console.log('ðŸ“‹ Loading saved myTeamData from localStorage');
                return JSON.parse(saved);
              }
            } catch (error) {
              console.error('Error loading saved myTeamData:', error);
            }
            return {
              teamName: '',
              nickname: '',
              record: { w: 0, l: 0, t: 0 },
              section: '2A',
              conference: 'WCC',
              stats: { ppPct: 0, pkPct: 0, gpg: 0, gapg: 0 },
              roster: [],
              nextGame: { gameNum: '', opponent: '', date: '', location: '', oppRecord: '', oppSection: '', oppConference: '' },
              currentGame: { gameNum: '', opponent: '', date: '', time: '', location: '', isHome: false },
              headCoach: { name: '', careerRecord: { w: 0, l: 0, t: 0 }, seasonRecord: { w: 0, l: 0, t: 0 } },
              assistantCoaches: [],
              studentManager: '',
              injuries: []
            };
          };

          const [myTeamData, setMyTeamData] = useState(getInitialMyTeamData);

          const [opponentData, setOpponentData] = useState({
            teamName: '',
            nickname: '',
            record: { w: 0, l: 0, t: 0 },
            section: '',
            conference: '',
            stats: { ppPct: 0, pkPct: 0, gpg: 0, gapg: 0 },
            roster: [],
            headCoach: { name: '', careerRecord: { w: 0, l: 0, t: 0 }, seasonRecord: { w: 0, l: 0, t: 0 } },
            assistantCoaches: []
          });

          // Initialize lines from localStorage
          const getInitialLines = () => {
            try {
              const saved = localStorage.getItem('hockey-scout-lines');
              if (saved) {
                console.log('ðŸ“‹ Loading saved line assignments from localStorage');
                return JSON.parse(saved);
              }
            } catch (error) {
              console.error('Error loading saved lines:', error);
            }
            return {
              line1: { lw: null, c: null, rw: null, color: 'GREEN' },
              line2: { lw: null, c: null, rw: null, color: 'RED' },
              line3: { lw: null, c: null, rw: null, color: 'BLUE' },
              line4: { lw: null, c: null, rw: null, color: 'YELLOW' },
              d1: { ld: null, rd: null, color: 'GREEN' },
              d2: { ld: null, rd: null, color: 'RED' },
              d3: { ld: null, rd: null, color: 'BLUE' },
              goalies: { starter: null, starterColor: 'YELLOW', backup: null, backupColor: 'WHITE' }
            };
          };

          const [lines, setLines] = useState(getInitialLines);

          const [coachNotes, setCoachNotes] = useState({
            pk: '',
            pp: '',
            scoutNotes: { powerPlay: '', penaltyKill: '', keyPlayers: '' },
            showScoutNotes: true
          });
          
          const [diagramImages, setDiagramImages] = useState({
            image1: null,
            image2: null,
            image3: null
          });

          const [showSetup, setShowSetup] = useState(false);
          const [showCareerStats, setShowCareerStats] = useState(false);
          const [showPronunciations, setShowPronunciations] = useState(false);
          const [showImport, setShowImport] = useState(false);
          const [showExport, setShowExport] = useState(false);
          const [exportData, setExportData] = useState('');
          const [showHelp, setShowHelp] = useState(false);
          const [helpContent, setHelpContent] = useState({ title: '', steps: [] });
          const [importStep, setImportStep] = useState('myTeamHome');
          const [importText, setImportText] = useState('');
          const [spreadsheetData, setSpreadsheetData] = useState([]);
          const [spreadsheetHeaders, setSpreadsheetHeaders] = useState([]);
          const [selectedPlayer, setSelectedPlayer] = useState(null);
          const [opponentLogo, setOpponentLogo] = useState(null);
          const [opponentColors, setOpponentColors] = useState({ primary: '#dc2626', secondary: '#991b1b' });
          const [careerStatsImport, setCareerStatsImport] = useState(() => {
            if (SUBSCRIBER_MODE && EMBEDDED_CONFIG?.careerSeasonData) {
              return {
                lastSeason: EMBEDDED_CONFIG.careerSeasonData.season1 || '',
                twoSeasonsAgo: EMBEDDED_CONFIG.careerSeasonData.season2 || '',
                threeSeasonsAgo: EMBEDDED_CONFIG.careerSeasonData.season3 || ''
              };
            }
            return {
              lastSeason: '',
              twoSeasonsAgo: '',
              threeSeasonsAgo: ''
            };
          });

          const colorOptions = ['GREEN', 'RED', 'BLUE', 'YELLOW', 'WHITE', 'BLACK', 'DARK GRAY', 'LIGHT GRAY', 'BURNT ORANGE', 'DEEP PURPLE', 'MAROON', 'NAVY', 'GOLD'];
          const colorClasses = {
            'GREEN': 'bg-green-100 border-green-600',
            'RED': 'bg-red-100 border-red-600',
            'BLUE': 'bg-blue-100 border-blue-600',
            'YELLOW': 'bg-yellow-100 border-yellow-600',
            'WHITE': 'bg-white border-gray-800',
            'BLACK': 'bg-gray-900 border-gray-900',
            'DARK GRAY': 'bg-gray-600 border-gray-800',
            'LIGHT GRAY': 'bg-gray-200 border-gray-500',
            'BURNT ORANGE': 'bg-orange-200 border-orange-700',
            'DEEP PURPLE': 'bg-purple-200 border-purple-700',
            'MAROON': 'bg-red-200 border-red-900',
            'NAVY': 'bg-blue-200 border-blue-900',
            'GOLD': 'bg-yellow-200 border-yellow-700'
          };

          const importSteps = [
            { key: 'myTeamHome', label: 'My Team - Legacy Home', team: 'mine' },
            { key: 'myTeamRoster', label: 'My Team - Legacy Roster', team: 'mine' },
            { key: 'myTeamPlayerStats', label: 'My Team - Legacy Player Stats', team: 'mine' },
            { key: 'oppTeamSelect', label: 'Opponent - Select Team', team: 'opponent', isTeamSelect: true },
            { key: 'oppHome', label: 'Opponent - Legacy Home', team: 'opponent' },
            { key: 'oppRoster', label: 'Opponent - Legacy Roster', team: 'opponent' },
            { key: 'oppPlayerStats', label: 'Opponent - Legacy Player Stats', team: 'opponent' }
          ];

          // Help content for different sections
          const helpContents = {
            careerStats: {
              title: 'How to Import Career Stats',
              steps: [
                "Navigate to Legacy Hockey website",
                "Go to your team's Player Stats page for the {season} season",
                "Press Ctrl+A (Windows) or Command+A (Mac) to select all content",
                "Press Ctrl+C (Windows) or Command+C (Mac) to copy",
                "Return to Legacy Lines and paste here with Ctrl+V (Windows) or Command+V (Mac)"
              ]
            },
            myTeamHome: {
              title: 'How to Import Home Page Data',
              steps: [
                "Navigate to Legacy Hockey website",
                "Go to YOUR team's Home page",
                "Select all content (Ctrl+A or Command+A)",
                "Copy (Ctrl+C or Command+C)",
                "Return here and paste (Ctrl+V or Command+V)"
              ]
            },
            myTeamRoster: {
              title: 'How to Import Roster',
              steps: [
                "Go to your team's Roster page on Legacy Hockey",
                "Select all content (Ctrl+A or Command+A)",
                "Copy (Ctrl+C or Command+C)",
                "Return here and paste (Ctrl+V or Command+V)"
              ]
            },
            myTeamPlayerStats: {
              title: 'How to Import Player Stats',
              steps: [
                "Go to your team's Player Stats page on Legacy Hockey",
                "Select all content (Ctrl+A or Command+A)",
                "Copy (Ctrl+C or Command+C)",
                "Return here and paste (Ctrl+V or Command+V)"
              ]
            },
            oppHome: {
              title: 'How to Import Opponent Home Page Data',
              steps: [
                "Navigate to Legacy Hockey website",
                "Go to OPPONENT team Home page",
                "Select all content (Ctrl+A or Command+A)",
                "Copy (Ctrl+C or Command+C)",
                "Return here and paste (Ctrl+V or Command+V)"
              ]
            },
            oppRoster: {
              title: 'How to Import Opponent Roster',
              steps: [
                "Go to opponent team Roster page on Legacy Hockey",
                "Select all content (Ctrl+A or Command+A)",
                "Copy (Ctrl+C or Command+C)",
                "Return here and paste (Ctrl+V or Command+V)"
              ]
            },
            oppPlayerStats: {
              title: 'How to Import Opponent Player Stats',
              steps: [
                "Go to opponent team Player Stats page on Legacy Hockey",
                "Select all content (Ctrl+A or Command+A)",
                "Copy (Ctrl+C or Command+C)",
                "Return here and paste (Ctrl+V or Command+V)"
              ]
            }
          };

          // Load saved setup on mount
          useEffect(() => {
            // In subscriber mode, initialize from embedded config
            if (SUBSCRIBER_MODE && EMBEDDED_CONFIG) {
              console.log('ðŸ’ SUBSCRIBER MODE: Initializing from embedded config');
              
              // Initialize career stats in localStorage from embedded config
              if (EMBEDDED_CONFIG.teamSetup?.careerStats && Object.keys(EMBEDDED_CONFIG.teamSetup.careerStats).length > 0) {
                localStorage.setItem('hockey-scout-career-stats', JSON.stringify(EMBEDDED_CONFIG.teamSetup.careerStats));
                console.log('ðŸ“¦ Loaded', Object.keys(EMBEDDED_CONFIG.teamSetup.careerStats).length, 'embedded career stat records');
              }
            }
            // Note: myTeamSetup is now loaded via getInitialTeamSetup() instead of here
          }, []);

          // Save setup to localStorage whenever it changes
          useEffect(() => {
            try {
              localStorage.setItem('myTeamSetup', JSON.stringify(myTeamSetup));
            } catch (error) {
              console.error('Error saving setup:', error);
            }
          }, [myTeamSetup]);

          // Save lines to localStorage whenever they change
          useEffect(() => {
            try {
              localStorage.setItem('hockey-scout-lines', JSON.stringify(lines));
              console.log('ðŸ’¾ Saved line assignments to localStorage');
            } catch (error) {
              console.error('Error saving lines:', error);
            }
          }, [lines]);

          // Save myTeamData to localStorage whenever it changes
          useEffect(() => {
            try {
              localStorage.setItem('hockey-scout-myTeamData', JSON.stringify(myTeamData));
              console.log('ðŸ’¾ Saved myTeamData to localStorage');
            } catch (error) {
              console.error('Error saving myTeamData:', error);
            }
          }, [myTeamData]);

          // Helper Functions
          const openHelp = (type, season = '') => {
            let content = { ...helpContents[type] };
            if (season) {
              content.steps = content.steps.map(step => step.replace('{season}', season));
            }
            setHelpContent(content);
            setShowHelp(true);
          };

          // Sync line assignments with updated roster - update stats, remove missing players
          const syncLinesWithRoster = (newRoster) => {
            console.log('ðŸ”„ Syncing line assignments with updated roster...');
            const rosterIds = new Set(newRoster.map(p => p.id));
            
            setLines(prevLines => {
              const updatedLines = { ...prevLines };
              let removedCount = 0;
              let updatedCount = 0;
              
              Object.keys(updatedLines).forEach(lineKey => {
                const line = updatedLines[lineKey];
                Object.keys(line).forEach(posKey => {
                  const player = line[posKey];
                  if (player && typeof player === 'object' && player.id) {
                    // Check if player still exists on roster
                    if (!rosterIds.has(player.id)) {
                      console.log(`âŒ Removing ${player.name} from ${lineKey}.${posKey} - no longer on roster`);
                      updatedLines[lineKey] = { ...updatedLines[lineKey], [posKey]: null };
                      removedCount++;
                    } else {
                      // Update player stats from new roster
                      const updatedPlayer = newRoster.find(p => p.id === player.id);
                      if (updatedPlayer) {
                        console.log(`âœ“ Updating stats for ${player.name} in ${lineKey}.${posKey}`);
                        updatedLines[lineKey] = { ...updatedLines[lineKey], [posKey]: updatedPlayer };
                        updatedCount++;
                      }
                    }
                  }
                });
              });
              
              console.log(`ðŸ“Š Line sync complete: ${updatedCount} players updated, ${removedCount} removed`);
              return updatedLines;
            });
          };

          const getSeasonYears = () => {
            const now = new Date();
            const currentYear = now.getFullYear();
            const currentMonth = now.getMonth();
            
            let seasonStartYear;
            if (currentMonth >= 5) {
              seasonStartYear = currentYear - 1;
            } else {
              seasonStartYear = currentYear - 2;
            }
            
            return {
              season1: `${seasonStartYear}-${seasonStartYear + 1}`,
              season2: `${seasonStartYear - 1}-${seasonStartYear}`,
              season3: `${seasonStartYear - 2}-${seasonStartYear - 1}`
            };
          };

          // Export Team Configuration for subscriber builds
          const handleExportConfig = () => {
            // Get career stats from localStorage
            let storedCareerStats = {};
            try {
              const stored = localStorage.getItem('hockey-scout-career-stats');
              if (stored) {
                storedCareerStats = JSON.parse(stored);
                console.log('ðŸ“¦ Export: Including', Object.keys(storedCareerStats).length, 'career stat records');
              }
            } catch (e) {
              console.error('Error reading career stats:', e);
            }
            
            const exportObj = {
              _exportInfo: {
                exportDate: new Date().toISOString(),
                version: '3.1',
                teamName: myTeamSetup.teamName,
                description: 'Full team configuration for subscriber site build'
              },
              myTeamSetup: {
                teamName: myTeamSetup.teamName,
                logo: myTeamSetup.logo,
                colors: myTeamSetup.colors,
                arena: myTeamSetup.arena,
                // Career stats from localStorage (not from myTeamSetup)
                careerStats: storedCareerStats,
                // Pronunciations always empty for subscribers - they add their own
                pronunciations: {}
              },
              // Include raw career season paste data
              careerSeasonData: {
                season1: careerStatsImport.lastSeason || '',
                season2: careerStatsImport.twoSeasonsAgo || '',
                season3: careerStatsImport.threeSeasonsAgo || ''
              }
            };
            
            const jsonString = JSON.stringify(exportObj, null, 2);
            setExportData(jsonString);
            setShowExport(true);
          };

          const copyExportToClipboard = () => {
            navigator.clipboard.writeText(exportData).then(() => {
              alert('Configuration copied to clipboard! Send this to Claude to build your subscriber version.');
            }).catch(err => {
              console.error('Failed to copy:', err);
            });
          };

          const isSpreadsheetStep = (step) => {
            return false;
          };

          const handleSpreadsheetPaste = (text) => {
            console.log('=== Parsing spreadsheet paste ===');
            console.log('Raw text length:', text.length);
            
            const lines = text.split('\n').filter(l => l.trim());
            const rows = lines.map(line => line.split('\t'));
            
            if (rows.length > 0) {
              setSpreadsheetHeaders(rows[0]);
              setSpreadsheetData(rows.slice(1));
            }
          };

          const processSpreadsheetStats = (headers, data, existingRoster) => {
            const getColIndex = (possibleNames) => {
              return headers.findIndex(h => possibleNames.some(name => 
                h.toLowerCase().includes(name.toLowerCase())
              ));
            };
            
            const numCol = getColIndex(['#', 'number']);
            const nameCol = getColIndex(['name', 'player']);
            const gpCol = getColIndex(['gp']);
            const gCol = getColIndex(['g', 'goals']) !== -1 && !headers[getColIndex(['g', 'goals'])].toLowerCase().includes('ga') ? getColIndex(['g', 'goals']) : -1;
            const aCol = getColIndex(['a', 'assists']);
            const ptsCol = getColIndex(['pts', 'points']);
            const ppgCol = getColIndex(['ppg']);
            const ppaCol = getColIndex(['ppa']);
            const shCol = getColIndex(['sh']);
            const shaCol = getColIndex(['sha']);
            const pimCol = getColIndex(['pim', 'pen']);
            const plusMinusCol = getColIndex(['+/-', 'plus', 'minus']);
            const fowCol = getColIndex(['fow']);
            const folCol = getColIndex(['fol']);
            
            const updatedRoster = existingRoster.map(player => {
              const matchingRow = data.find(row => {
                const rowName = nameCol >= 0 ? row[nameCol] : '';
                const rowNum = numCol >= 0 ? row[numCol] : '';
                return rowName.includes(player.lastName) || rowNum === player.number;
              });
              
              if (matchingRow) {
                return {
                  ...player,
                  stats: {
                    gp: gpCol >= 0 ? parseInt(matchingRow[gpCol]) || 0 : 0,
                    g: gCol >= 0 ? parseInt(matchingRow[gCol]) || 0 : 0,
                    a: aCol >= 0 ? parseInt(matchingRow[aCol]) || 0 : 0,
                    pts: ptsCol >= 0 ? parseInt(matchingRow[ptsCol]) || 0 : 0,
                    ppg: ppgCol >= 0 ? parseInt(matchingRow[ppgCol]) || 0 : 0,
                    ppa: ppaCol >= 0 ? parseInt(matchingRow[ppaCol]) || 0 : 0,
                    sh: shCol >= 0 ? parseInt(matchingRow[shCol]) || 0 : 0,
                    sha: shaCol >= 0 ? parseInt(matchingRow[shaCol]) || 0 : 0,
                    pim: pimCol >= 0 ? parseInt(matchingRow[pimCol]) || 0 : 0,
                    plusMinus: plusMinusCol >= 0 ? parseInt(matchingRow[plusMinusCol]) || 0 : 0,
                    fow: fowCol >= 0 ? parseInt(matchingRow[fowCol]) || 0 : 0,
                    fol: folCol >= 0 ? parseInt(matchingRow[folCol]) || 0 : 0
                  }
                };
              }
              
              return player;
            });
            
            return updatedRoster;
          };

          // Career Stats localStorage helpers
          const saveCareerStatsToStorage = (roster) => {
            try {
              const careerData = {};
              roster.forEach(player => {
                // Use first 3 chars of first name to distinguish siblings (e.g., MCCABE_JON vs MCCABE_JOE)
                const firstNameKey = player.firstName?.substring(0, 3)?.toUpperCase() || '';
                const key = `${player.lastName?.toUpperCase()}_${firstNameKey}`;
                
                if (player.baseCareerStats && player.baseCareerStats.gp > 0) {
                  careerData[key] = {
                    type: 'skater',
                    data: player.baseCareerStats
                  };
                }
                
                if (player.baseCareerGoalieStats && player.baseCareerGoalieStats.gp > 0) {
                  careerData[key] = {
                    type: 'goalie',
                    data: player.baseCareerGoalieStats
                  };
                }
              });
              
              localStorage.setItem('hockey-scout-career-stats', JSON.stringify(careerData));
              console.log('ðŸ’¾ Saved career stats to localStorage:', Object.keys(careerData).length, 'players');
            } catch (error) {
              console.error('Error saving career stats:', error);
            }
          };
          
          const loadCareerStatsFromStorage = (roster) => {
            try {
              console.log('ðŸ” loadCareerStatsFromStorage CALLED with roster size:', roster.length);
              const stored = localStorage.getItem('hockey-scout-career-stats');
              
              if (!stored) {
                console.log('â„¹ No career stats in localStorage');
                return roster;
              }
              
              const careerData = JSON.parse(stored);
              console.log('ðŸ“‚ Loading career stats from localStorage:', Object.keys(careerData).length, 'players');
              
              return roster.map(player => {
                // Use first 3 chars of first name to distinguish siblings (e.g., MCCABE_JON vs MCCABE_JOE)
                const firstNameKey = player.firstName?.substring(0, 3)?.toUpperCase() || '';
                const key = `${player.lastName?.toUpperCase()}_${firstNameKey}`;
                const savedCareer = careerData[key];
                
                if (savedCareer) {
                  if (player.position === 'G' && savedCareer.type === 'goalie') {
                    player.baseCareerGoalieStats = savedCareer.data;
                    
                    // Calculate GAA and SVP for display
                    const parseMinutes = (minStr) => {
                      const parts = minStr.split(':');
                      return parseInt(parts[0]) * 60 + parseInt(parts[1] || 0);
                    };
                    const totalSeconds = parseMinutes(savedCareer.data.min || '0:00');
                    const totalMinutes = totalSeconds / 60;
                    const totalGA = savedCareer.data.ga || 0;
                    const totalSV = savedCareer.data.sv || 0;
                    const totalSOG = totalGA + totalSV;
                    
                    player.careerGoalieStats = {
                      ...savedCareer.data,
                      gaa: totalMinutes > 0 ? parseFloat((totalGA / (totalMinutes / 51)).toFixed(2)) : 0,
                      svp: totalSOG > 0 ? (totalSV / totalSOG).toFixed(3) : '.000'
                    };
                    console.log(`âœ“ Loaded GOALIE career for ${player.name}`);
                  } else if (savedCareer.type === 'skater') {
                    player.baseCareerStats = savedCareer.data;
                    
                    // Calculate faceoff % for display
                    const totalFOW = savedCareer.data.fow || 0;
                    const totalFOL = savedCareer.data.fol || 0;
                    player.careerStats = {
                      ...savedCareer.data,
                      faceoffPct: (totalFOW + totalFOL > 0) ? ((totalFOW / (totalFOW + totalFOL)) * 100).toFixed(1) : '0.0',
                      pim: savedCareer.data.pim || 0
                    };
                    console.log(`âœ“ Loaded SKATER career for ${player.name}`);
                  }
                }
                
                return player;
              });
            } catch (error) {
              console.error('Error loading career stats:', error);
              return roster;
            }
          };

          // Parsing Functions
          const parseHomePage = (text) => {
            try {
              const lines = text.split('\n').map(l => l.trim()).filter(l => l);
              let teamName = '';
              let nickname = '';
              let record = { w: 0, l: 0, t: 0 };
              let section = '';
              let conference = '';
              let headCoach = { name: '', careerRecord: { w: 0, l: 0, t: 0 }, seasonRecord: { w: 0, l: 0, t: 0 } };
              
              console.log('ðŸ“‹ ========== PARSING HOME PAGE ==========');
              console.log('ðŸ“‹ Total lines:', lines.length);
              
              // Find team name
              const subscribeIdx = lines.findIndex(l => l === 'Subscribe');
              if (subscribeIdx >= 0 && subscribeIdx + 1 < lines.length) {
                const potentialName = lines[subscribeIdx + 1];
                // Team name should be a substantial word, not a menu item
                if (potentialName && potentialName.length > 2 && 
                    !potentialName.includes('Home') && 
                    !potentialName.includes('Roster') &&
                    !potentialName.includes('Game') && 
                    !potentialName.includes('Â©') &&
                    !potentialName.includes('SportsEngine') &&
                    !potentialName.includes('powered by')) {
                  teamName = potentialName;
                  console.log('âœ… Found team name:', teamName);
                }
              }
              
              // If still no team name, look for it before "Home" menu item
              if (!teamName) {
                const homeIdx = lines.findIndex(l => l === 'Home');
                if (homeIdx > 0) {
                  const potentialName = lines[homeIdx - 1];
                  if (potentialName && potentialName.length > 2 && !potentialName.includes('Â©') &&
                      !potentialName.includes('SportsEngine') &&
                      !potentialName.includes('powered by')) {
                    teamName = potentialName;
                    console.log('âœ… Found team name (before Home):', teamName);
                  }
                }
              }
              
              // Find nickname
              const nicknameIdx = lines.findIndex(l => l.startsWith('Nickname:'));
              if (nicknameIdx >= 0) {
                nickname = lines[nicknameIdx].split(':')[1]?.trim() || '';
                console.log('âœ… Found nickname:', nickname);
              }
              
              // Find Home Arena (for My Team Setup)
              let homeArena = '';
              const homeArenaIdx = lines.findIndex(l => l.startsWith('Home Arena:'));
              if (homeArenaIdx >= 0) {
                homeArena = lines[homeArenaIdx].split('Home Arena:')[1]?.trim() || '';
                console.log('âœ… Found Home Arena:', homeArena);
              }
              
              // Find team record
              for (let i = 0; i < lines.length; i++) {
                if (lines[i].includes('Team Record') || lines[i] === 'W L T') {
                  for (let j = i + 1; j < i + 5 && j < lines.length; j++) {
                    const parts = lines[j]?.split(/\s+/);
                    if (parts && parts.length >= 3 && /^\d+$/.test(parts[0]) && /^\d+$/.test(parts[1]) && /^\d+$/.test(parts[2])) {
                      record = { w: parseInt(parts[0]), l: parseInt(parts[1]), t: parseInt(parts[2]) };
                      console.log('âœ… Found team record:', record);
                      break;
                    }
                  }
                  if (record.w > 0 || record.l > 0 || record.t > 0) break;
                }
              }
              
              // Find head coach
              const coachIdx = lines.findIndex(l => l.includes('Head Coach'));
              if (coachIdx >= 0) {
                let coachNameFound = false;
                for (let i = coachIdx + 1; i < coachIdx + 10 && i < lines.length; i++) {
                  const line = lines[i];
                  
                  // First, look for "overall" record pattern (e.g., "19th overall, 222-229-18")
                  const overallMatch = line.match(/(\d+)(?:st|nd|rd|th)?\s+overall[,\s]+(\d+)-(\d+)-(\d+)/i);
                  // Fallback to regular year/season record pattern
                  const careerMatch = line.match(/(\d+)(?:st|nd|rd|th)?\s+(?:season|year)[,\s]+(\d+)-(\d+)-(\d+)/i);
                  
                  if (overallMatch || careerMatch) {
                    if (!coachNameFound && i > coachIdx + 1) {
                      headCoach.name = lines[i - 1];
                      coachNameFound = true;
                    }
                    // Prefer overall record if available, otherwise use career/year record
                    const matchToUse = overallMatch || careerMatch;
                    headCoach.careerRecord = { 
                      w: parseInt(matchToUse[2]), 
                      l: parseInt(matchToUse[3]), 
                      t: parseInt(matchToUse[4]) 
                    };
                    console.log('âœ… Found head coach:', headCoach.name, 'with career record:', headCoach.careerRecord, overallMatch ? '(using overall)' : '(using year)');
                    break;
                  } else if (line.includes('1st Year') || line.includes('1st year') || line.match(/^1st\s+(?:season|year)/i)) {
                    if (!coachNameFound && i > coachIdx + 1) {
                      headCoach.name = lines[i - 1];
                    }
                    headCoach.careerRecord = { w: 0, l: 0, t: 0 };
                    console.log('âœ… Found first-year head coach:', headCoach.name);
                    break;
                  } else if (!coachNameFound && line && !line.includes('Head Coach') && line.length > 2 && !line.includes('Phone:')) {
                    headCoach.name = line;
                    coachNameFound = true;
                  }
                }
                
                headCoach.seasonRecord = { ...record };
              }
              
              const sectionIdx = lines.findIndex(l => l.includes('Section:'));
              if (sectionIdx >= 0) {
                section = lines[sectionIdx].split(':')[1]?.trim() || '';
              }
              
              const confIdx = lines.findIndex(l => l.includes('Conference:'));
              if (confIdx >= 0) {
                conference = lines[confIdx].split(':')[1]?.trim() || '';
              }
              
              // Parse Assistant Coaches
              let assistantCoaches = [];
              const assistantIdx = lines.findIndex(l => l.includes('Assistant Coaches:'));
              if (assistantIdx >= 0) {
                const assistantLine = lines[assistantIdx];
                const coachesPart = assistantLine.split('Assistant Coaches:')[1]?.trim();
                if (coachesPart) {
                  assistantCoaches = coachesPart.split(',').map(name => name.trim()).filter(name => name);
                }
              }
              
              // Parse Student Managers
              let studentManager = '';
              const managerIdx = lines.findIndex(l => l.includes('Student Managers:') || l.includes('Student Manager:'));
              if (managerIdx >= 0) {
                const managerLine = lines[managerIdx];
                const managersPart = managerLine.split(/Student Managers?:/)[1]?.trim();
                if (managersPart) {
                  studentManager = managersPart;
                  console.log('âœ… Found student managers:', studentManager);
                }
              }
              
              // Parse stats
              let stats = { ppPct: 0, pkPct: 0, gpg: 0, gapg: 0 };
              for (let i = 0; i < lines.length; i++) {
                const parts = lines[i].split(/\s+/);
                if (parts.length >= 10 && parts[0].match(/\d+/)) {
                  stats.gpg = parseFloat(parts[3]) || 0;
                  stats.gapg = parseFloat(parts[4]) || 0;
                  stats.ppPct = parseFloat(parts[6]) || 0;
                  stats.pkPct = parseFloat(parts[9]) || 0;
                  break;
                }
              }
              
              // Parse Last Game
              let lastGame = null;
              const lastGameIdx = lines.findIndex(l => l === 'Last Game');
              if (lastGameIdx >= 0) {
                const scoreLine = lines[lastGameIdx + 1];
                const scoreMatch = scoreLine?.match(/(\d+)\s*-\s*(\d+)/);
                
                if (scoreMatch) {
                  const leftScore = parseInt(scoreMatch[1]);
                  const rightScore = parseInt(scoreMatch[2]);
                  
                  // Find opponent from the box score table
                  // Look for lines with period scores like "Rosemount	1	2	1	4" or "Park of Cottage Grove	0	2	0	2"
                  // The opponent is the team that is NOT our team
                  
                  let opponent = '';
                  let ourTeamInTable = '';
                  let opponentInTable = '';
                  let isOurTeamFirst = false;
                  
                  // Find the "Team" header line which indicates the box score table
                  const teamHeaderIdx = lines.findIndex((l, idx) => idx > lastGameIdx && l.includes('Team') && (l.includes('1') || l.includes('T')));
                  
                  if (teamHeaderIdx > 0) {
                    // Look at the next few lines for team names with scores
                    for (let i = teamHeaderIdx + 1; i < Math.min(lines.length, teamHeaderIdx + 5); i++) {
                      const line = lines[i];
                      // Match lines that have a team name followed by period scores (numbers separated by tabs/spaces)
                      // e.g., "Rosemount	1	2	1	4" or " Park of Cottage Grove	0	2	0	2"
                      const tableMatch = line.match(/^\s*([A-Za-z][A-Za-z\s\/\-\.of']+?)\s+\d+\s+\d+/);
                      if (tableMatch) {
                        const foundTeam = tableMatch[1].trim();
                        // Check if this is our team or opponent
                        if (foundTeam.toLowerCase().includes(teamName.toLowerCase().substring(0, 4)) ||
                            teamName.toLowerCase().includes(foundTeam.toLowerCase().substring(0, 4))) {
                          ourTeamInTable = foundTeam;
                          if (!opponentInTable) {
                            isOurTeamFirst = true;
                          }
                        } else {
                          opponentInTable = foundTeam;
                        }
                      }
                    }
                  }
                  
                  // Use the opponent found in the table
                  opponent = opponentInTable;
                  
                  // In Legacy's display: left score is AWAY team, right score is HOME team
                  // In the box score table: first team listed is typically the AWAY team
                  // So if our team is listed FIRST, we were AWAY (left score is ours)
                  // If our team is listed SECOND, we were HOME (right score is ours)
                  const isOurTeamOnRight = !isOurTeamFirst;
                  
                  // Format opponent name properly
                  if (opponent) {
                    opponent = opponent.split(' ').map(word => 
                      word.charAt(0).toUpperCase() + word.slice(1).toLowerCase()
                    ).join(' ');
                  }
                  
                  // Assign scores based on team position
                  // Left score = away team score, Right score = home team score
                  const ourScore = isOurTeamOnRight ? rightScore : leftScore;
                  const oppScore = isOurTeamOnRight ? leftScore : rightScore;
                  
                  // Determine if our team was home (right side = home = "vs")
                  const wasHome = isOurTeamOnRight;
                  
                  let date = '';
                  for (let i = lastGameIdx + 3; i < Math.min(lines.length, lastGameIdx + 25); i++) {
                    if (lines[i].includes('@') && lines[i].includes('202')) {
                      // Just get the date/time part, not the venue
                      const fullLine = lines[i];
                      // Extract just "Sat Nov 22, 2025 @ 2:30p" part
                      const dateMatch = fullLine.match(/^([A-Za-z]{3}\s+[A-Za-z]{3}\s+\d{1,2},?\s+\d{4}\s*@\s*\d{1,2}:\d{2}[ap]?m?)/i);
                      if (dateMatch) {
                        date = dateMatch[1];
                        // Normalize time format: 7:00p -> 7:00pm
                        date = date.replace(/(\d:\d{2})([ap])(?!m)/i, '$1$2m');
                      } else {
                        // Fallback - just take up to the time
                        const parts = fullLine.split(/\s+(?=[A-Z][a-z]+\s+[A-Z])/);
                        date = parts[0]?.trim() || fullLine;
                      }
                      break;
                    }
                  }
                  
                  lastGame = {
                    opponent,
                    ourScore,
                    oppScore,
                    result: ourScore > oppScore ? 'W' : ourScore < oppScore ? 'L' : 'T',
                    wasHome,
                    date
                  };
                  
                  console.log('ðŸ’ Last Game parsed:', { ourTeamInTable, opponentInTable, isOurTeamFirst, leftScore, rightScore, ourScore, oppScore, result: lastGame.result });
                }
              }
              
              // FIX 4: Parse Next Game - Find ALL scheduled games, use SECOND one as 'next game'
              let nextGame = null;
              
              // Find all scheduled games
              const scheduledGames = [];
              for (let i = 0; i < lines.length; i++) {
                if (lines[i] === 'Scheduled' || lines[i].includes('@ ') && lines[i].match(/\d{1,2}:\d{2}/)) {
                  // Look backwards to find opponent and date
                  let opponent = '';
                  let date = '';
                  let time = '';
                  let location = '';
                  let isHome = false;
                  
                  // Check previous lines for opponent and date/time
                  for (let j = Math.max(0, i - 8); j < i; j++) {
                    const line = lines[j];
                    
                    // Date/time line format: "Sat Nov 22 @ 2:00pm"
                    if (line.includes('@') && line.match(/\d{1,2}:\d{2}/)) {
                      const parts = line.split('@');
                      date = parts[0]?.trim() || '';
                      // Normalize time format: 7:00p -> 7:00pm
                      time = (parts[1]?.trim() || '').replace(/(\d:\d{2})([ap])(?!m)/i, '$1$2m');
                    }
                    
                    // Location line - typically follows the date/time and contains arena name
                    if (line && !line.includes('@') && !line.includes('-') && !line.match(/^\d/) && 
                        line !== 'Scheduled' && line.length > 5 && 
                        (line.includes('Arena') || line.includes('Center') || line.includes('Ice') || 
                         line.includes('Rink') || line.includes('Complex') || line.includes(',') ||
                         line.includes('Coliseum') || line.includes('Civic') || line.includes('Pavilion'))) {
                      location = line;
                    }
                    
                    // Opponent line - look for team names (not "Delano-" or current team)
                    if (line && line.length > 2 && !line.includes(teamName) && !line.includes('@') && 
                        !line.match(/^\d/) && line !== 'Scheduled' && !line.includes(':')) {
                      if (line.endsWith('-')) {
                        opponent = line.slice(0, -1).trim();
                        // Determine home/away: team listed SECOND is HOME
                        // If opponent is on a line ending with '-', check if our team is AFTER it
                        const nextLine = lines[j+1];
                        if (nextLine && nextLine.includes(teamName)) {
                          isHome = true;  // Our team listed second = HOME game = "vs"
                          location = teamName;  // Home team is the location
                        } else {
                          isHome = false; // Our team listed first = AWAY game = "at"
                          location = opponent;  // Opponent is home, so they are the location
                        }
                      }
                    }
                  }
                  
                  if (opponent && date) {
                    scheduledGames.push({ opponent, isHome, date, time, location });
                  }
                }
              }
              
              console.log('ðŸ“… Found', scheduledGames.length, 'scheduled games');
              
              // Capture the CURRENT game (first scheduled) - this is the game we're scouting for
              let currentGame = null;
              if (scheduledGames.length >= 1) {
                currentGame = {
                  ...scheduledGames[0],
                  gameNum: (record.w + record.l + record.t + 1).toString()
                };
                console.log('âœ“ Current game being scouted:', currentGame);
              }
              
              // Use the THIRD game to skip duplicate (Game 3)
              if (scheduledGames.length >= 3) {
                nextGame = {
                  ...scheduledGames[2],
                  gameNum: (record.w + record.l + record.t + 2).toString()  // Game 3 = actual next
                };
                console.log('âœ“ Next game (Game 3):', nextGame);
              } else if (scheduledGames.length >= 2) {
                nextGame = {
                  ...scheduledGames[1],
                  gameNum: (record.w + record.l + record.t + 2).toString()
                };
                console.log('âœ“ Next game (Game 2 fallback):', nextGame);
              } else if (scheduledGames.length === 1) {
                // Only one game scheduled (current game)
                nextGame = {
                  opponent: 'TBD',
                  isHome: false,
                  date: '',
                  time: '',
                  location: '',
                  gameNum: (record.w + record.l + record.t + 2).toString()
                };
              } else {
                // Fallback to old parsing method
                const nextGameIdx = lines.findIndex(l => l === 'Next Game');
                if (nextGameIdx >= 0) {
                  let opponent = '';
                  let isHome = false;
                  let date = '';
                  let time = '';
                  let location = '';
                  
                  for (let i = nextGameIdx + 1; i < Math.min(lines.length, nextGameIdx + 10); i++) {
                    if (lines[i] === 'at') {
                      isHome = false;
                      for (let j = i + 1; j < Math.min(lines.length, i + 5); j++) {
                        if (lines[j] && lines[j].length > 2 && lines[j] !== teamName && !lines[j].includes('@')) {
                          opponent = lines[j];
                          break;
                        }
                      }
                      break;
                    } else if (lines[i] === 'vs') {
                      isHome = true;
                      for (let j = i + 1; j < Math.min(lines.length, i + 5); j++) {
                        if (lines[j] && lines[j].length > 2 && lines[j] !== teamName && !lines[j].includes('@')) {
                          opponent = lines[j];
                          break;
                        }
                      }
                      break;
                    }
                  }
                  
                  for (let i = nextGameIdx + 1; i < Math.min(lines.length, nextGameIdx + 15); i++) {
                    if (lines[i].includes('@') && (lines[i].includes(':') || lines[i].includes('p') || lines[i].includes('a'))) {
                      const parts = lines[i].split('@');
                      date = parts[0]?.trim() || '';
                      time = parts[1]?.trim() || '';
                    }
                    // Look for location
                    if (lines[i] && !lines[i].includes('@') && !lines[i].includes('-') && 
                        (lines[i].includes('Arena') || lines[i].includes('Center') || lines[i].includes('Ice') || 
                         lines[i].includes('Rink') || lines[i].includes(',') || lines[i].includes('Complex'))) {
                      location = lines[i];
                    }
                  }
                  
                  nextGame = {
                    opponent,
                    isHome,
                    date,
                    time,
                    location,
                    gameNum: (record.w + record.l + record.t + 1).toString()
                  };
                }
              }
              
              console.log('ðŸ“‹ ========== PARSE COMPLETE ==========');
              
              return { teamName, nickname, record, section, conference, headCoach, assistantCoaches, studentManager, stats, lastGame, nextGame, currentGame, homeArena };
            } catch (error) {
              console.error('Error parsing home page:', error);
              return { 
                teamName: '', nickname: '', record: { w: 0, l: 0, t: 0 }, 
                section: '', conference: '', headCoach: { name: '', careerRecord: { w: 0, l: 0, t: 0 }, seasonRecord: { w: 0, l: 0, t: 0 } }, 
                assistantCoaches: [], stats: { ppPct: 0, pkPct: 0, gpg: 0, gapg: 0 }, lastGame: null, nextGame: null, currentGame: null 
              };
            }
          };

          const parseRoster = (text, existingRoster = []) => {
            try {
              console.log('=== parseRoster called ===');
              const lines = text.split('\n').map(l => l.trim()).filter(l => l);
              console.log('Total lines:', lines.length);
              let roster = [];
              
              for (let i = 0; i < lines.length; i++) {
                const line = lines[i];
                
                // Try tab-separated first
                const fields = line.split('\t').map(f => f.trim()).filter(f => f);
                
                if (fields.length >= 4) {
                  // Tab-separated format
                  const number = fields[0];
                  const name = fields[1];
                  const position = fields[2];
                  const grade = fields[3];
                  
                  if (/^\d+$/.test(number) && (/^[FDG]$/.test(position) || position === 'D|F') && /^\d{1,2}$/.test(grade)) {
                    console.log('âœ“ Found player (tab-separated):', { number, name, position, grade });
                    
                    // Strip (Capt.) or (Capt) or * from names
                    const cleanName = name.replace(/\s*\(Capt\.?\)/i, '').replace(/\*/g, '').trim();
                    const nameParts = cleanName.split(' ');
                    const lastName = nameParts[nameParts.length - 1];
                    const firstName = nameParts.slice(0, -1).join(' ');
                    
                    let handed = '';
                    let shoots = '';
                    let height = '';
                    let weight = '';
                    
                    // Extract height (format like 6' 3" or 5' 10")
                    for (let j = 4; j < fields.length; j++) {
                      const field = fields[j];
                      const heightMatch = field.match(/^(\d)'[\s]*(\d{1,2})"?$/);
                      if (heightMatch) {
                        height = `${heightMatch[1]}' ${heightMatch[2]}"`;
                        console.log(`  â†’ Found height: ${height} for ${name}`);
                        break;
                      }
                    }
                    
                    // Extract weight (3-digit number typically between 100-250)
                    for (let j = 4; j < fields.length; j++) {
                      const field = fields[j];
                      if (/^\d{2,3}$/.test(field) && parseInt(field) >= 100 && parseInt(field) <= 300) {
                        weight = field;
                        console.log(`  â†’ Found weight: ${weight} for ${name}`);
                        break;
                      }
                    }
                    
                    // FIX 2: Extract shoots/handed from correct column
                    for (let j = 5; j < fields.length; j++) {
                      const field = fields[j];
                      if (field === 'LC' || field.includes('Left Catch')) {
                        handed = 'L';
                        shoots = 'L';
                        console.log(`  â†’ Found shoots: LC for ${name}`);
                        break;
                      } else if (field === 'RC' || field.includes('Right Catch')) {
                        handed = 'R';
                        shoots = 'R';
                        console.log(`  â†’ Found shoots: RC for ${name}`);
                        break;
                      } else if (field === 'Left' || field === 'L') {
                        handed = 'L';
                        shoots = 'L';
                        console.log(`  â†’ Found shoots: Left for ${name}`);
                        break;
                      } else if (field === 'Right' || field === 'R') {
                        handed = 'R';
                        shoots = 'R';
                        console.log(`  â†’ Found shoots: Right for ${name}`);
                        break;
                      }
                    }
                    
                    let dobYear = '';
                    const lastField = fields[fields.length - 1];
                    const yearMatch = lastField.match(/\b(19|20)\d{2}\b/);
                    if (yearMatch) {
                      dobYear = yearMatch[0];
                    }
                    
                    // Use first 3 chars to distinguish siblings (e.g., Jonny vs Joe McCabe)
                    const existingPlayer = existingRoster.find(p => 
                      p.lastName?.toUpperCase() === lastName.toUpperCase() && 
                      p.firstName?.substring(0, 3)?.toUpperCase() === firstName.substring(0, 3)?.toUpperCase()
                    );
                    
                    // Normalize D|F to D for consistency
                    const normalizedPosition = position === 'D|F' ? 'D' : position;
                    
                    roster.push({
                      id: `${number}-${lastName}`,
                      number: number,
                      name: cleanName,
                      firstName: firstName,
                      lastName: lastName,
                      position: normalizedPosition,
                      grade: grade,
                      height: height,
                      weight: weight,
                      dobYear: dobYear,
                      handed: handed,
                      shoots: shoots,
                      stats: { gp: 0, g: 0, a: 0, pts: 0, ppg: 0, ppa: 0, sh: 0, sha: 0, pim: 0, plusMinus: 0, fow: 0, fol: 0 },
                      goalieStats: normalizedPosition === 'G' ? { gp: 0, min: '0:00', w: 0, l: 0, t: 0, sog: 0, ga: 0, sv: 0, gaa: 0, svp: '.000', so: 0 } : null,
                      baseCareerStats: existingPlayer?.baseCareerStats || undefined,
                      baseCareerGoalieStats: existingPlayer?.baseCareerGoalieStats || undefined,
                      pronunciation: existingPlayer?.pronunciation || undefined
                    });
                  }
                } else {
                  // Try concatenated format: "1Evan GeyenG126' 3\"190LC2007"
                  // Pattern: NUMBER + NAME + POSITION + GRADE + HEIGHT + WEIGHT + SHOOTS + YEAR
                  // Example: 1Evan GeyenG126' 3"190LC2007
                  //          ^number ^name  ^pos^grade ^height^weight^shoots^year
                  
                  const concatMatch = line.match(/^(\d+)([A-Za-z\s\-'\.]+?)(D\|F|[FDG])(\d{1,2})/);
                  
                  if (concatMatch) {
                    const number = concatMatch[1];
                    const name = concatMatch[2].trim();
                    const position = concatMatch[3];
                    const grade = concatMatch[4];
                    
                    // Extract the part AFTER grade number
                    const afterGrade = line.substring(line.indexOf(grade) + grade.length);
                    
                    // Extract height (format like 6' 3" or 5' 10")
                    let height = '';
                    const heightMatch = afterGrade.match(/(\d)'[\s]*(\d{1,2})"/);
                    if (heightMatch) {
                      height = `${heightMatch[1]}' ${heightMatch[2]}"`;
                    }
                    
                    // Extract weight (3-digit number)
                    let weight = '';
                    const weightMatch = afterGrade.match(/(\d{3})(?=\D|$)/);
                    if (weightMatch && parseInt(weightMatch[1]) >= 100 && parseInt(weightMatch[1]) <= 300) {
                      weight = weightMatch[1];
                    }
                    
                    // Extract shoots/handed from the position AFTER weight (3 digits)
                    // Pattern: HEIGHT(like 6' 3") + WEIGHT(like 190) + SHOOTS(LC/RC/Left/Right)
                    // Look for LC, RC, Left, or Right BEFORE the year
                    let handed = '';
                    let shoots = '';
                    
                    // Find year first
                    const yearMatch = afterGrade.match(/\b(19|20)\d{2}\b/);
                    if (yearMatch) {
                      // Get everything between grade and year
                      const beforeYear = afterGrade.substring(0, yearMatch.index);
                      
                      // Now look for shoots in this section
                      if (beforeYear.includes('LC')) {
                        handed = 'L';
                        shoots = 'L';
                      } else if (beforeYear.includes('RC')) {
                        handed = 'R';
                        shoots = 'R';
                      } else if (beforeYear.match(/Left(?![\w])/)) {
                        handed = 'L';
                        shoots = 'L';
                      } else if (beforeYear.match(/Right(?![\w])/)) {
                        handed = 'R';
                        shoots = 'R';
                      }
                    }
                    
                    // Extract DOB year
                    let dobYear = '';
                    if (yearMatch) {
                      dobYear = yearMatch[0];
                    }
                    
                    console.log('âœ“ Found player (concatenated):', { number, name, position, grade, height, weight, shoots, dobYear });
                    
                    // Strip (Capt.) or (Capt) or * from names
                    const cleanName = name.replace(/\s*\(Capt\.?\)/i, '').replace(/\*/g, '').trim();
                    const nameParts = cleanName.split(' ');
                    const lastName = nameParts[nameParts.length - 1];
                    const firstName = nameParts.slice(0, -1).join(' ');
                    
                    // Use first 3 chars to distinguish siblings (e.g., Jonny vs Joe McCabe)
                    const existingPlayer = existingRoster.find(p => 
                      p.lastName?.toUpperCase() === lastName.toUpperCase() && 
                      p.firstName?.substring(0, 3)?.toUpperCase() === firstName.substring(0, 3)?.toUpperCase()
                    );
                    
                    // Normalize D|F to D for consistency
                    const normalizedPosition = position === 'D|F' ? 'D' : position;
                    
                    roster.push({
                      id: `${number}-${lastName}`,
                      number: number,
                      name: cleanName,
                      firstName: firstName,
                      lastName: lastName,
                      position: normalizedPosition,
                      grade: grade,
                      height: height,
                      weight: weight,
                      dobYear: dobYear,
                      handed: handed,
                      shoots: shoots,
                      stats: { gp: 0, g: 0, a: 0, pts: 0, ppg: 0, ppa: 0, sh: 0, sha: 0, pim: 0, plusMinus: 0, fow: 0, fol: 0 },
                      goalieStats: normalizedPosition === 'G' ? { gp: 0, min: '0:00', w: 0, l: 0, t: 0, sog: 0, ga: 0, sv: 0, gaa: 0, svp: '.000', so: 0 } : null,
                      baseCareerStats: existingPlayer?.baseCareerStats || undefined,
                      baseCareerGoalieStats: existingPlayer?.baseCareerGoalieStats || undefined,
                      pronunciation: existingPlayer?.pronunciation || undefined
                    });
                  }
                }
              }
              
              console.log('Final roster size:', roster.length);
              return roster;
            } catch (error) {
              console.error('Error parsing roster:', error);
              return [];
            }
          };

          const parsePlayerStats = (text, existingRoster) => {
            try {
              console.log('=== parsePlayerStats called ===');
              const lines = text.split('\n').map(l => l.trim()).filter(l => l);
              
              const updatedRoster = [...existingRoster];
              let inSkaterSection = false;
              let inGoalieSection = false;
              
              for (let i = 0; i < lines.length; i++) {
                const line = lines[i];
                
                if (line === 'Skater') {
                  inSkaterSection = true;
                  inGoalieSection = false;
                  continue;
                }
                if (line === 'Goalie') {
                  inSkaterSection = false;
                  inGoalieSection = true;
                  continue;
                }
                
                if (line === '#' || line === 'Name' || line === 'GP' || line.includes('AVG PTS')) continue;
                
                const fields = line.split('\t').filter(f => f.trim());
                
                if (fields.length < 3) continue;
                
                const number = fields[0];
                const name = fields[1];
                
                if (!/^\d+$/.test(number)) continue;
                
                if (inSkaterSection) {
                  const player = updatedRoster.find(p => p.number === number && p.position !== 'G');
                  
                  if (player && fields.length >= 6) {
                    const currentStats = {
                      gp: parseInt(fields[2]) || 0,
                      g: parseInt(fields[3]) || 0,
                      a: parseInt(fields[4]) || 0,
                      pts: parseInt(fields[5]) || 0,
                      ppg: parseInt(fields[8]) || 0,
                      ppa: parseInt(fields[9]) || 0,
                      sh: parseInt(fields[10]) || 0,
                      sha: parseInt(fields[11]) || 0,
                      pim: parseInt(fields[13]) || 0,
                      fow: parseInt(fields[14]) || 0,
                      fol: parseInt(fields[15]) || 0,
                      plusMinus: parseInt(fields[19]) || 0
                    };
                    
                    player.stats = currentStats;
                    
                    const baseCareer = player.baseCareerStats || { gp: 0, g: 0, a: 0, pts: 0, pim: 0, plusMinus: 0, fow: 0, fol: 0 };
                    const totalFOW = (baseCareer.fow || 0) + currentStats.fow;
                    const totalFOL = (baseCareer.fol || 0) + currentStats.fol;
                    const careerFaceoffPct = (totalFOW + totalFOL > 0) ? ((totalFOW / (totalFOW + totalFOL)) * 100).toFixed(1) : '0.0';
                    
                    player.careerStats = {
                      gp: baseCareer.gp + currentStats.gp,
                      g: baseCareer.g + currentStats.g,
                      a: baseCareer.a + currentStats.a,
                      pts: baseCareer.pts + currentStats.pts,
                      pim: (baseCareer.pim || 0) + currentStats.pim,
                      plusMinus: baseCareer.plusMinus + currentStats.plusMinus,
                      faceoffPct: careerFaceoffPct,
                      fow: totalFOW,
                      fol: totalFOL
                    };
                    
                    console.log(`âœ“ Updated ${name}:`, player.stats, 'Career:', player.careerStats);
                  }
                } else if (inGoalieSection) {
                  const player = updatedRoster.find(p => p.number === number && p.position === 'G');
                  
                  if (player && player.goalieStats && fields.length >= 10) {
                    const currentGoalieStats = {
                      gp: parseInt(fields[2]) || 0,
                      min: fields[3] || '0:00',
                      w: parseInt(fields[4]) || 0,
                      l: parseInt(fields[5]) || 0,
                      t: parseInt(fields[6]) || 0,
                      sog: parseInt(fields[7]) || 0,
                      ga: parseInt(fields[8]) || 0,
                      sv: parseInt(fields[9]) || 0,
                      gaa: parseFloat(fields[10]) || 0,
                      svp: fields[11] || '.000',
                      so: parseInt(fields[12]) || 0
                    };
                    
                    player.goalieStats = currentGoalieStats;
                    
                    const baseCareer = player.baseCareerGoalieStats || { gp: 0, min: '0:00', w: 0, l: 0, t: 0, so: 0, ga: 0, sv: 0 };
                    
                    const parseMinutes = (minStr) => {
                      const parts = minStr.split(':');
                      return parseInt(parts[0]) * 60 + parseInt(parts[1] || 0);
                    };
                    
                    const baseSeconds = parseMinutes(baseCareer.min);
                    const currSeconds = parseMinutes(currentGoalieStats.min);
                    const totalSeconds = baseSeconds + currSeconds;
                    const totalMinStr = `${Math.floor(totalSeconds / 60)}:${String(totalSeconds % 60).padStart(2, '0')}`;
                    
                    const totalGA = baseCareer.ga + currentGoalieStats.ga;
                    const totalSV = baseCareer.sv + currentGoalieStats.sv;
                    const totalSOG = totalGA + totalSV;
                    
                    const totalMinutes = totalSeconds / 60;
                    const careerGAA = totalMinutes > 0 ? (totalGA / (totalMinutes / 51)).toFixed(2) : '0.00';
                    const careerSVP = totalSOG > 0 ? (totalSV / totalSOG).toFixed(3) : '.000';
                    
                    player.careerGoalieStats = {
                      gp: baseCareer.gp + currentGoalieStats.gp,
                      min: totalMinStr,
                      w: baseCareer.w + currentGoalieStats.w,
                      l: baseCareer.l + currentGoalieStats.l,
                      t: baseCareer.t + currentGoalieStats.t,
                      so: baseCareer.so + currentGoalieStats.so,
                      ga: totalGA,
                      sv: totalSV,
                      gaa: parseFloat(careerGAA),
                      svp: careerSVP
                    };
                    
                    console.log(`âœ“ Updated goalie ${name}:`, player.goalieStats, 'Career:', player.careerGoalieStats);
                  }
                }
              }
              
              // V8.0: Update stats for players ALREADY IN LINES
              console.log('ðŸ”„ Updating stats for players in lines...');
              setLines(prevLines => {
                const newLines = { ...prevLines };
                const updatePlayerInSlot = (player) => {
                  if (!player) return player;
                  const updatedPlayer = updatedRoster.find(p => p.id === player.id);
                  return updatedPlayer || player;
                };
                ['line1', 'line2', 'line3', 'line4'].forEach(line => {
                  if (newLines[line]) {
                    newLines[line].lw = updatePlayerInSlot(newLines[line].lw);
                    newLines[line].c = updatePlayerInSlot(newLines[line].c);
                    newLines[line].rw = updatePlayerInSlot(newLines[line].rw);
                  }
                });
                ['d1', 'd2', 'd3'].forEach(dPair => {
                  if (newLines[dPair]) {
                    newLines[dPair].ld = updatePlayerInSlot(newLines[dPair].ld);
                    newLines[dPair].rd = updatePlayerInSlot(newLines[dPair].rd);
                  }
                });
                if (newLines.goalies) {
                  newLines.goalies.starter = updatePlayerInSlot(newLines.goalies.starter);
                  newLines.goalies.backup = updatePlayerInSlot(newLines.goalies.backup);
                }
                return newLines;
              });
              
              return updatedRoster;
            } catch (error) {
              console.error('Error parsing player stats:', error);
              return existingRoster;
            }
          };

          const parseCareerStats = (text, existingRoster) => {
            try {
              console.log('=== parseCareerStats called ===');
              const lines = text.split('\n').map(l => l.trim()).filter(l => l);
              
              const updatedRoster = [...existingRoster];
              let inSkaterSection = false;
              let inGoalieSection = false;
              
              for (let i = 0; i < lines.length; i++) {
                const line = lines[i];
                
                if (line === 'Skater') {
                  inSkaterSection = true;
                  inGoalieSection = false;
                  continue;
                }
                if (line === 'Goalie') {
                  inSkaterSection = false;
                  inGoalieSection = true;
                  continue;
                }
                
                if (line === '#' || line === 'Name' || line === 'GP' || line.includes('AVG PTS')) continue;
                
                const fields = line.split('\t').filter(f => f.trim());
                
                if (fields.length < 3) continue;
                
                const number = fields[0];
                const name = fields[1];
                
                if (!/^\d+$/.test(number)) continue;
                
                if (inSkaterSection) {
                  const normalizedNumber = number.trim();
                  const cleanCareerName = name.replace(/\s*\(Capt\.?\)/i, '').replace(/\*/g, '').trim();
                  const careerNameParts = cleanCareerName.split(/\s+/);
                  // Use first 3 chars to distinguish siblings (e.g., Jonny vs Joe McCabe)
                  const careerFirstChars = careerNameParts[0]?.substring(0, 3)?.toUpperCase() || '';
                  const careerLastName = careerNameParts[careerNameParts.length - 1]?.toUpperCase() || '';
                  
                  let player = updatedRoster.find(p => {
                    if (p.position === 'G') return false;
                    
                    const rosterFirstChars = p.firstName?.substring(0, 3)?.toUpperCase() || '';
                    const rosterLastName = p.lastName?.toUpperCase() || '';
                    
                    const nameMatch = rosterLastName === careerLastName && rosterFirstChars === careerFirstChars;
                    const numberMatch = p.number.toString().trim() === normalizedNumber;
                    
                    return nameMatch || numberMatch;
                  });
                  
                  if (player && fields.length >= 6) {
                    const seasonGP = parseInt(fields[2]) || 0;
                    const seasonG = parseInt(fields[3]) || 0;
                    const seasonA = parseInt(fields[4]) || 0;
                    const seasonPts = parseInt(fields[5]) || 0;
                    const seasonPlusMinus = parseInt(fields[19]) || 0;
                    const seasonFOW = parseInt(fields[14]) || 0;
                    const seasonFOL = parseInt(fields[15]) || 0;
                    
                    const existing = player.baseCareerStats || { gp: 0, g: 0, a: 0, pts: 0, plusMinus: 0, fow: 0, fol: 0 };
                    
                    player.baseCareerStats = {
                      gp: existing.gp + seasonGP,
                      g: existing.g + seasonG,
                      a: existing.a + seasonA,
                      pts: existing.pts + seasonPts,
                      plusMinus: existing.plusMinus + seasonPlusMinus,
                      fow: existing.fow + seasonFOW,
                      fol: existing.fol + seasonFOL
                    };
                    
                    console.log(`âœ“ Base career for ${name}:`, player.baseCareerStats);
                  }
                } else if (inGoalieSection) {
                  const normalizedNumber = number.trim();
                  const cleanCareerName = name.replace(/\s*\(Capt\.?\)/i, '').replace(/\*/g, '').trim();
                  const careerNameParts = cleanCareerName.split(/\s+/);
                  // Use first 3 chars to distinguish siblings (e.g., Jonny vs Joe McCabe)
                  const careerFirstChars = careerNameParts[0]?.substring(0, 3)?.toUpperCase() || '';
                  const careerLastName = careerNameParts[careerNameParts.length - 1]?.toUpperCase() || '';
                  
                  let player = updatedRoster.find(p => {
                    if (p.position !== 'G') return false;
                    
                    const rosterFirstChars = p.firstName?.substring(0, 3)?.toUpperCase() || '';
                    const rosterLastName = p.lastName?.toUpperCase() || '';
                    
                    const nameMatch = rosterLastName === careerLastName && rosterFirstChars === careerFirstChars;
                    const numberMatch = p.number.toString().trim() === normalizedNumber;
                    
                    return nameMatch || numberMatch;
                  });
                  
                  if (player && fields.length >= 10) {
                    const seasonGP = parseInt(fields[2]) || 0;
                    const seasonMin = fields[3] || '0:00';
                    const seasonW = parseInt(fields[4]) || 0;
                    const seasonL = parseInt(fields[5]) || 0;
                    const seasonT = parseInt(fields[6]) || 0;
                    const seasonSO = parseInt(fields[12]) || 0;
                    const seasonGA = parseInt(fields[8]) || 0;
                    const seasonSV = parseInt(fields[9]) || 0;
                    
                    const parseMinutes = (minStr) => {
                      const parts = minStr.split(':');
                      return parseInt(parts[0]) * 60 + parseInt(parts[1] || 0);
                    };
                    
                    const existing = player.baseCareerGoalieStats || { gp: 0, min: '0:00', w: 0, l: 0, t: 0, so: 0, ga: 0, sv: 0 };
                    const existingSeconds = parseMinutes(existing.min);
                    const seasonSeconds = parseMinutes(seasonMin);
                    const totalSeconds = existingSeconds + seasonSeconds;
                    const totalMinStr = `${Math.floor(totalSeconds / 60)}:${String(totalSeconds % 60).padStart(2, '0')}`;
                    
                    player.baseCareerGoalieStats = {
                      gp: existing.gp + seasonGP,
                      min: totalMinStr,
                      w: existing.w + seasonW,
                      l: existing.l + seasonL,
                      t: existing.t + seasonT,
                      so: existing.so + seasonSO,
                      ga: existing.ga + seasonGA,
                      sv: existing.sv + seasonSV
                    };
                    
                    console.log(`âœ“ Base career goalie for ${name}:`, player.baseCareerGoalieStats);
                  }
                }
              }
              
              return updatedRoster;
            } catch (error) {
              console.error('Error parsing career stats:', error);
              return existingRoster;
            }
          };

          const parseTeamStats = (text) => {
            try {
              console.log('ðŸ“Š ========== PARSING TEAM STATS ==========');
              const lines = text.split('\n').map(l => l.trim()).filter(l => l);
              
              let stats = { ppPct: 0, pkPct: 0, gpg: 0, gapg: 0 };
              
              let headerIdx = -1;
              for (let i = 0; i < lines.length; i++) {
                if (lines[i].includes('TEAM') && lines[i].includes('GPG') && lines[i].includes('GAPG')) {
                  headerIdx = i;
                  break;
                }
              }
              
              if (headerIdx >= 0) {
                for (let i = headerIdx + 1; i < headerIdx + 6 && i < lines.length; i++) {
                  const parts = lines[i].split(/\s+/);
                  
                  if (parts.length >= 9 && 
                      parts[2]?.match(/^\d+\.\d+$/) && 
                      parts[3]?.match(/^\d+\.\d+$/)) {
                    stats.gpg = parseFloat(parts[2]) || 0;
                    stats.gapg = parseFloat(parts[3]) || 0;
                    stats.ppPct = parseFloat(parts[5]) || 0;
                    stats.pkPct = parseFloat(parts[8]) || 0;
                    console.log('âœ… Found stats:', stats);
                    break;
                  }
                }
              }
              
              return stats;
            } catch (error) {
              console.error('Error parsing team stats:', error);
              return { ppPct: 0, pkPct: 0, gpg: 0, gapg: 0 };
            }
          };

          const handleLogoPaste = async (isSetup, isMyTeam) => {
            try {
              const clipboardItems = await navigator.clipboard.read();
              for (const item of clipboardItems) {
                for (const type of item.types) {
                  if (type.startsWith('image/')) {
                    const blob = await item.getType(type);
                    const reader = new FileReader();
                    reader.onload = (event) => {
                      const logoUrl = event.target.result;
                      
                      if (isSetup) {
                        setMyTeamSetup(prev => ({ ...prev, logo: logoUrl }));
                      } else if (isMyTeam) {
                        setMyTeamSetup(prev => ({ ...prev, logo: logoUrl }));
                      } else {
                        setOpponentLogo(logoUrl);
                      }
                    };
                    reader.readAsDataURL(blob);
                    return;
                  }
                }
              }
              alert('No image found in clipboard.');
            } catch (err) {
              console.error('Clipboard paste error:', err);
              alert('Unable to paste. Please use Choose File or copy an image first.');
            }
          };

          const handleLogoUpload = (e, isSetup, isMyTeam) => {
            const file = e.target.files[0];
            if (!file) return;
            
            const reader = new FileReader();
            reader.onload = (event) => {
              const logoUrl = event.target.result;
              
              if (isSetup) {
                setMyTeamSetup(prev => ({ ...prev, logo: logoUrl }));
              } else if (isMyTeam) {
                setMyTeamSetup(prev => ({ ...prev, logo: logoUrl }));
              } else {
                setOpponentLogo(logoUrl);
              }
            };
            reader.readAsDataURL(file);
          };

          const handleImport = () => {
            const text = importText;
            console.log('=== handleImport called ===');
            console.log('Current importStep:', importStep);
            
            if (importStep === 'oppTeamSelect') {
              // Team selection is handled by the dropdown, just advance to next step
              const currentIdx = importSteps.findIndex(s => s.key === importStep);
              if (currentIdx < importSteps.length - 1) {
                setImportStep(importSteps[currentIdx + 1].key);
              }
              return;
            }
            
            try {
              if (importStep === 'myTeamHome') {
                const parsed = parseHomePage(text);
                setMyTeamData(prev => ({ ...prev, ...parsed }));
                // If homeArena was found and myTeamSetup.arena is empty, update it
                if (parsed.homeArena && !myTeamSetup.arena) {
                  setMyTeamSetup(prev => ({ ...prev, arena: parsed.homeArena }));
                }
              } else if (importStep === 'myTeamRoster') {
                console.log('ðŸ”§ Importing MY TEAM roster...');
                let roster = parseRoster(text, myTeamData.roster);
                roster = loadCareerStatsFromStorage(roster);
                setMyTeamData(prev => ({ ...prev, roster }));
                // Sync line assignments with new roster
                syncLinesWithRoster(roster);
              } else if (importStep === 'myTeamPlayerStats') {
                const updatedRoster = parsePlayerStats(text, myTeamData.roster);
                setMyTeamData(prev => ({ ...prev, roster: updatedRoster }));
                // Sync line assignments with updated stats
                syncLinesWithRoster(updatedRoster);
              } else if (importStep === 'oppHome') {
                const parsed = parseHomePage(text);
                setOpponentData(prev => ({ ...prev, ...parsed }));
                
                // Auto-lookup opponent in MSHSL database (backup if team wasn't pre-selected)
                if (!opponentLogo) {
                  const teamName = parsed.teamName || parsed.nickname;
                  if (teamName) {
                    const foundTeam = lookupTeam(teamName);
                    if (foundTeam) {
                      console.log('ðŸ’ Auto-matched opponent:', foundTeam.name);
                      setOpponentLogo(foundTeam.logo);
                      setOpponentColors({ primary: foundTeam.primaryColor, secondary: foundTeam.secondaryColor });
                    } else {
                      console.log('âš ï¸ No match found for:', teamName);
                    }
                  }
                }
              } else if (importStep === 'oppRoster') {
                const roster = parseRoster(text, opponentData.roster);
                setOpponentData(prev => ({ ...prev, roster }));
              } else if (importStep === 'oppPlayerStats') {
                const updatedRoster = parsePlayerStats(text, opponentData.roster);
                setOpponentData(prev => ({ ...prev, roster: updatedRoster }));
              }
              
              setImportText('');
              
              const currentIdx = importSteps.findIndex(s => s.key === importStep);
              if (currentIdx < importSteps.length - 1) {
                setImportStep(importSteps[currentIdx + 1].key);
              } else {
                setShowImport(false);
              }
            } catch (error) {
              console.error('âŒ Error in handleImport:', error);
              alert(`Error importing data: ${error.message}\nCheck console for details.`);
            }
          };

          const handleSkipStep = () => {
            if (importText.trim()) {
              handleImport();
            } else {
              setImportText('');
              const currentIdx = importSteps.findIndex(s => s.key === importStep);
              if (currentIdx < importSteps.length - 1) {
                setImportStep(importSteps[currentIdx + 1].key);
              } else {
                setShowImport(false);
              }
            }
          };

          const handleBackStep = () => {
            if (importText.trim()) {
              try {
                if (importStep === 'myTeamHome') {
                  const parsed = parseHomePage(importText);
                  setMyTeamData(prev => ({ ...prev, ...parsed }));
                } else if (importStep === 'myTeamRoster') {
                  let roster = parseRoster(importText, myTeamData.roster);
                  roster = loadCareerStatsFromStorage(roster);
                  setMyTeamData(prev => ({ ...prev, roster }));
                  syncLinesWithRoster(roster);
                } else if (importStep === 'myTeamPlayerStats') {
                  const updatedRoster = parsePlayerStats(importText, myTeamData.roster);
                  setMyTeamData(prev => ({ ...prev, roster: updatedRoster }));
                  syncLinesWithRoster(updatedRoster);
                } else if (importStep === 'oppHome') {
                  const parsed = parseHomePage(importText);
                  setOpponentData(prev => ({ ...prev, ...parsed }));
                } else if (importStep === 'oppRoster') {
                  const roster = parseRoster(importText, opponentData.roster);
                  setOpponentData(prev => ({ ...prev, roster }));
                } else if (importStep === 'oppPlayerStats') {
                  const updatedRoster = parsePlayerStats(importText, opponentData.roster);
                  setOpponentData(prev => ({ ...prev, roster: updatedRoster }));
                }
              } catch (error) {
                console.error('Error saving data on back:', error);
              }
            }
            
            setImportText('');
            const currentIdx = importSteps.findIndex(s => s.key === importStep);
            if (currentIdx > 0) {
              setImportStep(importSteps[currentIdx - 1].key);
            } else {
              setImportStep(importSteps[importSteps.length - 1].key);
            }
          };

          const handleSaveAndClose = () => {
            if (importText.trim()) {
              try {
                // Check for Safari browser (ALL CAPS indicates Safari paste)
                if (importStep === 'myTeamHome') {
                  const hasSafariCaps = importText.includes('HEAD COACH') || 
                                        importText.includes('TEAM STATISTICS') || 
                                        importText.includes('TEAM INFORMATION');
                  if (hasSafariCaps) {
                    alert('ðŸš« Coach, sorry for the inconvenience, but Legacy Line Charts is not compatible with Safari.\n\nðŸŒ Please use Google Chrome or Microsoft Edge for the best experience.');
                    return;
                  }
                  
                  // Check if not logged in (has "Login" near the top)
                  const first500Chars = importText.substring(0, 500);
                  const hasLoginPrompt = first500Chars.includes('Login') && 
                                         first500Chars.includes('Create an Account');
                  if (hasLoginPrompt) {
                    alert('ðŸ” Coach, sorry for the inconvenience, but you need to log in to your Legacy Hockey team\'s page.\n\nâš ï¸ Keep Edit Mode OFF after logging in.\n\nðŸ‘‰ Log in, then copy and paste again.');
                    return;
                  }
                }
                
                if (importStep === 'myTeamHome') {
                  const parsed = parseHomePage(importText);
                  setMyTeamData(prev => ({ ...prev, ...parsed }));
                } else if (importStep === 'myTeamRoster') {
                  let roster = parseRoster(importText, myTeamData.roster);
                  roster = loadCareerStatsFromStorage(roster);
                  setMyTeamData(prev => ({ ...prev, roster }));
                  syncLinesWithRoster(roster);
                } else if (importStep === 'myTeamPlayerStats') {
                  const updatedRoster = parsePlayerStats(importText, myTeamData.roster);
                  setMyTeamData(prev => ({ ...prev, roster: updatedRoster }));
                  syncLinesWithRoster(updatedRoster);
                } else if (importStep === 'oppHome') {
                  const parsed = parseHomePage(importText);
                  setOpponentData(prev => ({ ...prev, ...parsed }));
                } else if (importStep === 'oppRoster') {
                  const roster = parseRoster(importText, opponentData.roster);
                  setOpponentData(prev => ({ ...prev, roster }));
                } else if (importStep === 'oppPlayerStats') {
                  const updatedRoster = parsePlayerStats(importText, opponentData.roster);
                  setOpponentData(prev => ({ ...prev, roster: updatedRoster }));
                }
              } catch (error) {
                console.error('Error saving data on close:', error);
              }
            }
            
            setImportText('');
            setShowImport(false);
          };

          const handlePlayerClick = (player, source) => {
            console.log('ðŸ‘† PLAYER CLICKED:', player.name, source);
            setSelectedPlayer({ player, source });
          };

          const handleSlotClick = (line, position) => {
            console.log('ðŸŽ¯ SLOT CLICKED:', line, position);
            if (!selectedPlayer) return;
            
            const newLines = { ...lines };
            const { player, source } = selectedPlayer;
            
            if (source && source.line) {
              newLines[source.line][source.position] = null;
            }
            
            const existingPlayer = newLines[line][position];
            newLines[line][position] = player;
            
            if (existingPlayer && source && source.line) {
              newLines[source.line][source.position] = existingPlayer;
            }
            
            setLines(newLines);
            setSelectedPlayer(null);
          };

          const handleLineColorChange = (line, color) => {
            setLines({ ...lines, [line]: { ...lines[line], color } });
          };

          const handleGoalieColorChange = (position, color) => {
            if (position === 'starter') {
              setLines({ ...lines, goalies: { ...lines.goalies, starterColor: color } });
            } else if (position === 'backup') {
              setLines({ ...lines, goalies: { ...lines.goalies, backupColor: color } });
            }
          };

          const convertGradeToText = (grade) => {
            if (grade === 12 || grade === '12th' || grade === '12') return 'Sr.';
            if (grade === 11 || grade === '11th' || grade === '11') return 'Jr.';
            if (grade === 10 || grade === '10th' || grade === '10') return 'So.';
            if (grade === 9 || grade === '9th' || grade === '9') return 'Fr.';
            return grade;
          };

          const handleCareerStatsImport = () => {
            try {
              const allSeasons = [
                careerStatsImport.lastSeason,
                careerStatsImport.twoSeasonsAgo,
                careerStatsImport.threeSeasonsAgo
              ].filter(s => s.trim());
              
              if (allSeasons.length === 0) {
                alert('Please paste at least one season of stats before importing.');
                return;
              }
              
              const careerData = {};
              
              allSeasons.forEach((seasonText, seasonIdx) => {
                console.log(`ðŸ“Š Processing season ${seasonIdx + 1}...`);
                const lines = seasonText.split('\n').map(l => l.trim()).filter(l => l);
                
                let inSkaterSection = false;
                let inGoalieSection = false;
                
                for (let i = 0; i < lines.length; i++) {
                  const line = lines[i];
                  
                  if (line === 'Skater') {
                    inSkaterSection = true;
                    inGoalieSection = false;
                    continue;
                  }
                  if (line === 'Goalie') {
                    inSkaterSection = false;
                    inGoalieSection = true;
                    continue;
                  }
                  
                  if (line === '#' || line === 'Name' || line === 'GP' || line.includes('AVG PTS')) continue;
                  
                  const fields = line.split('\t').filter(f => f.trim());
                  
                  if (fields.length < 3) continue;
                  
                  const number = fields[0];
                  const name = fields[1];
                  
                  if (!/^\d+$/.test(number)) continue;
                  
                  const nameParts = name.trim().split(/\s+/);
                  // Use first 3 chars to distinguish siblings (e.g., Jonny vs Joe McCabe)
                  const firstChars = nameParts[0]?.substring(0, 3)?.toUpperCase() || '';
                  const lastName = nameParts[nameParts.length - 1]?.toUpperCase() || '';
                  const key = `${lastName}_${firstChars}`;
                  
                  if (inSkaterSection && fields.length >= 6) {
                    const seasonGP = parseInt(fields[2]) || 0;
                    const seasonG = parseInt(fields[3]) || 0;
                    const seasonA = parseInt(fields[4]) || 0;
                    const seasonPts = parseInt(fields[5]) || 0;
                    const seasonPIM = parseInt(fields[13]) || 0;
                    const seasonPlusMinus = parseInt(fields[19]) || 0;
                    const seasonFOW = parseInt(fields[14]) || 0;
                    const seasonFOL = parseInt(fields[15]) || 0;
                    
                    if (careerData[key]?.type === 'goalie') {
                      console.log(`âš ï¸ Skipping skater stats for ${name} - already saved as goalie`);
                      continue;
                    }
                    
                    if (!careerData[key]) {
                      careerData[key] = {
                        type: 'skater',
                        data: { gp: 0, g: 0, a: 0, pts: 0, pim: 0, plusMinus: 0, fow: 0, fol: 0 }
                      };
                    }
                    
                    careerData[key].data.gp += seasonGP;
                    careerData[key].data.g += seasonG;
                    careerData[key].data.a += seasonA;
                    careerData[key].data.pts += seasonPts;
                    careerData[key].data.pim += seasonPIM;
                    careerData[key].data.plusMinus += seasonPlusMinus;
                    careerData[key].data.fow += seasonFOW;
                    careerData[key].data.fol += seasonFOL;
                    
                    console.log(`âœ“ Added skater career for ${name} (${key}):`, careerData[key].data);
                  } else if (inGoalieSection && fields.length >= 10) {
                    const seasonGP = parseInt(fields[2]) || 0;
                    const seasonMin = fields[3] || '0:00';
                    const seasonW = parseInt(fields[4]) || 0;
                    const seasonL = parseInt(fields[5]) || 0;
                    const seasonT = parseInt(fields[6]) || 0;
                    const seasonSO = parseInt(fields[12]) || 0;
                    const seasonGA = parseInt(fields[8]) || 0;
                    const seasonSV = parseInt(fields[9]) || 0;
                    
                    if (careerData[key]?.type === 'skater') {
                      console.log(`ðŸ”„ Converting ${name} from skater to goalie`);
                    }
                    
                    if (!careerData[key] || careerData[key].type !== 'goalie') {
                      careerData[key] = {
                        type: 'goalie',
                        data: { gp: 0, min: '0:00', w: 0, l: 0, t: 0, so: 0, ga: 0, sv: 0 }
                      };
                    }
                    
                    const seasonMinStr = seasonMin || '0:00';
                    const seasonMinParts = seasonMinStr.toString().split(':');
                    const minMinutes = parseInt(seasonMinParts[0]) || 0;
                    const minSeconds = parseInt(seasonMinParts[1]) || 0;
                    const totalSeasonSeconds = minMinutes * 60 + minSeconds;
                    
                    const existingMinStr = careerData[key].data.min || '0:00';
                    const existingMinParts = existingMinStr.toString().split(':');
                    const existingMinutes = parseInt(existingMinParts[0]) || 0;
                    const existingSeconds = parseInt(existingMinParts[1]) || 0;
                    const existingTotalSeconds = existingMinutes * 60 + existingSeconds;
                    
                    const newTotalSeconds = existingTotalSeconds + totalSeasonSeconds;
                    const newMinutes = Math.floor(newTotalSeconds / 60);
                    const newSeconds = newTotalSeconds % 60;
                    
                    careerData[key].data.gp += seasonGP;
                    careerData[key].data.min = `${newMinutes}:${String(newSeconds).padStart(2, '0')}`;
                    careerData[key].data.w += seasonW;
                    careerData[key].data.l += seasonL;
                    careerData[key].data.t += seasonT;
                    careerData[key].data.so += seasonSO;
                    careerData[key].data.ga += seasonGA;
                    careerData[key].data.sv += seasonSV;
                    
                    console.log(`âœ“ Added goalie career for ${name} (${key}):`, careerData[key].data);
                  }
                }
              });
              
              localStorage.setItem('hockey-scout-career-stats', JSON.stringify(careerData));
              console.log('ðŸ’¾ Saved career stats to localStorage:', Object.keys(careerData).length, 'players');
              
              alert(`âœ“ Successfully imported career stats for ${Object.keys(careerData).length} players!\n\nðŸ’¾ Career stats saved to browser storage and will automatically load when you import your roster.`);
            } catch (error) {
              console.error('Career stats import error:', error);
              alert(`Error importing career stats: ${error.message}`);
            }
          };

          const totalCoachRecord = {
            w: (myTeamData.headCoach.careerRecord.w || 0) + myTeamData.record.w,
            l: (myTeamData.headCoach.careerRecord.l || 0) + myTeamData.record.l,
            t: (myTeamData.headCoach.careerRecord.t || 0) + myTeamData.record.t
          };
          
          const totalOppCoachRecord = {
            w: (opponentData.headCoach.careerRecord.w || 0) + opponentData.record.w,
            l: (opponentData.headCoach.careerRecord.l || 0) + opponentData.record.l,
            t: (opponentData.headCoach.careerRecord.t || 0) + opponentData.record.t
          };

          // Player Card Component
          const PlayerCard = ({ player, source, compact = false, isPreview = false }) => {
            if (!player) return null;
            
            const cardRef = React.useRef(null);
            const numberRef = React.useRef(null);
            const nameRef = React.useRef(null);
            const pronunciationRef = React.useRef(null);
            
            const pronunciation = myTeamSetup.pronunciations[player.lastName] || '';
            
            const stats = player.stats || { gp: 0, g: 0, a: 0, pts: 0, pim: 0, plusMinus: 0, fow: 0, fol: 0 };
            const careerStats = player.careerStats || { gp: 0, g: 0, a: 0, pts: 0, plusMinus: 0, faceoffPct: '0.0', pim: 0 };
            const goalieStats = player.goalieStats || { gp: 0, min: '0:00', w: 0, l: 0, t: 0, ga: 0, sv: 0, gaa: 0, svp: '.000', so: 0, pim: 0 };
            const careerGoalieStats = player.careerGoalieStats || { gp: 0, min: '0:00', w: 0, l: 0, t: 0, ga: 0, sv: 0, gaa: 0, svp: '.000', so: 0, pim: 0 };
            
            const isGoalie = player.position === 'G';
            
            const faceoffPct = stats.fow + stats.fol > 0 
              ? ((stats.fow / (stats.fow + stats.fol)) * 100).toFixed(1)
              : '0.0';
            
            const getGradeLabel = (grade) => {
              const gradeMap = { '9': 'Fr.', '10': 'So.', '11': 'Jr.', '12': 'Sr.' };
              return gradeMap[grade] || grade;
            };
            
            const formatPlusMinus = (value) => {
              if (!value || value === 0) return '+0';
              return value > 0 ? `+${value}` : `${value}`;
            };
            
            const gradeText = getGradeLabel(player.grade);
            const gradeDisplay = player.dobYear ? `${gradeText} - ${player.dobYear}` : gradeText;
            
            const positionText = isGoalie 
              ? (player.shoots === 'L' ? 'Left Catch' : player.shoots === 'R' ? 'Right Catch' : '')
              : player.handed === 'L' ? 'Left' : player.handed === 'R' ? 'Right' : '';
            
            const isSelected = selectedPlayer?.player.id === player.id;
            
            const fontScale = isPreview ? 0.3125 : 1;
            const statFontSize = `${8 * fontScale}pt`;
            const nameFontSize = `${22 * fontScale}pt`;
            const infoFontSize = statFontSize;
            const pronunciationFontSize = `${12.5 * fontScale}pt`;
            
            React.useEffect(() => {
              const resizeText = (element, maxSize, minSize = 8) => {
                if (!element) return;
                let fontSize = maxSize;
                element.style.fontSize = `${fontSize}pt`;
                
                let iterations = 0;
                while ((element.scrollWidth > element.offsetWidth || element.scrollHeight > element.offsetHeight) 
                       && fontSize > minSize && iterations < 100) {
                  fontSize -= 0.5;
                  element.style.fontSize = `${fontSize}pt`;
                  iterations++;
                }
              };
              
              if (numberRef.current) {
                const maxNumberSize = isPreview ? 32.8125 : 105;
                const minNumberSize = isPreview ? 12.5 : 40;
                resizeText(numberRef.current, maxNumberSize, minNumberSize);
              }
              
              if (nameRef.current) {
                const baseMaxSize = 22;
                const maxNameSize = isPreview ? baseMaxSize * 0.3125 : baseMaxSize;
                const minNameSize = isPreview ? 3.125 : 10;
                resizeText(nameRef.current, maxNameSize, minNameSize);
              }
              
              if (pronunciationRef.current && pronunciation) {
                const maxPronunciationSize = isPreview ? 12.5 * 0.3125 : 12.5;
                const minPronunciationSize = isPreview ? 2.5 : 7.5;
                resizeText(pronunciationRef.current, maxPronunciationSize, minPronunciationSize);
              }
            }, [player.number, player.name, pronunciation, isGoalie, isPreview]);
            
            return (
              <div
                ref={cardRef}
                onClick={() => handlePlayerClick(player, source)}
                className={`bg-white border-2 rounded cursor-pointer transition-all ${
                  isSelected ? 'border-blue-500 bg-blue-50' : 'border-gray-800'
                }`}
                style={{ 
                  height: '100%',
                  width: '100%',
                  padding: '1px',
                  userSelect: 'none',
                  display: 'flex',
                  fontFamily: "'Arial Narrow', Arial, sans-serif"
                }}
              >
                <div style={{ 
                  width: '35%',
                  display: 'flex',
                  flexDirection: 'column',
                  alignItems: 'center',
                  justifyContent: 'flex-start',
                  borderRight: '2px solid #333',
                  paddingRight: '2px'
                }}>
                  <div 
                    ref={numberRef}
                    style={{ 
                      fontWeight: 'bold',
                      lineHeight: '0.9',
                      textAlign: 'center',
                      width: '100%',
                      overflow: 'hidden',
                      marginBottom: '2px'
                    }}
                  >
                    {player.number}
                  </div>
                  
                  {pronunciation && (
                    <div 
                      ref={pronunciationRef}
                      style={{ 
                        fontSize: pronunciationFontSize,
                        fontStyle: 'italic',
                        fontWeight: 'normal',
                        lineHeight: '1',
                        textAlign: 'center',
                        marginTop: '0px',
                        whiteSpace: 'nowrap',
                        overflow: 'hidden',
                        width: '100%'
                      }}>
                      "{pronunciation}"
                    </div>
                  )}
                </div>
                
                <div style={{ 
                  width: '65%',
                  paddingLeft: '4px',
                  paddingRight: '4px',
                  display: 'flex',
                  flexDirection: 'column',
                  justifyContent: 'flex-start',
                  gap: '1px'
                }}>
                  <div 
                    ref={nameRef}
                    style={{ 
                      fontSize: nameFontSize,
                      fontWeight: 'bold',
                      lineHeight: '1.0',
                      textAlign: 'center',
                      width: '100%',
                      overflow: 'visible',
                      whiteSpace: 'nowrap'
                    }}
                  >
                    {player.name}
                  </div>
                  
                  <div style={{ 
                    display: 'flex',
                    justifyContent: 'space-between',
                    fontSize: infoFontSize,
                    lineHeight: '1.0',
                    marginBottom: '1px'
                  }}>
                    {/* Build info parts array, only include non-empty values */}
                    {(() => {
                      const parts = [];
                      if (positionText) parts.push(positionText);
                      if (player.height) parts.push(player.height);
                      if (player.weight) parts.push(`${player.weight} lbs`);
                      if (gradeDisplay) parts.push(gradeDisplay);
                      return parts.map((part, i) => (
                        <span key={i} style={{ whiteSpace: 'nowrap' }}>{part}</span>
                      ));
                    })()}
                  </div>
                  
                  {!isGoalie ? (
                    <>
                      <div style={{ 
                        display: 'flex',
                        justifyContent: 'space-between',
                        fontSize: statFontSize,
                        fontWeight: 'bold',
                        lineHeight: '1.0',
                        whiteSpace: 'nowrap',
                        overflow: 'hidden'
                      }}>
                        <span>25-26: GP {stats.gp}</span>
                        <span>Pts. {stats.g}-{stats.a}--{stats.pts}</span>
                      </div>
                      
                      <div style={{ 
                        display: 'flex',
                        justifyContent: 'space-between',
                        fontSize: statFontSize,
                        fontWeight: 'bold',
                        lineHeight: '1.0',
                        whiteSpace: 'nowrap',
                        overflow: 'hidden'
                      }}>
                        <span>PIM {stats.pim}</span>
                        <span>+/- {formatPlusMinus(stats.plusMinus)}</span>
                        <span>Faceoff {faceoffPct}%</span>
                      </div>
                      
                      <div style={{ 
                        display: 'flex',
                        justifyContent: 'space-between',
                        fontSize: statFontSize,
                        fontWeight: 'normal',
                        lineHeight: '1.0',
                        whiteSpace: 'nowrap',
                        overflow: 'hidden'
                      }}>
                        <span>Career: GP {careerStats.gp}</span>
                        <span>Pts. {careerStats.g}-{careerStats.a}--{careerStats.pts}</span>
                      </div>
                      
                      <div style={{ 
                        display: 'flex',
                        justifyContent: 'space-between',
                        fontSize: statFontSize,
                        fontWeight: 'normal',
                        lineHeight: '1.0',
                        whiteSpace: 'nowrap',
                        overflow: 'hidden'
                      }}>
                        <span>PIM {careerStats.pim || 0}</span>
                        <span>+/- {formatPlusMinus(careerStats.plusMinus)}</span>
                        <span>Faceoff {careerStats.faceoffPct}%</span>
                      </div>
                    </>
                  ) : (
                    <>
                      <div style={{ 
                        display: 'flex',
                        justifyContent: 'space-between',
                        fontSize: statFontSize,
                        fontWeight: 'bold',
                        lineHeight: '1.0',
                        whiteSpace: 'nowrap',
                        overflow: 'hidden'
                      }}>
                        <span>25-26: MIN {goalieStats.min}</span>
                        <span>GAA {goalieStats.gaa.toFixed(2)}</span>
                      </div>
                      
                      <div style={{ 
                        display: 'flex',
                        justifyContent: 'space-between',
                        fontSize: statFontSize,
                        fontWeight: 'bold',
                        lineHeight: '1.0',
                        whiteSpace: 'nowrap',
                        overflow: 'hidden'
                      }}>
                        <span>PIM {goalieStats.pim || 0}</span>
                        <span>Rec. {goalieStats.w}-{goalieStats.l}-{goalieStats.t} ({goalieStats.so})</span>
                        <span>S% {goalieStats.svp}</span>
                      </div>
                      
                      <div style={{ 
                        display: 'flex',
                        justifyContent: 'space-between',
                        fontSize: statFontSize,
                        fontWeight: 'normal',
                        lineHeight: '1.0',
                        whiteSpace: 'nowrap',
                        overflow: 'hidden'
                      }}>
                        <span>Career: MIN {careerGoalieStats.min}</span>
                        <span>GAA {careerGoalieStats.gaa.toFixed(2)}</span>
                      </div>
                      
                      <div style={{ 
                        display: 'flex',
                        justifyContent: 'space-between',
                        fontSize: statFontSize,
                        fontWeight: 'normal',
                        lineHeight: '1.0',
                        whiteSpace: 'nowrap',
                        overflow: 'hidden'
                      }}>
                        <span>PIM {careerGoalieStats.pim || 0}</span>
                        <span>Rec. {careerGoalieStats.w}-{careerGoalieStats.l}-{careerGoalieStats.t} ({careerGoalieStats.so})</span>
                        <span>S% {careerGoalieStats.svp}</span>
                      </div>
                    </>
                  )}
                </div>
              </div>
            );
          };

          // Line Slot Component
          const LineSlot = ({ line, position, label, showLabel = false }) => {
            const player = lines[line][position];
            const isTargeted = selectedPlayer && !player;
            
            const handleSlotClickOrRemove = () => {
              if (player) {
                // Remove player from this position (move back to available)
                const newLines = {...lines};
                newLines[line][position] = null;
                setLines(newLines);
                setSelectedPlayer(null);
              } else {
                handleSlotClick(line, position);
              }
            };
            
            return (
              <div style={{ height: '85px' }}>
                {showLabel && (
                  <div className="text-xs font-bold text-center mb-0" style={{ fontSize: '11px', marginBottom: '2px' }}>{label}</div>
                )}
                <div 
                  onClick={handleSlotClickOrRemove}
                  className={`cursor-pointer transition-colors ${
                    isTargeted ? 'border-2 border-dashed border-blue-500 bg-blue-50 rounded' : ''
                  }`}
                  style={{ height: showLabel ? 'calc(100% - 20px)' : '100%' }}
                  title={player ? 'Click to remove from line' : 'Click to drop player here'}
                >
                  {player ? (
                    <PlayerCard player={player} source={{ line, position }} compact={true} />
                  ) : (
                    <div className="border-2 border-dashed border-gray-300 rounded h-full flex items-center justify-center">
                      <div className="text-gray-400 text-xs">Click to drop</div>
                    </div>
                  )}
                </div>
              </div>
            );
          };

          const getPlayersInLines = () => {
            const playersInLines = new Set();
            Object.values(lines).forEach(line => {
              Object.values(line).forEach(val => {
                if (val && typeof val === 'object' && val.id) {
                  playersInLines.add(val.id);
                }
              });
            });
            return playersInLines;
          };

          const availablePlayers = myTeamData.roster.filter(p => !getPlayersInLines().has(p.id));
          const currentStepInfo = importSteps.find(s => s.key === importStep);

          // Main Render
          return (
            <div className="min-h-screen bg-gray-50">
              {/* Setup Modal */}
              {showSetup && (
                <div className="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4">
                  <div className="bg-white rounded-lg shadow-xl max-w-md w-full">
                    <div className="sticky top-0 bg-white border-b px-6 py-4 flex justify-between items-center">
                      <h2 className="text-xl font-bold">My Team Setup</h2>
                      <button onClick={() => setShowSetup(false)} className="text-gray-500 hover:text-gray-700">
                        <X size={24} />
                      </button>
                    </div>
                    
                    <div className="p-6 space-y-4">
                      <div>
                        <label className="block text-sm font-semibold mb-2">Select Your Team</label>
                        <select
                          className="w-full border rounded px-3 py-2 text-sm"
                          value={Object.keys(MSHSL_TEAMS).find(key => MSHSL_TEAMS[key].name === myTeamSetup.teamName?.split(' ').slice(0,-1).join(' ')) || ''}
                          onChange={(e) => {
                            const teamKey = e.target.value;
                            if (teamKey && MSHSL_TEAMS[teamKey]) {
                              const team = MSHSL_TEAMS[teamKey];
                              setMyTeamSetup({
                                ...myTeamSetup,
                                teamName: `${team.name} ${team.nickname}`,
                                logo: team.logo,
                                colors: { primary: team.primaryColor, secondary: team.secondaryColor }
                              });
                              console.log('ðŸ’ Selected my team:', team.name, team.nickname);
                            }
                          }}
                        >
                          <option value="">-- Select Your Team --</option>
                          {Object.entries(MSHSL_TEAMS).sort((a, b) => a[1].name.localeCompare(b[1].name)).map(([key, team]) => (
                            <option key={key} value={key}>{team.name} {team.nickname}</option>
                          ))}
                        </select>
                      </div>
                      
                      {myTeamSetup.logo && (
                        <div className="bg-gray-50 border rounded p-4 flex items-center gap-4">
                          <img src={myTeamSetup.logo} alt="Team Logo" className="h-16 w-16 object-contain" />
                          <div>
                            <div className="font-semibold">{myTeamSetup.teamName}</div>
                            <div className="flex gap-2 mt-2">
                              <div className="w-8 h-8 rounded border" style={{ backgroundColor: myTeamSetup.colors.primary }} title="Primary"></div>
                              <div className="w-8 h-8 rounded border" style={{ backgroundColor: myTeamSetup.colors.secondary }} title="Secondary"></div>
                            </div>
                          </div>
                        </div>
                      )}
                    </div>
                    
                    <div className="border-t px-6 py-4 flex justify-end">
                      <button
                        onClick={() => {
                          localStorage.setItem('myTeamSetup', JSON.stringify(myTeamSetup));
                          setShowSetup(false);
                        }}
                        className="bg-blue-600 text-white px-6 py-2 rounded hover:bg-blue-700"
                      >
                        Save & Close
                      </button>
                    </div>
                  </div>
                </div>
              )}

              {/* Career Stats Modal */}
              {showCareerStats && (
                <div className="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4">
                  <div className="bg-white rounded-lg shadow-xl max-w-2xl w-full max-h-[90vh] overflow-y-auto">
                    <div className="sticky top-0 bg-white border-b px-6 py-4 flex justify-between items-center">
                      <h2 className="text-xl font-bold">My Team Career Stats Import</h2>
                      <button onClick={() => setShowCareerStats(false)} className="text-gray-500 hover:text-gray-700">
                        <X size={24} />
                      </button>
                    </div>
                    
                    <div className="p-6">
                      <div className="bg-blue-50 p-4 rounded">
                        <h3 className="font-bold mb-2">Career Stats Import</h3>
                        <p className="text-sm mb-3 text-gray-600">Paste previous seasons' stats from Legacy Player Stats page to show career totals on player cards.</p>
                        
                        <div className="space-y-3">
                          <div>
                            <div className="flex items-center justify-between mb-1">
                              <label className="text-sm font-semibold">{getSeasonYears().season1} Season Legacy Final Player Stats</label>
                              <button 
                                onClick={() => openHelp('careerStats', getSeasonYears().season1)}
                                className="text-blue-600 hover:text-blue-800 text-xs font-semibold"
                              >
                                â“ Help
                              </button>
                            </div>
                            <textarea
                              value={careerStatsImport.lastSeason}
                              onChange={(e) => setCareerStatsImport({...careerStatsImport, lastSeason: e.target.value})}
                              placeholder={`Paste player stats from ${getSeasonYears().season1} season...`}
                              className="w-full border rounded px-3 py-2 font-mono text-xs"
                              rows="3"
                            />
                          </div>
                          
                          <div>
                            <div className="flex items-center justify-between mb-1">
                              <label className="text-sm font-semibold">{getSeasonYears().season2} Season Legacy Final Player Stats</label>
                              <button 
                                onClick={() => openHelp('careerStats', getSeasonYears().season2)}
                                className="text-blue-600 hover:text-blue-800 text-xs font-semibold"
                              >
                                â“ Help
                              </button>
                            </div>
                            <textarea
                              value={careerStatsImport.twoSeasonsAgo}
                              onChange={(e) => setCareerStatsImport({...careerStatsImport, twoSeasonsAgo: e.target.value})}
                              placeholder={`Paste player stats from ${getSeasonYears().season2} season...`}
                              className="w-full border rounded px-3 py-2 font-mono text-xs"
                              rows="3"
                            />
                          </div>
                          
                          <div>
                            <div className="flex items-center justify-between mb-1">
                              <label className="text-sm font-semibold">{getSeasonYears().season3} Season Legacy Final Player Stats</label>
                              <button 
                                onClick={() => openHelp('careerStats', getSeasonYears().season3)}
                                className="text-blue-600 hover:text-blue-800 text-xs font-semibold"
                              >
                                â“ Help
                              </button>
                            </div>
                            <textarea
                              value={careerStatsImport.threeSeasonsAgo}
                              onChange={(e) => setCareerStatsImport({...careerStatsImport, threeSeasonsAgo: e.target.value})}
                              placeholder={`Paste player stats from ${getSeasonYears().season3} season...`}
                              className="w-full border rounded px-3 py-2 font-mono text-xs"
                              rows="3"
                            />
                          </div>
                        </div>
                      </div>
                    </div>
                    
                    <div className="border-t px-6 py-4 flex justify-end">
                      <button
                        onClick={() => {
                          handleCareerStatsImport();
                          setShowCareerStats(false);
                        }}
                        className="bg-blue-600 text-white px-6 py-2 rounded hover:bg-blue-700"
                      >
                        Save & Close
                      </button>
                    </div>
                  </div>
                </div>
              )}

              {/* Pronunciations Modal */}
              {showPronunciations && (
                <div className="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4">
                  <div className="bg-white rounded-lg shadow-xl max-w-2xl w-full max-h-[90vh] overflow-y-auto">
                    <div className="sticky top-0 bg-white border-b px-6 py-4 flex justify-between items-center">
                      <h2 className="text-xl font-bold">My Team Pronunciations</h2>
                      <button onClick={() => setShowPronunciations(false)} className="text-gray-500 hover:text-gray-700">
                        <X size={24} />
                      </button>
                    </div>
                    
                    <div className="p-6">
                      <div className="bg-purple-50 p-4 rounded">
                        <h3 className="font-bold mb-2">Player Name Pronunciation Guide - only works after Legacy Roster Import</h3>
                        <p className="text-sm mb-3 text-gray-600">Add phonetic pronunciations for player last names (saved for future use)</p>
                        
                        <div className="space-y-2 max-h-96 overflow-y-auto">
                          {myTeamData.roster.map((player) => (
                            <div key={player.id} className="flex items-center gap-2">
                              <span className="text-sm font-semibold w-40">#{player.number} {player.lastName}:</span>
                              <input
                                type="text"
                                value={myTeamSetup.pronunciations[player.lastName] || ''}
                                onChange={(e) => {
                                  setMyTeamSetup({
                                    ...myTeamSetup, 
                                    pronunciations: {
                                      ...myTeamSetup.pronunciations,
                                      [player.lastName]: e.target.value
                                    }
                                  });
                                }}
                                placeholder='e.g., "HOLL-a-nehn"'
                                className="flex-1 border rounded px-2 py-1 text-sm"
                              />
                            </div>
                          ))}
                        </div>
                        <p className="text-xs text-gray-500 mt-2">ðŸ’¡ Pronunciations are saved by last name and will auto-apply to future rosters</p>
                      </div>
                    </div>
                    
                    <div className="border-t px-6 py-4 flex justify-end">
                      <button
                        onClick={() => {
                          localStorage.setItem('myTeamSetup', JSON.stringify(myTeamSetup));
                          setShowPronunciations(false);
                        }}
                        className="bg-blue-600 text-white px-6 py-2 rounded hover:bg-blue-700"
                      >
                        Save & Close
                      </button>
                    </div>
                  </div>
                </div>
              )}

              {/* Export Config Modal */}
              {showExport && (
                <div className="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4">
                  <div className="bg-white rounded-lg shadow-xl max-w-4xl w-full max-h-[90vh] overflow-y-auto">
                    <div className="sticky top-0 bg-white border-b px-6 py-4 flex justify-between items-center">
                      <h2 className="text-xl font-bold">ðŸ“¦ Export Team Configuration</h2>
                      <button onClick={() => setShowExport(false)} className="text-gray-500 hover:text-gray-700">
                        <X size={24} />
                      </button>
                    </div>
                    
                    <div className="p-6">
                      <div className="bg-purple-50 p-4 rounded mb-4">
                        <h3 className="font-bold mb-2">ðŸ“¦ Subscriber Build Export v13.3.2</h3>
                        <p className="text-sm text-gray-600 mb-2">
                          Copy this JSON configuration and send it to Claude to build a customized subscriber version. 
                        </p>
                        <p className="text-sm text-gray-600 mb-2">
                          <strong>ðŸ”’ Baked into subscriber site:</strong> Team name, logo, colors, arena, career stats, <span className="text-purple-700 font-semibold">+ MSHSL Teams Database (142 teams)</span>.
                        </p>
                        <p className="text-sm text-gray-600">
                          <strong>âœï¸ Editable by subscriber coach:</strong> Pronunciations (saved to their local storage).
                        </p>
                      </div>
                      
                      <div className="mb-4">
                        <label className="block font-semibold mb-2">Configuration JSON:</label>
                        <textarea
                          value={exportData}
                          readOnly
                          className="w-full h-80 border rounded p-3 font-mono text-xs bg-gray-50"
                          style={{ fontFamily: 'monospace' }}
                        />
                      </div>
                      
                      <div className="bg-yellow-50 p-3 rounded text-sm">
                        <strong>ðŸ’¡ How to use:</strong>
                        <ol className="list-decimal ml-5 mt-1 space-y-1">
                          <li>Click "Copy to Clipboard" below</li>
                          <li>Start a new Claude conversation</li>
                          <li>Say: "Here's the config for [Team Name]. Build their subscriber version."</li>
                          <li>Paste the JSON</li>
                          <li>Claude will generate their custom HTML file</li>
                        </ol>
                      </div>
                    </div>
                    
                    <div className="border-t px-6 py-4 flex justify-between">
                      <button
                        onClick={() => setShowExport(false)}
                        className="bg-gray-300 text-gray-700 px-6 py-2 rounded hover:bg-gray-400"
                      >
                        Close
                      </button>
                      <button
                        onClick={copyExportToClipboard}
                        className="bg-purple-600 text-white px-6 py-2 rounded hover:bg-purple-700 flex items-center gap-2"
                      >
                        <Download size={16} /> Copy to Clipboard
                      </button>
                    </div>
                  </div>
                </div>
              )}

              {/* Import Modal - COMPLETE */}
              {/* Import Modal */}
              {showImport && (
                <div className="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4">
                  <div className="bg-white rounded-lg shadow-xl max-w-3xl w-full max-h-[90vh] overflow-y-auto">
                    <div className="sticky top-0 bg-white border-b px-6 py-4 flex justify-between items-center">
                      <div>
                        <h2 className="text-xl font-bold">Import Data</h2>
                        <p className="text-sm text-gray-600 mt-1">{currentStepInfo?.label}</p>
                      </div>
                      <button onClick={handleSaveAndClose} className="text-gray-500 hover:text-gray-700">
                        <X size={24} />
                      </button>
                    </div>
                    
                    <div className="p-6">
                      <div className="mb-4 flex gap-1 flex-wrap">
                        {importSteps.map((step, idx) => (
                          <div
                            key={step.key}
                            className={`text-xs px-2 py-1 rounded ${
                              step.key === importStep 
                                ? 'bg-blue-600 text-white' 
                                : 'bg-gray-200 text-gray-600'
                            }`}
                          >
                            {idx + 1}. {step.label}
                          </div>
                        ))}
                      </div>
                      
                      {currentStepInfo?.isTeamSelect ? (
                        <div className="space-y-4">
                          <p className="text-sm font-semibold">Select opponent team from MSHSL database</p>
                          <p className="text-xs text-gray-500">Logo and colors will be automatically populated</p>
                          
                          {/* Team Selector Dropdown */}
                          <div className="mb-4">
                            <label className="text-sm text-gray-600 block mb-1">Search MSHSL Teams (142 teams)</label>
                            <select
                              className="w-full border rounded px-3 py-2 text-sm"
                              onChange={(e) => {
                                const teamKey = e.target.value;
                                if (teamKey && MSHSL_TEAMS[teamKey]) {
                                  const team = MSHSL_TEAMS[teamKey];
                                  setOpponentLogo(team.logo);
                                  setOpponentColors({ primary: team.primaryColor, secondary: team.secondaryColor });
                                  setOpponentData(prev => ({ ...prev, teamName: team.name, nickname: team.nickname }));
                                  console.log('ðŸ’ Selected team:', team.name);
                                }
                              }}
                              defaultValue=""
                            >
                              <option value="">-- Select Team --</option>
                              {Object.entries(MSHSL_TEAMS).sort((a, b) => a[1].name.localeCompare(b[1].name)).map(([key, team]) => (
                                <option key={key} value={key}>{team.name} {team.nickname}</option>
                              ))}
                            </select>
                          </div>
                          
                          {opponentLogo && (
                            <div className="bg-green-50 border border-green-200 rounded p-3 flex items-center gap-3">
                              <img src={opponentLogo} alt="Selected" className="h-16 w-16 object-contain" />
                              <div>
                                <div className="text-sm font-semibold text-green-800">{opponentData.teamName || 'Team Selected'}</div>
                                <div className="flex gap-2 mt-1">
                                  <div className="w-6 h-6 rounded border" style={{ backgroundColor: opponentColors.primary }} title="Primary"></div>
                                  <div className="w-6 h-6 rounded border" style={{ backgroundColor: opponentColors.secondary }} title="Secondary"></div>
                                </div>
                              </div>
                            </div>
                          )}
                          
                          <p className="text-xs text-gray-400 italic">Tip: If team is not in list, just skip this step. Logo/colors will auto-populate from Legacy Home import.</p>
                        </div>
                      ) : (
                        <div>
                          <div className="flex items-center justify-between mb-2">
                            <label className="text-sm font-semibold">
                              Paste content from {currentStepInfo?.label}
                            </label>
                            <button 
                              onClick={() => openHelp(importStep)}
                              className="text-blue-600 hover:text-blue-800 text-xs font-semibold"
                            >
                              â“ Help
                            </button>
                          </div>
                          <textarea
                            value={importText}
                            onChange={(e) => setImportText(e.target.value)}
                            placeholder="Paste text here..."
                            className="w-full border rounded px-3 py-2 font-mono text-xs"
                            rows="12"
                          />
                        </div>
                      )}
                    </div>
                    
                    <div className="border-t px-6 py-4 flex justify-between">
                      <button
                        onClick={handleBackStep}
                        className="bg-gray-400 text-white px-6 py-2 rounded hover:bg-gray-500"
                      >
                        Save & Back
                      </button>
                      <button
                        onClick={() => {
                          if (importText.trim()) {
                            handleImport();
                          } else {
                            const currentIdx = importSteps.findIndex(s => s.key === importStep);
                            if (currentIdx < importSteps.length - 1) {
                              setImportStep(importSteps[currentIdx + 1].key);
                            } else {
                              setShowImport(false);
                            }
                          }
                        }}
                        className="bg-blue-600 text-white px-6 py-2 rounded hover:bg-blue-700"
                      >
                        {importSteps.findIndex(s => s.key === importStep) === importSteps.length - 1 ? 'Save & Close' : 'Save & Next'}
                      </button>
                    </div>
                  </div>
                </div>
              )}

              {/* Help Modal */}
              {showHelp && (
                <div className="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4">
                  <div className="bg-white rounded-lg shadow-xl max-w-lg w-full">
                    <div className="border-b px-6 py-4 flex justify-between items-center">
                      <h2 className="text-xl font-bold">{helpContent.title}</h2>
                      <button onClick={() => setShowHelp(false)} className="text-gray-500 hover:text-gray-700">
                        <X size={24} />
                      </button>
                    </div>
                    
                    <div className="p-6">
                      <ol className="list-decimal list-inside space-y-2">
                        {helpContent.steps.map((step, idx) => (
                          <li key={idx} className="text-sm">{step}</li>
                        ))}
                      </ol>
                    </div>
                    
                    <div className="border-t px-6 py-4 flex justify-end">
                      <button
                        onClick={() => setShowHelp(false)}
                        className="bg-blue-600 text-white px-6 py-2 rounded hover:bg-blue-700"
                      >
                        Close
                      </button>
                    </div>
                  </div>
                </div>
              )}

              {/* Navigation Bar */}
              <div className="no-print text-white p-3 shadow-lg sticky top-0 z-50" style={{ backgroundColor: '#2c4b7d' }}>
                <div className="max-w-7xl mx-auto flex justify-between items-center">
                  <div className="flex items-center gap-3">
                    {myTeamSetup.logo && (
                      <img src={myTeamSetup.logo} alt="Team" className="h-10 w-10 object-contain bg-white rounded p-1" />
                    )}
                    <h1 className="text-xl font-bold">Legacy Line Charts</h1>
                  </div>
                  <div className="flex gap-2">
                    {!SUBSCRIBER_MODE && (
                      <button onClick={() => setShowSetup(true)} className="bg-white text-blue-900 px-3 py-1.5 rounded hover:bg-gray-100 flex items-center gap-1 text-sm font-semibold">
                        <Settings size={16} /> My Team Setup
                      </button>
                    )}
                    {!SUBSCRIBER_MODE && (
                      <button onClick={() => setShowCareerStats(true)} className="bg-white text-blue-900 px-3 py-1.5 rounded hover:bg-gray-100 flex items-center gap-1 text-sm font-semibold">
                        <Settings size={16} /> My Team Career Stats
                      </button>
                    )}
                    <button onClick={() => setShowImport(true)} className="bg-white text-blue-900 px-3 py-1.5 rounded hover:bg-gray-100 flex items-center gap-1 text-sm font-semibold">
                      <Upload size={16} /> Import Next Game Data
                    </button>
                    <button onClick={() => setShowPronunciations(true)} className="bg-white text-blue-900 px-3 py-1.5 rounded hover:bg-gray-100 flex items-center gap-1 text-sm font-semibold">
                      <Settings size={16} /> My Team Pronunciations
                    </button>
                    {!SUBSCRIBER_MODE && (
                      <button onClick={handleExportConfig} className="bg-purple-600 text-white px-3 py-1.5 rounded hover:bg-purple-700 flex items-center gap-1 text-sm font-semibold">
                        <Download size={16} /> Export Config
                      </button>
                    )}
                    <button onClick={() => window.print()} className="bg-green-600 text-white px-3 py-1.5 rounded hover:bg-green-700 flex items-center gap-1 text-sm font-semibold">
                      <Printer size={16} /> Print
                    </button>
                    <button 
                      onClick={() => {
                        if (confirm('Clear all line assignments? This will remove all players from lines, pairs, and goalies. Your roster will remain intact.')) {
                          setLines({
                            line1: { lw: null, c: null, rw: null, color: 'GREEN' },
                            line2: { lw: null, c: null, rw: null, color: 'RED' },
                            line3: { lw: null, c: null, rw: null, color: 'BLUE' },
                            line4: { lw: null, c: null, rw: null, color: 'YELLOW' },
                            d1: { ld: null, rd: null, color: 'GREEN' },
                            d2: { ld: null, rd: null, color: 'RED' },
                            d3: { ld: null, rd: null, color: 'BLUE' },
                            goalies: { starter: null, starterColor: 'YELLOW', backup: null, backupColor: 'WHITE' }
                          });
                          console.log('ðŸ§¹ Cleared all line assignments');
                        }
                      }} 
                      className="bg-gray-500 text-white px-3 py-1.5 rounded hover:bg-gray-600 flex items-center gap-1 text-sm font-semibold"
                      title="Reset all line assignments"
                    >
                      <X size={16} /> Clear Lines
                    </button>
                  </div>
                </div>
              </div>

              {/* Print Page 1 */}
              <div className="print-page-1 bg-white p-0 max-w-7xl mx-auto" style={{ maxWidth: '7.875in' }}>
                {/* New 7-Column Header */}
                <div className="rounded-lg overflow-hidden mb-0" style={{ 
                  background: `linear-gradient(to right, ${myTeamSetup.colors.primary}15 0%, white 40%, white 60%, ${opponentColors.primary}15 100%)`,
                  border: `2px solid black`,
                  display: 'grid',
                  gridTemplateColumns: '18% 12% 8% 24% 8% 12% 18%',
                  gap: '2px',
                  padding: '2px'
                }}>
                  {/* C1 (18%) - MY TEAM LAST/NEXT GAMES */}
                  <div className="flex flex-col justify-between text-center" style={{ padding: '4px', overflow: 'hidden' }}>
                    <div className="flex-1 flex flex-col justify-center">
                      <div style={{ fontSize: 'clamp(9px, 1vw, 12px)' }} className="font-bold text-gray-600">LAST GAME</div>
                      {myTeamData.lastGame ? (
                        <>
                          <div style={{ fontSize: 'clamp(10px, 1.1vw, 13px)', wordWrap: 'break-word' }} className="leading-tight">
                            {myTeamData.teamName} <span className={`font-black ${
                              myTeamData.lastGame.result === 'W' ? 'text-green-600' :
                              myTeamData.lastGame.result === 'L' ? 'text-red-600' :
                              'text-gray-600'
                            }`}>{myTeamData.lastGame.ourScore} - {myTeamData.lastGame.oppScore}</span> {myTeamData.lastGame.opponent}
                          </div>
                          <div style={{ fontSize: 'clamp(8px, 0.9vw, 10px)', wordWrap: 'break-word' }} className="text-gray-500">{myTeamData.lastGame.date}</div>
                        </>
                      ) : (
                        <div style={{ fontSize: 'clamp(10px, 1.1vw, 13px)' }} className="text-gray-400">N/A</div>
                      )}
                    </div>
                    
                    <div className="flex-1 flex flex-col justify-center">
                      <div style={{ fontSize: 'clamp(9px, 1vw, 12px)' }} className="font-bold text-gray-600">NEXT GAME</div>
                      {myTeamData.nextGame && myTeamData.nextGame.opponent && myTeamData.nextGame.opponent !== 'TBD' ? (
                        <>
                          <div style={{ fontSize: 'clamp(10px, 1.1vw, 13px)', wordWrap: 'break-word' }} className="font-bold leading-tight">
                            {myTeamData.nextGame.isHome ? 'vs' : 'at'} {myTeamData.nextGame.opponent}
                          </div>
                          <div style={{ fontSize: 'clamp(8px, 0.9vw, 10px)', wordWrap: 'break-word' }} className="text-gray-500">
                            {myTeamData.nextGame.date} @ {myTeamData.nextGame.time}
                          </div>
                        </>
                      ) : (
                        <div style={{ fontSize: 'clamp(10px, 1.1vw, 13px)' }} className="text-gray-400">TBD</div>
                      )}
                    </div>
                  </div>

                  {/* C2 (12%) - MY TEAM LOGO/COACH/RECORD */}
                  <div className="flex flex-col items-center text-center gap-1">
                    <div className="flex items-center justify-center" style={{ 
                      width: '100%', 
                      height: '85px',
                      backgroundColor: '#EFEFEF',
                      borderRadius: '4px',
                      padding: '4px',
                      border: `2px solid ${myTeamSetup.colors.primary}`,
                      boxShadow: `inset 0 0 0 1px ${myTeamSetup.colors.secondary}`
                    }}>
                      {myTeamSetup.logo && (
                        <img src={myTeamSetup.logo} alt="Team" className="object-contain" style={{ maxHeight: '77px', width: '100%' }} />
                      )}
                    </div>
                    <div className="flex flex-col">
                      <div style={{ fontSize: 'clamp(9px, 1vw, 12px)', lineHeight: '1.1', wordBreak: 'break-word' }} className="font-bold">{myTeamData.headCoach.name}</div>
                      <div style={{ fontSize: 'clamp(7px, 0.8vw, 9px)' }} className="text-gray-600">(Career: {totalCoachRecord.w}-{totalCoachRecord.l}-{totalCoachRecord.t})</div>
                      {myTeamData.assistantCoaches && myTeamData.assistantCoaches.length > 0 && (
                        <div style={{ fontSize: 'clamp(8px, 0.9vw, 10px)', marginTop: '2px' }} className="text-gray-500">
                          <div className="font-semibold">Assistant Coaches:</div>
                          <div>{myTeamData.assistantCoaches.join(', ')}</div>
                        </div>
                      )}
                    </div>
                  </div>

                  {/* C3 (8%) - MY TEAM 4 STATS STACKED */}
                  <div className="flex flex-col gap-1">
                    <div className="bg-white border border-gray-300 rounded text-center flex-1 flex flex-col justify-center" style={{ padding: '2px 1px' }}>
                      <div style={{ fontSize: 'clamp(6px, 0.7vw, 8px)' }} className="font-semibold text-gray-700">Goals/Game</div>
                      <div style={{ fontSize: 'clamp(16px, 1.8vw, 22px)', color: myTeamSetup.colors.primary }} className="font-bold">{myTeamData.stats.gpg.toFixed(2)}</div>
                    </div>
                    <div className="bg-white border border-gray-300 rounded text-center flex-1 flex flex-col justify-center" style={{ padding: '2px 1px' }}>
                      <div style={{ fontSize: 'clamp(6px, 0.7vw, 8px)' }} className="font-semibold text-gray-700">GA/Game</div>
                      <div style={{ fontSize: 'clamp(16px, 1.8vw, 22px)', color: myTeamSetup.colors.primary }} className="font-bold">{myTeamData.stats.gapg.toFixed(2)}</div>
                    </div>
                    <div className="bg-white border border-gray-300 rounded text-center flex-1 flex flex-col justify-center" style={{ padding: '2px 1px' }}>
                      <div style={{ fontSize: 'clamp(6px, 0.7vw, 8px)' }} className="font-semibold text-gray-700">Power Play</div>
                      <div style={{ fontSize: 'clamp(16px, 1.8vw, 22px)', color: myTeamSetup.colors.primary }} className="font-bold">{myTeamData.stats.ppPct}%</div>
                    </div>
                    <div className="bg-white border border-gray-300 rounded text-center flex-1 flex flex-col justify-center" style={{ padding: '2px 1px' }}>
                      <div style={{ fontSize: 'clamp(6px, 0.7vw, 8px)' }} className="font-semibold text-gray-700">Penalty Kill</div>
                      <div style={{ fontSize: 'clamp(16px, 1.8vw, 22px)', color: myTeamSetup.colors.primary }} className="font-bold">{myTeamData.stats.pkPct}%</div>
                    </div>
                  </div>

                  {/* C4 (24%) - CENTER: TEAM NAMES + GAME INFO */}
                  <div className="flex flex-col justify-center">
                    <div className="flex-1 flex flex-col items-center justify-center text-center">
                      <div style={{ fontSize: 'clamp(17px, 2.2vw, 24px)', color: myTeamSetup.colors.primary }} className="font-black leading-tight">
                        {myTeamSetup.teamName}
                      </div>
                      <div style={{ fontSize: 'clamp(11px, 1.4vw, 15px)' }} className="text-gray-600">
                        ({myTeamData.record.w}-{myTeamData.record.l}-{myTeamData.record.t}, {myTeamData.section}, {myTeamData.conference})
                      </div>
                      
                      <div style={{ fontSize: 'clamp(10px, 1.3vw, 14px)', padding: '1px 0' }} className="font-semibold text-gray-600">vs</div>
                      
                      <div style={{ fontSize: 'clamp(17px, 2.2vw, 24px)', color: opponentColors.primary }} className="font-black leading-tight">
                        {opponentData.teamName} {opponentData.nickname}
                      </div>
                      <div style={{ fontSize: 'clamp(11px, 1.4vw, 15px)' }} className="text-gray-600">
                        ({opponentData.record.w}-{opponentData.record.l}-{opponentData.record.t}, {opponentData.section}, {opponentData.conference})
                      </div>
                      
                      <div style={{ fontSize: 'clamp(11px, 1.4vw, 15px)', fontWeight: '800', marginTop: '2px' }} className="text-gray-600">Game #{(myTeamData.record.w + myTeamData.record.l + myTeamData.record.t + 1)}</div>
                      {myTeamData.currentGame && myTeamData.currentGame.date && (
                        <div style={{ fontSize: 'clamp(11px, 1.4vw, 15px)' }} className="text-gray-600">
                          {myTeamData.currentGame.date}{myTeamData.currentGame.time ? ` @ ${myTeamData.currentGame.time}` : ''}
                          {myTeamData.currentGame.location ? ` at ${myTeamData.currentGame.location}` : ''}
                        </div>
                      )}
                    </div>
                  </div>

                  {/* C5 (8%) - OPPONENT 4 STATS STACKED */}
                  <div className="flex flex-col gap-1">
                    <div className="bg-white border border-gray-300 rounded text-center flex-1 flex flex-col justify-center" style={{ padding: '2px 1px' }}>
                      <div style={{ fontSize: 'clamp(6px, 0.7vw, 8px)' }} className="font-semibold text-gray-700">Goals/Game</div>
                      <div style={{ fontSize: 'clamp(16px, 1.8vw, 22px)', color: opponentColors.primary }} className="font-bold">{opponentData.stats.gpg.toFixed(2)}</div>
                    </div>
                    <div className="bg-white border border-gray-300 rounded text-center flex-1 flex flex-col justify-center" style={{ padding: '2px 1px' }}>
                      <div style={{ fontSize: 'clamp(6px, 0.7vw, 8px)' }} className="font-semibold text-gray-700">GA/Game</div>
                      <div style={{ fontSize: 'clamp(16px, 1.8vw, 22px)', color: opponentColors.primary }} className="font-bold">{opponentData.stats.gapg.toFixed(2)}</div>
                    </div>
                    <div className="bg-white border border-gray-300 rounded text-center flex-1 flex flex-col justify-center" style={{ padding: '2px 1px' }}>
                      <div style={{ fontSize: 'clamp(6px, 0.7vw, 8px)' }} className="font-semibold text-gray-700">Power Play</div>
                      <div style={{ fontSize: 'clamp(16px, 1.8vw, 22px)', color: opponentColors.primary }} className="font-bold">{opponentData.stats.ppPct}%</div>
                    </div>
                    <div className="bg-white border border-gray-300 rounded text-center flex-1 flex flex-col justify-center" style={{ padding: '2px 1px' }}>
                      <div style={{ fontSize: 'clamp(6px, 0.7vw, 8px)' }} className="font-semibold text-gray-700">Penalty Kill</div>
                      <div style={{ fontSize: 'clamp(16px, 1.8vw, 22px)', color: opponentColors.primary }} className="font-bold">{opponentData.stats.pkPct}%</div>
                    </div>
                  </div>

                  {/* C6 (12%) - OPPONENT LOGO/COACH/RECORD */}
                  <div className="flex flex-col items-center text-center gap-1">
                    <div className="flex items-center justify-center" style={{ 
                      width: '100%', 
                      height: '85px',
                      backgroundColor: '#EFEFEF',
                      borderRadius: '4px',
                      padding: '4px',
                      border: `2px solid ${opponentColors.primary}`,
                      boxShadow: `inset 0 0 0 1px ${opponentColors.secondary}`
                    }}>
                      {opponentLogo && (
                        <img src={opponentLogo} alt="Opponent" className="object-contain" style={{ maxHeight: '77px', width: '100%' }} />
                      )}
                    </div>
                    <div className="flex flex-col">
                      <div style={{ fontSize: 'clamp(9px, 1vw, 12px)', lineHeight: '1.1', wordBreak: 'break-word' }} className="font-bold">{opponentData.headCoach.name}</div>
                      <div style={{ fontSize: 'clamp(7px, 0.8vw, 9px)' }} className="text-gray-600">(Career: {totalOppCoachRecord.w}-{totalOppCoachRecord.l}-{totalOppCoachRecord.t})</div>
                      {opponentData.assistantCoaches && opponentData.assistantCoaches.length > 0 && (
                        <div style={{ fontSize: 'clamp(8px, 0.9vw, 10px)', marginTop: '2px' }} className="text-gray-500">
                          <div className="font-semibold">Assistant Coaches:</div>
                          <div>{opponentData.assistantCoaches.join(', ')}</div>
                        </div>
                      )}
                    </div>
                  </div>

                  {/* C7 (18%) - OPPONENT LAST/NEXT GAMES */}
                  <div className="flex flex-col justify-between text-center" style={{ padding: '4px', overflow: 'hidden' }}>
                    <div className="flex-1 flex flex-col justify-center">
                      <div style={{ fontSize: 'clamp(9px, 1vw, 12px)' }} className="font-bold text-gray-600">LAST GAME</div>
                      {opponentData.lastGame ? (
                        <>
                          <div style={{ fontSize: 'clamp(10px, 1.1vw, 13px)', wordWrap: 'break-word' }} className="leading-tight">
                            {opponentData.teamName} <span className={`font-black ${
                              opponentData.lastGame.result === 'W' ? 'text-green-600' :
                              opponentData.lastGame.result === 'L' ? 'text-red-600' :
                              'text-gray-600'
                            }`}>{opponentData.lastGame.ourScore} - {opponentData.lastGame.oppScore}</span> {opponentData.lastGame.opponent}
                          </div>
                          <div style={{ fontSize: 'clamp(8px, 0.9vw, 10px)', wordWrap: 'break-word' }} className="text-gray-500">{opponentData.lastGame.date}</div>
                        </>
                      ) : (
                        <div style={{ fontSize: 'clamp(10px, 1.1vw, 13px)' }} className="text-gray-400">N/A</div>
                      )}
                    </div>
                    
                    <div className="flex-1 flex flex-col justify-center">
                      <div style={{ fontSize: 'clamp(9px, 1vw, 12px)' }} className="font-bold text-gray-600">NEXT GAME</div>
                      {opponentData.nextGame && opponentData.nextGame.opponent && opponentData.nextGame.opponent !== 'TBD' ? (
                        <>
                          <div style={{ fontSize: 'clamp(10px, 1.1vw, 13px)', wordWrap: 'break-word' }} className="font-bold leading-tight">
                            {opponentData.nextGame.isHome ? 'vs' : 'at'} {opponentData.nextGame.opponent}
                          </div>
                          <div style={{ fontSize: 'clamp(8px, 0.9vw, 10px)', wordWrap: 'break-word' }} className="text-gray-500">
                            {opponentData.nextGame.date} @ {opponentData.nextGame.time}
                          </div>
                        </>
                      ) : (
                        <div style={{ fontSize: 'clamp(10px, 1.1vw, 13px)' }} className="text-gray-400">TBD</div>
                      )}
                    </div>
                  </div>
                </div>

                {/* Available Players */}
                <div className="no-print bg-gray-100 rounded p-2 mb-1">
                  <h2 className="text-sm font-bold mb-1">Available Players ({availablePlayers.length})</h2>
                  <div className="grid grid-cols-5 gap-2">
                    {availablePlayers.map(player => (
                      <PlayerCard key={player.id} player={player} source={{ roster: true }} isPreview={true} />
                    ))}
                  </div>
                </div>

                {/* Forward Lines */}
                <div className="mb-0">
                  <h2 style={{ fontSize: '13px' }} className="font-bold mb-0 text-center">FORWARD LINES</h2>
                  
                  <div className="flex items-center gap-2 mb-1">
                    <div className="no-print text-xs" style={{ width: '60px' }}></div>
                    <div className="flex-1 grid grid-cols-3 gap-1">
                      <div className="text-xs font-bold text-center" style={{ fontSize: '11px' }}>LW</div>
                      <div className="text-xs font-bold text-center" style={{ fontSize: '11px' }}>C</div>
                      <div className="text-xs font-bold text-center" style={{ fontSize: '11px' }}>RW</div>
                    </div>
                  </div>
                  
                  {['line1', 'line2', 'line3', 'line4'].map((line, idx) => (
                    <div key={line} className={`mb-1 rounded p-0 border-2 ${colorClasses[lines[line].color]}`}>
                      <div className="flex items-center gap-2 mb-0">
                        <select
                          value={lines[line].color}
                          onChange={(e) => handleLineColorChange(line, e.target.value)}
                          className="no-print text-xs border rounded px-1"
                        >
                          {colorOptions.map(c => <option key={c} value={c}>{c}</option>)}
                        </select>
                        <div className="flex-1 grid grid-cols-3 gap-1">
                          <LineSlot line={line} position="lw" label="LW" showLabel={false} />
                          <LineSlot line={line} position="c" label="C" showLabel={false} />
                          <LineSlot line={line} position="rw" label="RW" showLabel={false} />
                        </div>
                      </div>
                    </div>
                  ))}
                </div>

                {/* Defense Pairs + Goalies + PK/PP */}
                <div className="mb-1">
                  <div className="grid grid-cols-3 gap-2 mb-1">
                    <h2 style={{ fontSize: '13px' }} className="font-bold col-span-2 text-center">DEFENSE PAIRS</h2>
                    <h2 style={{ fontSize: '13px' }} className="font-bold text-center">GOALIES</h2>
                  </div>
                  
                  <div className="grid grid-cols-3 gap-1 mb-1">
                    <div className="text-xs font-bold text-center" style={{ fontSize: '11px' }}>LD</div>
                    <div className="text-xs font-bold text-center" style={{ fontSize: '11px' }}>RD</div>
                    <div></div>
                  </div>

                  {/* D1 + Starter Goalie */}
                  <div className="grid grid-cols-3 gap-1 mb-1">
                    <div className={`col-span-2 rounded p-0 border-2 ${colorClasses[lines.d1.color]}`}>
                      <div className="flex items-center gap-1">
                        <select
                          value={lines.d1.color}
                          onChange={(e) => handleLineColorChange('d1', e.target.value)}
                          className="no-print text-xs border rounded px-1"
                        >
                          {colorOptions.map(c => <option key={c} value={c}>{c}</option>)}
                        </select>
                        <div className="flex-1 grid grid-cols-2 gap-1">
                          <LineSlot line="d1" position="ld" label="LD" showLabel={false} />
                          <LineSlot line="d1" position="rd" label="RD" showLabel={false} />
                        </div>
                      </div>
                    </div>
                    <div className={`rounded p-0 border-2 ${colorClasses[lines.goalies.starterColor]}`}>
                      <div className="flex items-center gap-1">
                        <select
                          value={lines.goalies.starterColor}
                          onChange={(e) => handleGoalieColorChange('starter', e.target.value)}
                          className="no-print text-xs border rounded px-1"
                          style={{ width: '50px' }}
                        >
                          {colorOptions.map(c => <option key={c} value={c}>{c.substring(0,3)}</option>)}
                        </select>
                        <div className="flex-1">
                          <LineSlot line="goalies" position="starter" label="Starter" showLabel={false} />
                        </div>
                      </div>
                    </div>
                  </div>

                  {/* D2 + Backup Goalie */}
                  <div className="grid grid-cols-3 gap-1 mb-1">
                    <div className={`col-span-2 rounded p-0 border-2 ${colorClasses[lines.d2.color]}`}>
                      <div className="flex items-center gap-1">
                        <select
                          value={lines.d2.color}
                          onChange={(e) => handleLineColorChange('d2', e.target.value)}
                          className="no-print text-xs border rounded px-1"
                        >
                          {colorOptions.map(c => <option key={c} value={c}>{c}</option>)}
                        </select>
                        <div className="flex-1 grid grid-cols-2 gap-1">
                          <LineSlot line="d2" position="ld" label="LD" showLabel={false} />
                          <LineSlot line="d2" position="rd" label="RD" showLabel={false} />
                        </div>
                      </div>
                    </div>
                    <div className={`rounded p-0 border-2 ${colorClasses[lines.goalies.backupColor]}`}>
                      <div className="flex items-center gap-1">
                        <select
                          value={lines.goalies.backupColor}
                          onChange={(e) => handleGoalieColorChange('backup', e.target.value)}
                          className="no-print text-xs border rounded px-1"
                          style={{ width: '50px' }}
                        >
                          {colorOptions.map(c => <option key={c} value={c}>{c.substring(0,3)}</option>)}
                        </select>
                        <div className="flex-1">
                          <LineSlot line="goalies" position="backup" label="Backup" showLabel={false} />
                        </div>
                      </div>
                    </div>
                  </div>

                  {/* D3 + PK/PP */}
                  <div className="grid grid-cols-3 gap-1 mb-1">
                    <div className={`col-span-2 rounded p-0 border-2 ${colorClasses[lines.d3.color]}`}>
                      <div className="flex items-center gap-1">
                        <select
                          value={lines.d3.color}
                          onChange={(e) => handleLineColorChange('d3', e.target.value)}
                          className="no-print text-xs border rounded px-1"
                        >
                          {colorOptions.map(c => <option key={c} value={c}>{c}</option>)}
                        </select>
                        <div className="flex-1 grid grid-cols-2 gap-1">
                          <LineSlot line="d3" position="ld" label="LD" showLabel={false} />
                          <LineSlot line="d3" position="rd" label="RD" showLabel={false} />
                        </div>
                      </div>
                    </div>
                    <div className="grid grid-cols-2 gap-2" style={{ height: '85px' }}>
                      <div className="border-2 rounded flex flex-col" style={{ 
                        borderColor: myTeamSetup.colors.primary, 
                        background: `${myTeamSetup.colors.primary}10`,
                        padding: '2px'
                      }}>
                        <div style={{ fontSize: '8px' }} className="font-bold text-center mb-0">{myTeamData.nickname} Penalty Kill</div>
                        <div className="flex-1 flex flex-col justify-around" style={{ fontSize: '11px', lineHeight: '1.0' }}>
                          {[0,1,2,3,4].map(i => (
                            <input 
                              key={i}
                              type="text" 
                              placeholder="" 
                              className="w-full border-0 bg-transparent text-center font-bold"
                              style={{ fontSize: '11px', padding: '0px', outline: 'none' }}
                              value={coachNotes.pk?.split('\n')[i] || ''}
                              onChange={(e) => {
                                const lines = coachNotes.pk?.split('\n') || ['','','','',''];
                                lines[i] = e.target.value;
                                setCoachNotes({...coachNotes, pk: lines.join('\n')});
                              }}
                            />
                          ))}
                        </div>
                      </div>
                      
                      <div className="border-2 rounded flex flex-col" style={{ 
                        borderColor: myTeamSetup.colors.primary, 
                        background: `${myTeamSetup.colors.primary}10`,
                        padding: '2px'
                      }}>
                        <div style={{ fontSize: '8px' }} className="font-bold text-center mb-0">{myTeamData.nickname} Power Play</div>
                        <div className="flex-1 flex flex-col justify-around" style={{ fontSize: '11px', lineHeight: '1.0' }}>
                          {[0,1,2,3,4].map(i => (
                            <input 
                              key={i}
                              type="text" 
                              placeholder="" 
                              className="w-full border-0 bg-transparent text-center font-bold"
                              style={{ fontSize: '11px', padding: '0px', outline: 'none' }}
                              value={coachNotes.pp?.split('\n')[i] || ''}
                              onChange={(e) => {
                                const lines = coachNotes.pp?.split('\n') || ['','','','',''];
                                lines[i] = e.target.value;
                                setCoachNotes({...coachNotes, pp: lines.join('\n')});
                              }}
                            />
                          ))}
                        </div>
                      </div>
                    </div>
                  </div>
                </div>

                {/* Manager and Injured Boxes */}
                <div className="grid grid-cols-2 gap-2 mt-1">
                  <div className="rounded px-2 py-1 flex items-center" style={{ 
                    backgroundColor: `${myTeamSetup.colors.primary}15`,
                    border: `2px solid ${myTeamSetup.colors.primary}`
                  }}>
                    <span style={{ fontSize: '12px' }} className="font-bold mr-2">Student Manager(s)</span>
                    <input
                      type="text"
                      value={myTeamData.studentManager}
                      onChange={(e) => setMyTeamData({...myTeamData, studentManager: e.target.value})}
                      placeholder="Name"
                      className="border-0 bg-transparent flex-1 placeholder-print-hide"
                      style={{ outline: 'none', fontSize: '12px' }}
                    />
                  </div>
                  <div className="bg-red-50 border-2 border-red-400 rounded px-2 py-1 flex items-center">
                    <span style={{ fontSize: '12px' }} className="font-bold mr-2">Injured/Illness</span>
                    <input
                      type="text"
                      value={myTeamData.injuries || ''}
                      onChange={(e) => setMyTeamData({...myTeamData, injuries: e.target.value})}
                      placeholder="Enter injured/illness notes"
                      className="border-0 bg-transparent flex-1 placeholder-print-hide"
                      style={{ outline: 'none', fontSize: '12px' }}
                    />
                  </div>
                </div>
                
                {/* Creator Credit - Page 1 */}
                <div style={{ textAlign: 'center', fontSize: '8px', color: '#666', marginTop: '4px', paddingTop: '2px', paddingBottom: '2px' }}>
                  Created exclusively for the {myTeamData.teamName} {myTeamData.nickname} by Legacy Line Charts - legacylinecharts@gmail.com - Â© Legacy Line Charts
                </div>
              </div>

              {/* Print Page 2 */}
              <div className="print-page-2 bg-white p-2 max-w-7xl mx-auto page-break" style={{ maxWidth: '7.875in' }}>
                {/* Opponent Header */}
                <div className="rounded-lg p-2 mb-2" style={{ border: `3px solid ${opponentColors.primary}` }}>
                  <h2 className="text-xl font-black text-center mb-0" style={{ color: opponentColors.primary }}>
                    Opponent: {opponentData.teamName} {opponentData.nickname}
                  </h2>
                  <div className="text-center text-xs font-semibold">
                    Record: {opponentData.record.w}-{opponentData.record.l}-{opponentData.record.t}
                  </div>
                </div>

                {/* Opponent Roster */}
                <div className="mb-2">
                  
                  {(() => {
                    const totalPlayers = opponentData.roster.length;
                    const fontSize = totalPlayers >= 35 ? '10px' : 
                                    totalPlayers >= 25 ? '11px' : 
                                    totalPlayers >= 15 ? '13px' : '14px';
                    const padding = totalPlayers >= 35 ? '2px' : '3px';
                    
                    const forwards = opponentData.roster.filter(p => p.position === 'F').sort((a, b) => parseInt(a.number) - parseInt(b.number));
                    const defense = opponentData.roster.filter(p => p.position === 'D').sort((a, b) => parseInt(a.number) - parseInt(b.number));
                    const goalies = opponentData.roster.filter(p => p.position === 'G').sort((a, b) => parseInt(a.number) - parseInt(b.number));
                    
                    const fwdMaxStats = {
                      g: Math.max(...forwards.map(p => p.stats.g), 0),
                      a: Math.max(...forwards.map(p => p.stats.a), 0),
                      pts: Math.max(...forwards.map(p => p.stats.pts), 0),
                      ppg: Math.max(...forwards.map(p => p.stats.ppg), 0),
                      ppa: Math.max(...forwards.map(p => p.stats.ppa), 0),
                      sh: Math.max(...forwards.map(p => p.stats.sh), 0),
                      sha: Math.max(...forwards.map(p => p.stats.sha), 0),
                      pim: Math.max(...forwards.map(p => p.stats.pim), 0)
                    };
                    
                    const defMaxStats = {
                      g: Math.max(...defense.map(p => p.stats.g), 0),
                      a: Math.max(...defense.map(p => p.stats.a), 0),
                      pts: Math.max(...defense.map(p => p.stats.pts), 0),
                      ppg: Math.max(...defense.map(p => p.stats.ppg), 0),
                      ppa: Math.max(...defense.map(p => p.stats.ppa), 0),
                      sh: Math.max(...defense.map(p => p.stats.sh), 0),
                      sha: Math.max(...defense.map(p => p.stats.sha), 0),
                      pim: Math.max(...defense.map(p => p.stats.pim), 0)
                    };
                    
                    const isMaxStat = (value, maxValue) => value > 0 && value === maxValue;
                    
                    return (
                      <div className="grid gap-2" style={{ fontSize, gridTemplateColumns: '1fr 20px 1fr' }}>
                        {/* FORWARDS */}
                        <div>
                          <h3 className="font-bold mb-1 px-2 py-1 rounded text-xs" style={{ background: `${opponentColors.primary}20`, color: opponentColors.secondary }}>
                            Forwards
                          </h3>
                          <table className="w-full border-collapse" style={{ fontSize }}>
                            <thead>
                              <tr className="bg-gray-200" style={{ fontSize: '11px', fontWeight: 'bold' }}>
                                <th className="border p-1" style={{ padding, width: '28px' }}>#</th>
                                <th className="border p-1 text-left" style={{ padding, maxWidth: '120px', width: '120px' }}>Name</th>
                                <th className="border p-1" style={{ padding, width: '24px' }}>Gr</th>
                                <th className="border p-1" style={{ padding, width: '28px' }}>GP</th>
                                <th className="border p-1" style={{ padding, width: '28px' }}>G</th>
                                <th className="border p-1" style={{ padding, width: '28px' }}>A</th>
                                <th className="border p-1" style={{ padding, width: '32px' }}>PTS</th>
                                <th className="border p-1" style={{ padding, width: '28px' }}>PPG</th>
                                <th className="border p-1" style={{ padding, width: '28px' }}>PPA</th>
                                <th className="border p-1" style={{ padding, width: '24px' }}>SH</th>
                                <th className="border p-1" style={{ padding, width: '28px' }}>SHA</th>
                                <th className="border p-1" style={{ padding, width: '28px' }}>PIM</th>
                              </tr>
                            </thead>
                            <tbody>
                              {forwards.map((player, idx) => (
                                <tr key={player.id} className={idx % 2 === 0 ? 'bg-white' : 'bg-gray-50'}>
                                  <td className="border font-bold text-center" style={{ padding }}>{player.number}</td>
                                  <td className="border" style={{ padding, maxWidth: '120px', overflow: 'hidden', textOverflow: 'ellipsis', whiteSpace: 'nowrap' }}>{player.firstName} {player.lastName}{player.shoots ? ` (${player.shoots})` : ''}</td>
                                  <td className="border text-center" style={{ padding }}>{convertGradeToText(player.grade)}</td>
                                  <td className="border text-center" style={{ padding }}>{player.stats.gp}</td>
                                  <td className="border text-center" style={{ padding, backgroundColor: isMaxStat(player.stats.g, fwdMaxStats.g) ? '#FFFF00' : 'transparent' }}>{player.stats.g}</td>
                                  <td className="border text-center" style={{ padding, backgroundColor: isMaxStat(player.stats.a, fwdMaxStats.a) ? '#FFFF00' : 'transparent' }}>{player.stats.a}</td>
                                  <td className="border text-center font-bold" style={{ padding, backgroundColor: isMaxStat(player.stats.pts, fwdMaxStats.pts) ? '#FFFF00' : 'transparent' }}>{player.stats.pts}</td>
                                  <td className="border text-center" style={{ padding, backgroundColor: isMaxStat(player.stats.ppg, fwdMaxStats.ppg) ? '#FFFF00' : 'transparent' }}>{player.stats.ppg}</td>
                                  <td className="border text-center" style={{ padding, backgroundColor: isMaxStat(player.stats.ppa, fwdMaxStats.ppa) ? '#FFFF00' : 'transparent' }}>{player.stats.ppa}</td>
                                  <td className="border text-center" style={{ padding, backgroundColor: isMaxStat(player.stats.sh, fwdMaxStats.sh) ? '#FFFF00' : 'transparent' }}>{player.stats.sh}</td>
                                  <td className="border text-center" style={{ padding, backgroundColor: isMaxStat(player.stats.sha, fwdMaxStats.sha) ? '#FFFF00' : 'transparent' }}>{player.stats.sha}</td>
                                  <td className="border text-center" style={{ padding, backgroundColor: isMaxStat(player.stats.pim, fwdMaxStats.pim) ? '#FFFF00' : 'transparent' }}>{player.stats.pim}</td>
                                </tr>
                              ))}
                            </tbody>
                          </table>
                        </div>

                        {/* WHITE SPACE SEPARATOR */}
                        <div></div>

                        {/* DEFENSE + GOALIES */}
                        <div>
                          <h3 className="font-bold mb-1 px-2 py-1 rounded text-xs" style={{ background: `${opponentColors.primary}20`, color: opponentColors.secondary }}>
                            Defense
                          </h3>
                          <table className="w-full border-collapse mb-2" style={{ fontSize }}>
                            <thead>
                              <tr className="bg-gray-200" style={{ fontSize: '11px', fontWeight: 'bold' }}>
                                <th className="border p-1" style={{ padding, width: '28px' }}>#</th>
                                <th className="border p-1 text-left" style={{ padding, maxWidth: '120px', width: '120px' }}>Name</th>
                                <th className="border p-1" style={{ padding, width: '24px' }}>Gr</th>
                                <th className="border p-1" style={{ padding, width: '28px' }}>GP</th>
                                <th className="border p-1" style={{ padding, width: '28px' }}>G</th>
                                <th className="border p-1" style={{ padding, width: '28px' }}>A</th>
                                <th className="border p-1" style={{ padding, width: '32px' }}>PTS</th>
                                <th className="border p-1" style={{ padding, width: '28px' }}>PPG</th>
                                <th className="border p-1" style={{ padding, width: '28px' }}>PPA</th>
                                <th className="border p-1" style={{ padding, width: '24px' }}>SH</th>
                                <th className="border p-1" style={{ padding, width: '28px' }}>SHA</th>
                                <th className="border p-1" style={{ padding, width: '28px' }}>PIM</th>
                              </tr>
                            </thead>
                            <tbody>
                              {defense.map((player, idx) => (
                                <tr key={player.id} className={idx % 2 === 0 ? 'bg-white' : 'bg-gray-50'}>
                                  <td className="border font-bold text-center" style={{ padding }}>{player.number}</td>
                                  <td className="border" style={{ padding, maxWidth: '120px', overflow: 'hidden', textOverflow: 'ellipsis', whiteSpace: 'nowrap' }}>{player.firstName} {player.lastName}{player.shoots ? ` (${player.shoots})` : ''}</td>
                                  <td className="border text-center" style={{ padding }}>{convertGradeToText(player.grade)}</td>
                                  <td className="border text-center" style={{ padding }}>{player.stats.gp}</td>
                                  <td className="border text-center" style={{ padding, backgroundColor: isMaxStat(player.stats.g, defMaxStats.g) ? '#FFFF00' : 'transparent' }}>{player.stats.g}</td>
                                  <td className="border text-center" style={{ padding, backgroundColor: isMaxStat(player.stats.a, defMaxStats.a) ? '#FFFF00' : 'transparent' }}>{player.stats.a}</td>
                                  <td className="border text-center font-bold" style={{ padding, backgroundColor: isMaxStat(player.stats.pts, defMaxStats.pts) ? '#FFFF00' : 'transparent' }}>{player.stats.pts}</td>
                                  <td className="border text-center" style={{ padding, backgroundColor: isMaxStat(player.stats.ppg, defMaxStats.ppg) ? '#FFFF00' : 'transparent' }}>{player.stats.ppg}</td>
                                  <td className="border text-center" style={{ padding, backgroundColor: isMaxStat(player.stats.ppa, defMaxStats.ppa) ? '#FFFF00' : 'transparent' }}>{player.stats.ppa}</td>
                                  <td className="border text-center" style={{ padding, backgroundColor: isMaxStat(player.stats.sh, defMaxStats.sh) ? '#FFFF00' : 'transparent' }}>{player.stats.sh}</td>
                                  <td className="border text-center" style={{ padding, backgroundColor: isMaxStat(player.stats.sha, defMaxStats.sha) ? '#FFFF00' : 'transparent' }}>{player.stats.sha}</td>
                                  <td className="border text-center" style={{ padding, backgroundColor: isMaxStat(player.stats.pim, defMaxStats.pim) ? '#FFFF00' : 'transparent' }}>{player.stats.pim}</td>
                                </tr>
                              ))}
                            </tbody>
                          </table>

                          <h3 className="font-bold mb-1 px-2 py-1 rounded text-xs" style={{ background: `${opponentColors.primary}20`, color: opponentColors.secondary }}>
                            Goalies
                          </h3>
                          <table className="w-full border-collapse" style={{ fontSize }}>
                            <thead>
                              <tr className="bg-gray-200" style={{ fontSize: '11px', fontWeight: 'bold' }}>
                                <th className="border p-1" style={{ padding, width: '30px' }}>#</th>
                                <th className="border p-1 text-left" style={{ padding, maxWidth: '100px', width: '100px' }}>Name</th>
                                <th className="border p-1" style={{ padding, width: '28px' }}>Gr</th>
                                <th className="border p-1" style={{ padding, width: '55px' }}>MIN</th>
                                <th className="border p-1" style={{ padding, width: '25px' }}>W</th>
                                <th className="border p-1" style={{ padding, width: '25px' }}>L</th>
                                <th className="border p-1" style={{ padding, width: '25px' }}>T</th>
                                <th className="border p-1" style={{ padding, width: '35px' }}>SOG</th>
                                <th className="border p-1" style={{ padding, width: '30px' }}>SV</th>
                                <th className="border p-1" style={{ padding, width: '28px' }}>GA</th>
                                <th className="border p-1" style={{ padding, width: '38px' }}>GAA</th>
                                <th className="border p-1" style={{ padding, width: '38px' }}>SV%</th>
                                <th className="border p-1" style={{ padding, width: '25px' }}>SO</th>
                              </tr>
                            </thead>
                            <tbody>
                              {goalies.map((player, idx) => (
                                <tr key={player.id} className={idx % 2 === 0 ? 'bg-white' : 'bg-gray-50'}>
                                  <td className="border font-bold text-center" style={{ padding }}>{player.number}</td>
                                  <td className="border" style={{ padding, maxWidth: '100px', overflow: 'hidden', textOverflow: 'ellipsis', whiteSpace: 'nowrap' }}>{player.firstName} {player.lastName}</td>
                                  <td className="border text-center" style={{ padding }}>{convertGradeToText(player.grade)}</td>
                                  <td className="border text-center" style={{ padding }}>{player.goalieStats?.min || '0:00'}</td>
                                  <td className="border text-center" style={{ padding }}>{player.goalieStats?.w || 0}</td>
                                  <td className="border text-center" style={{ padding }}>{player.goalieStats?.l || 0}</td>
                                  <td className="border text-center" style={{ padding }}>{player.goalieStats?.t || 0}</td>
                                  <td className="border text-center" style={{ padding }}>{player.goalieStats?.sog || 0}</td>
                                  <td className="border text-center" style={{ padding }}>{player.goalieStats?.sv || 0}</td>
                                  <td className="border text-center" style={{ padding }}>{player.goalieStats?.ga || 0}</td>
                                  <td className="border text-center font-bold" style={{ padding }}>{player.goalieStats?.gaa.toFixed(2) || '0.00'}</td>
                                  <td className="border text-center font-bold" style={{ padding }}>{player.goalieStats?.svp || '.000'}</td>
                                  <td className="border text-center" style={{ padding }}>{player.goalieStats?.so || 0}</td>
                                </tr>
                              ))}
                            </tbody>
                          </table>
                        </div>
                      </div>
                    );
                  })()}
                </div>

                {/* Diagrams & Notes */}
                <div className="mt-2" style={{ display: 'flex', flexDirection: 'column', overflow: 'hidden' }}>
                  <h2 style={{ fontSize: '14px', color: 'black' }} className="font-bold mb-1">Pre-Game Preparation - Diagrams & Notes</h2>
                  
                  <div style={{ display: 'flex', gap: '4px', flexGrow: 1 }}>
                    {/* COLUMN 1: Large diagram (60%) */}
                    <div style={{ width: '60%', position: 'relative', display: 'flex', flexDirection: 'column' }}>
                      {diagramImages.image1 ? (
                        <div className="relative w-full flex-1">
                          <img src={diagramImages.image1} alt="Diagram 1" className="w-full h-full object-contain" />
                          <button
                            onClick={() => setDiagramImages({...diagramImages, image1: null})}
                            className="no-print absolute top-0 right-0 bg-red-500 text-white text-xs px-2 py-1 rounded hover:bg-red-600"
                          >
                            Ã—
                          </button>
                        </div>
                      ) : (
                        <div className="flex-1 flex flex-col bg-gray-50 rounded p-1 no-print">
                          <div style={{ fontSize: '9px' }} className="text-gray-600 font-semibold mb-1">Diagram 1</div>
                          <input
                            type="file"
                            accept="image/*"
                            onChange={(e) => {
                              const file = e.target.files[0];
                              if (file) {
                                const reader = new FileReader();
                                reader.onload = (event) => {
                                  setDiagramImages({...diagramImages, image1: event.target.result});
                                };
                                reader.readAsDataURL(file);
                              }
                            }}
                            className="no-print w-full text-xs mb-1"
                          />
                          <div 
                            style={{ fontSize: '9px', lineHeight: '1.3' }} 
                            className="flex-1 text-gray-600 border border-gray-300 rounded p-1 bg-white"
                            contentEditable
                            suppressContentEditableWarning
                            onPaste={(e) => {
                              const items = e.clipboardData.items;
                              for (let i = 0; i < items.length; i++) {
                                if (items[i].type.indexOf('image') !== -1) {
                                  e.preventDefault();
                                  const blob = items[i].getAsFile();
                                  const reader = new FileReader();
                                  reader.onload = (event) => {
                                    setDiagramImages({...diagramImages, image1: event.target.result});
                                  };
                                  reader.readAsDataURL(blob);
                                  break;
                                }
                              }
                            }}
                          >
                            Paste image or notes...
                          </div>
                        </div>
                      )}
                    </div>
                    
                    {/* COLUMN 2: Small diagram (20%) */}
                    <div style={{ width: '20%', position: 'relative', display: 'flex', flexDirection: 'column' }}>
                      {diagramImages.image2 ? (
                        <div className="relative w-full flex-1">
                          <img src={diagramImages.image2} alt="Diagram 2" className="w-full h-full object-contain" />
                          <button
                            onClick={() => setDiagramImages({...diagramImages, image2: null})}
                            className="no-print absolute top-0 right-0 bg-red-500 text-white text-xs px-1 py-0 rounded hover:bg-red-600" style={{ fontSize: '10px' }}
                          >
                            Ã—
                          </button>
                        </div>
                      ) : (
                        <div className="flex-1 flex flex-col bg-gray-50 rounded p-1 no-print">
                          <div style={{ fontSize: '9px' }} className="text-gray-600 font-semibold mb-1">Diagram 2</div>
                          <input
                            type="file"
                            accept="image/*"
                            onChange={(e) => {
                              const file = e.target.files[0];
                              if (file) {
                                const reader = new FileReader();
                                reader.onload = (event) => {
                                  setDiagramImages({...diagramImages, image2: event.target.result});
                                };
                                reader.readAsDataURL(file);
                              }
                            }}
                            className="no-print w-full text-xs mb-1"
                          />
                          <div 
                            style={{ fontSize: '8px', lineHeight: '1.2' }} 
                            className="flex-1 text-gray-600 border border-gray-300 rounded p-1 bg-white"
                            contentEditable
                            suppressContentEditableWarning
                            onPaste={(e) => {
                              const items = e.clipboardData.items;
                              for (let i = 0; i < items.length; i++) {
                                if (items[i].type.indexOf('image') !== -1) {
                                  e.preventDefault();
                                  const blob = items[i].getAsFile();
                                  const reader = new FileReader();
                                  reader.onload = (event) => {
                                    setDiagramImages({...diagramImages, image2: event.target.result});
                                  };
                                  reader.readAsDataURL(blob);
                                  break;
                                }
                              }
                            }}
                          >
                            Paste...
                          </div>
                        </div>
                      )}
                    </div>
                    
                    {/* COLUMN 3: Small diagram (20%) */}
                    <div style={{ width: '20%', position: 'relative', display: 'flex', flexDirection: 'column' }}>
                      {diagramImages.image3 ? (
                        <div className="relative w-full flex-1">
                          <img src={diagramImages.image3} alt="Diagram 3" className="w-full h-full object-contain" />
                          <button
                            onClick={() => setDiagramImages({...diagramImages, image3: null})}
                            className="no-print absolute top-0 right-0 bg-red-500 text-white text-xs px-1 py-0 rounded hover:bg-red-600" style={{ fontSize: '10px' }}
                          >
                            Ã—
                          </button>
                        </div>
                      ) : (
                        <div className="flex-1 flex flex-col bg-gray-50 rounded p-1 no-print">
                          <div style={{ fontSize: '9px' }} className="text-gray-600 font-semibold mb-1">Diagram 3</div>
                          <input
                            type="file"
                            accept="image/*"
                            onChange={(e) => {
                              const file = e.target.files[0];
                              if (file) {
                                const reader = new FileReader();
                                reader.onload = (event) => {
                                  setDiagramImages({...diagramImages, image3: event.target.result});
                                };
                                reader.readAsDataURL(file);
                              }
                            }}
                            className="no-print w-full text-xs mb-1"
                          />
                          <div 
                            style={{ fontSize: '8px', lineHeight: '1.2' }} 
                            className="flex-1 text-gray-600 border border-gray-300 rounded p-1 bg-white"
                            contentEditable
                            suppressContentEditableWarning
                            onPaste={(e) => {
                              const items = e.clipboardData.items;
                              for (let i = 0; i < items.length; i++) {
                                if (items[i].type.indexOf('image') !== -1) {
                                  e.preventDefault();
                                  const blob = items[i].getAsFile();
                                  const reader = new FileReader();
                                  reader.onload = (event) => {
                                    setDiagramImages({...diagramImages, image3: event.target.result});
                                  };
                                  reader.readAsDataURL(blob);
                                  break;
                                }
                              }
                            }}
                          >
                            Paste...
                          </div>
                        </div>
                      )}
                    </div>
                  </div>
                </div>
                
                {/* MSHSL Boys Hockey Logo */}
                <div style={{ textAlign: 'center', marginTop: '8px', marginBottom: '4px' }}>
                  <img 
                    src="https://cdn2.sportngin.com/attachments/league/c4e7-208998629/MSHSLboyshockey_large_square.png" 
                    alt="MSHSL Boys Hockey" 
                    style={{ width: '0.5in', height: '0.5in', objectFit: 'contain' }}
                  />
                </div>
                
                {/* Creator Credit - Page 2 */}
                <div style={{ textAlign: 'center', fontSize: '8px', color: '#666', marginTop: '4px', paddingTop: '2px', paddingBottom: '2px' }}>
                  Created exclusively for the {myTeamData.teamName} {myTeamData.nickname} by Legacy Line Charts - legacylinecharts@gmail.com - Â© Legacy Line Charts
                </div>
              </div>

              {/* Print Styles */}
              <style>{`
                @media print {
                  .no-print {
                    display: none !important;
                  }
                  
                  .placeholder-print-hide::placeholder {
                    color: transparent !important;
                  }
                  
                  body {
                    margin: 0;
                    padding: 0;
                  }
                  
                  .print-page-1, .print-page-2 {
                    page-break-after: always;
                    margin: 0 auto !important;
                    padding: 0.05in;
                    max-width: 7.875in !important;
                    width: 7.875in !important;
                    min-height: 10.375in;
                    max-height: 10.375in;
                    box-sizing: border-box !important;
                    overflow: hidden;
                    position: relative;
                    left: 0;
                    right: 0;
                  }
                  
                  .print-page-2 {
                    page-break-before: always;
                    page-break-after: avoid;
                    page-break-inside: avoid;
                  }
                  
                  @page {
                    size: 8.5in 11in;
                    margin: 0.3125in;
                  }
                  
                  * {
                    box-sizing: border-box !important;
                  }
                  
                  .print-page-2 > div:last-child {
                    flex-shrink: 1;
                    overflow: hidden;
                  }
                }
                
                .page-break {
                  page-break-before: always;
                }
              `}</style>
            </div>
          );
        };

        // Render with Error Boundary
        ReactDOM.render(
          <ErrorBoundary>
            <HockeyLinesChart />
          </ErrorBoundary>,
          document.getElementById('root')
        );
    </script>
</body>
</html>
